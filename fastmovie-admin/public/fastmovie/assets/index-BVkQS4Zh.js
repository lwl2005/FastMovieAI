import{d as k1,z as i1,r as p,j as K,k as v,m as s,P as n1,e as P,ak as ho,ae as ke,s as i,l as a,aj as yo,u as t,x as de,B as S1,q as w1,a6 as R1,I as X,M as le,a4 as E1,h as n,t as b,a7 as I1,a5 as Co,E as c,o as xo,f as $,G as Ct,aC as xt,aD as bt,aE as Ue,aF as fo,aG as Lt,aH as kt,aI as _o,aq as St,w as vo,a as wt,C as Rt,p as pe,ar as be,am as Et,ab as It,aJ as Vt,aK as Ut,J as y1,aL as Pt,S as At,O as $t,D as C1,aM as Mt,F as G,ah as zt,an as Dt}from"./vendor-t8h0TCfL.js";import{_ as Ot}from"./xl-dialogue-create.vue_vue_type_script_setup_true_lang-B8hHj5VF.js";import{b as bo,a as Lo,c as Bt}from"./xl-actor-create-BekV8bjq.js";import{_ as Tt}from"./index-NttUUQHN.js";import{$ as E,R as M,_ as he,t as L1,o as Nt,c as Gt,u as Ft,l as Zt,m as qt}from"./index-B0RNcuq8.js";import{_ as Wt}from"./xl-prop-create-KRM39Wah.js";import{_ as Ht}from"./index-BFBlsriZ.js";import{u as Le,I as go,_ as jt}from"./usePoints-C21LjXJs.js";import{I as s1}from"./icon-points-01HE_Clx.js";import{I as Jt}from"./icon-replace-0MVmRYmL.js";import{I as x1}from"./icon-image-BfHAjLRU.js";import{u as Qt}from"./usePush-v4t_r-_Z.js";import{u as Kt}from"./useLoading-Di0R6Cv8.js";const Xt={class:"flex flex-column grid-gap-4",style:{"--el-color-primary":"var(--el-color-success)"}},Yt={class:"grid-columns-8 grid-gap-4"},ea=["onClick"],oa={class:"p-2"},ta={class:"h10"},aa=k1({__name:"index",props:{query:{default:()=>({})},types:{default:()=>[]}},emits:["select"],setup(Z,{expose:u,emit:L}){const k=Z,V=L,C=i1({type:"episode",description:"",...k.query}),A=p([]),f=p(!1),S=()=>{f.value=!0,A.value=[],E.get("/app/shortplay/api/Storyboard/index",{params:C}).then(g=>{g.code===M.SUCCESS&&(A.value=g.data)}).finally(()=>{f.value=!1})},Y=g=>{if(!g.image)return c.info("该分镜还未生成图片");V("select",g)};return u({getStoryboardList:S}),(g,R)=>{const z=Lo,ge=bo,ee=yo,se=K("Search"),ce=w1,x=S1,N=ho,r=I1,d=E1,H=Co,j=R1;return n(),v("div",Xt,[s(N,{class:"flex flex-center grid-gap-4",onSubmit:ke(S,["prevent"])},{default:i(()=>[s(ee,{class:"mb-0"},{default:i(()=>[s(ge,{modelValue:t(C).type,"onUpdate:modelValue":R[0]||(R[0]=m=>t(C).type=m),class:"text-info",onChange:S},{default:i(()=>[s(z,{value:"episode"},{default:i(()=>[...R[2]||(R[2]=[de("本集",-1)])]),_:1}),s(z,{value:"all"},{default:i(()=>[...R[3]||(R[3]=[de("全部",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),R[4]||(R[4]=a("div",{class:"flex-1"},null,-1)),s(ee,{class:"mb-0"},{default:i(()=>[s(x,{modelValue:t(C).description,"onUpdate:modelValue":R[1]||(R[1]=m=>t(C).description=m),placeholder:"搜索分镜",clearable:"",onChange:S},{suffix:i(()=>[s(ce,null,{default:i(()=>[s(se)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(A).length>0||t(f)?n1((n(),P(d,{key:0,height:"40vh"},{default:i(()=>[a("div",Yt,[(n(!0),v(X,null,le(t(A),m=>(n(),v("div",{class:"grid-column-2 input-button rounded-4 border-2 border-solid flex flex-column grid-gap-2 storyboard-item",onClick:w=>Y(m)},[a("div",oa,[a("span",ta,"场景"+b(m.scene_id)+" - #"+b(m.sort),1)]),s(r,{src:m.image,size:40,shape:"square",fit:"contain",class:"storyboard-item-image bg-mosaic"},null,8,["src"])],8,ea))),256))])]),_:1})),[[j,t(f)]]):(n(),P(H,{key:1,description:"暂无分镜"}))])}}}),sa=he(aa,[["__scopeId","data-v-eac67c5a"]]),la={class:"flex flex-column grid-gap-4",style:{"--el-color-primary":"var(--el-color-success)"}},ia={class:"grid-columns-8 grid-gap-4"},na=["onClick"],ra={class:"flex-1 flex flex-column grid-gap-2"},da=k1({__name:"index",props:{query:{default:()=>({})},types:{default:()=>[]}},emits:["select"],setup(Z,{emit:u}){const L=Z,k=u,V=i1({type:"all",name:"",...L.query}),C=p([]),A=p(!1),f=()=>{A.value=!0,C.value=[],E.get("/app/shortplay/api/Prop/index",{params:V}).then(g=>{g.code===M.SUCCESS&&(C.value=g.data)}).finally(()=>{A.value=!1})},S=g=>{k("select",g)},Y=p(null);return xo(()=>{f()}),(g,R)=>{const z=Lo,ge=bo,ee=yo,se=K("Search"),ce=w1,x=S1,N=ho,r=K("Plus"),d=I1,H=E1,j=Wt,m=R1;return n(),v("div",la,[s(N,{class:"flex flex-center grid-gap-4",onSubmit:ke(f,["prevent"])},{default:i(()=>[s(ee,{class:"mb-0"},{default:i(()=>[s(ge,{modelValue:t(V).type,"onUpdate:modelValue":R[0]||(R[0]=w=>t(V).type=w),class:"text-info",onChange:f},{default:i(()=>[s(z,{value:"all"},{default:i(()=>[...R[3]||(R[3]=[de("全部",-1)])]),_:1}),s(z,{value:"personal"},{default:i(()=>[...R[4]||(R[4]=[de("个人",-1)])]),_:1}),(n(!0),v(X,null,le(L.types,w=>(n(),P(z,{key:w.value,value:w.value},{default:i(()=>[de(b(w.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),R[5]||(R[5]=a("div",{class:"flex-1"},null,-1)),s(ee,{class:"mb-0"},{default:i(()=>[s(x,{modelValue:t(V).name,"onUpdate:modelValue":R[1]||(R[1]=w=>t(V).name=w),placeholder:"搜索物品",clearable:"",onChange:f},{suffix:i(()=>[s(ce,null,{default:i(()=>[s(se)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),n1((n(),P(H,{height:"40vh"},{default:i(()=>[a("div",ia,[t(V).type!=="public"?(n(),v("div",{key:0,class:"grid-column-2 rounded-4 p-4 border-2 border-dotted prop-item flex flex-center grid-gap-4 prop-item",onClick:R[2]||(R[2]=w=>t(Y)?.open?.(null,L.query?.drama_id,L.query?.episode_id))},[s(ce,{class:"rounded-4",size:"20",style:{height:"40px",width:"40px","background-color":"var(--el-fill-color-dark)"}},{default:i(()=>[s(r)]),_:1}),R[6]||(R[6]=a("span",null,"添加物品",-1))])):$("",!0),(n(!0),v(X,null,le(t(C),w=>(n(),v("div",{class:"grid-column-2 input-button rounded-4 p-4 border-2 border-solid flex flex-center grid-gap-2 prop-item",onClick:U=>S(w)},[s(d,{src:w.image,size:40},{default:i(()=>[de(b(t(L1)(w.name,1)),1)]),_:2},1032,["src"]),a("div",ra,[a("span",null,b(w.name),1)])],8,na))),256))])]),_:1})),[[m,t(A)]]),s(j,{ref_key:"propCreateRef",ref:Y,onSuccess:f},null,512)])}}}),ca=he(da,[["__scopeId","data-v-6b249319"]]),ua={},pa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"currentColor",version:"1.1",width:"16",height:"16",viewBox:"0 0 16 16"};function fa(Z,u){return n(),v("svg",pa,[...u[0]||(u[0]=[a("defs",null,[a("clipPath",{id:"master_svg0_97_17701"},[a("rect",{x:"0",y:"0",width:"16",height:"16",rx:"0"})])],-1),a("g",{"clip-path":"url(#master_svg0_97_17701)"},[a("g",null,[a("path",{d:"M12.671717,1C14.092226,1.0011720381,14.998835,2.1028881999999998,15,3.5316033L15,12.170699C14.998835,13.598242,14.091061,14.998828,12.671717,15L3.295656,15C1.8763120199999999,14.998828,1.0000011604321,13.598243,1.0000011604321,12.171871L1.0000011604321,3.5316033C0.9988358422,2.1028881999999998,1.87514681,1.0011720523,3.2944908,1L12.670551,1L12.671717,1ZM3.2502091,1.99154449C2.5824882000000002,1.99154449,2.1664735,2.5377145,2.1664735,3.2092927L2.1664735,12.493011C2.1664735,13.164589,2.5824881,13.852575,3.2502091,13.852575L12.482937,13.852575C13.150658,13.852575,13.811387,13.164589,13.811387,12.493011L13.811387,3.2092927C13.811387,2.5377145,13.150658,1.99154449,12.482937,1.99154449L3.2502091,1.99154449ZM4.262861,4.452825499999999L7.807725,7.7239857C7.872982,7.7802434,7.884635,7.8763504,7.8368578,7.9466729L7.8088903,7.9806619L4.2593651,11.254166C4.1603138,11.346757,3.9831874,11.304564,3.9482281,11.183844L3.9424016,11.139306L3.9447322,4.5676858C3.9447322,4.4293852000000005,4.1055443,4.3520308,4.2279017,4.4258690000000005L4.262861,4.452825499999999ZM11.874646,4.5676854L11.875812,11.139305C11.876978,11.206112,11.831531,11.267057,11.761612,11.29167C11.692256,11.31698,11.614714,11.302638,11.558848,11.254165L8.010487999999999,7.9806614C7.9337707,7.9129701,7.9337707,7.7928486,8.010487999999999,7.7251568L11.555352,4.452825300000001C11.680039,4.3379655,11.874646,4.4153199,11.874646,4.5676854Z",fill:"currentColor","fill-opacity":"1"})])],-1)])])}const _a=he(ua,[["render",fa]]),va={},ga={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"currentColor",version:"1.1",width:"16",height:"16",viewBox:"0 0 16 16"};function ma(Z,u){return n(),v("svg",ga,[...u[0]||(u[0]=[a("defs",null,[a("clipPath",{id:"master_svg0_97_17687"},[a("rect",{x:"0",y:"0",width:"16",height:"16",rx:"0"})])],-1),a("g",{"clip-path":"url(#master_svg0_97_17687)"},[a("g",null,[a("path",{d:"M6.4791274,14.834091L9.6167574,9.3999968L12.088788,13.681892C10.8986902,14.541017,9.467721,15.002316,7.9999995,14.999991C7.4778776,14.999991,6.9690537,14.942592,6.4791274,14.834091ZM5.1234303,14.383991C3.3048093,13.561538,1.9222616000000001,12.003649,1.32159874,10.0999966L7.5961599,10.0999966L5.1234303,14.383291L5.1234303,14.383991ZM1.036041494,8.6999984C0.83344124,6.7137823,1.49160001,4.7359548,2.8438711000000003,3.2673051L5.9787016,8.6999984L1.036041494,8.6999984ZM3.911911,2.3181059C5.1018162,1.45912349,6.5325189,0.9978303101,7.9999995,1.0000072598373C8.5221219,1.0000072598373,9.0309458,1.057407163,9.5208721,1.1659070599999999L6.3832417,6.6000004L3.911911,2.3181059ZM10.8765688,1.61600643C12.695189,2.4384615,14.077736,3.9963496,14.6784,5.9000015L8.403839099999999,5.9000015L10.8765688,1.6167064899999999L10.8765688,1.61600643ZM14.963958,7.3000002C15.166557,9.2862158,14.508398,11.264044,13.156128,12.732694L10.0212965,7.3000002L14.963958,7.3000002Z",fill:"currentColor","fill-opacity":"1"})])],-1)])])}const ha=he(va,[["render",ma]]),ya={},Ca={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"currentColor",version:"1.1",width:"26",height:"26",viewBox:"0 0 26 26"};function xa(Z,u){return n(),v("svg",Ca,[...u[0]||(u[0]=[Ct('<defs><clipPath id="master_svg0_27_49516/27_38595"><rect x="0" y="0" width="26" height="26" rx="0"></rect></clipPath></defs><g clip-path="url(#master_svg0_27_49516/27_38595)"><path d="M12.50390625,7.87200927625L10.47851565,9.92758180625L9.61132815,9.92758180625C8.91410041,9.92758180625,8.34765625,10.49902030625,8.34765625,11.20176700625L8.34765625,13.41844180625C8.34765625,14.12118770625,8.91436535,14.69262690625,9.61132815,14.69262690625L10.47851565,14.69262690625L12.50390625,16.74975590625C12.82104535,17.069396006250003,13.12773515,17.231506306249997,13.41406245,17.231506306249997C13.78060485,17.231506306249997,14.149859450000001,16.965560906249998,14.15039065,16.37124630625L14.15039065,8.24792480625C14.15039065,7.65694978625,13.78033975,7.39306670427325,13.41406245,7.39306640625C13.12428145,7.39358019835,12.81759305,7.55416746625,12.50390625,7.87200927625ZM12.97070315,9.02647400625L12.97070315,15.59271240625L11.10156245,13.69491580625C11.00554705,13.59719510625,10.87178585,13.54152200625,10.73242185,13.54074100625L9.69921875,13.54074100625C9.60466115,13.54074100625,9.52734375,13.45903210625,9.52734375,13.358566306250001L9.52734375,11.26112370625C9.52734375,11.16040060625,9.60466115,11.07868960625,9.69921875,11.07868960625L10.73242185,11.07868960625C10.87157445,11.07799740625,11.00591925,11.02230720625,11.10156245,10.92453000625L12.97070315,9.02647400625ZM16.08984375,10.32969660625C16.04309655,10.26674510625,15.99196625,10.19890500625,15.94335935,10.12927250625C15.78200765,9.89366720625,15.44887875,9.83941530625,15.21679685,10.01107790625C14.99228665,10.18012620625,14.94093515,10.48897980625,15.10156245,10.71614070625C15.15468405,10.79065490625,15.20878415,10.86594890625,15.26562505,10.93917850625C15.55567125,11.32896490625,15.76562505,11.610575206250001,15.76562505,12.20283510625C15.76562505,12.77351140625,15.526875050000001,13.102140406250001,15.22460935,13.51890560625L15.10156245,13.68721010625L15.10156245,13.68951420625C14.94398065,13.916686506249999,14.992948550000001,14.222905206250001,15.21484375,14.39251710625L15.21875005,14.39508060625C15.30684185,14.45908740625,15.413262849999999,14.49370670625,15.52343745,14.49374390625C15.55156805,14.493742506250001,15.57969905,14.49143220625,15.60742185,14.48681640625C15.74385405,14.46413330625,15.86560635,14.38872050625,15.94335935,14.277923606249999L16.06054685,14.11553950625C16.38724705,13.664085906250001,16.79296875,13.10214470625,16.79296875,12.20283510625C16.79296875,11.27474780625,16.42062375,10.77473280625,16.09179685,10.33355710625L16.08984375,10.32969660625ZM22.98171425,20.83980140625L22.98171425,14.09369370625C22.981177250000002,13.869582606249999,22.858250249999998,13.66243270625,22.65846625,13.548969306250001C22.54567925,13.46627230625,22.40794825,13.42167850625,22.26642725,13.42203760625L19.45520325,13.42203760625C19.09500525,13.42246290625,18.803157249999998,13.70490550625,18.80286425,14.05335330625C18.802871250000003,14.08128400625,18.80482325,14.10918240625,18.808707249999998,14.136860406250001L18.808707249999998,17.31168080625C18.80091525,17.36727050625,18.80091525,17.42362240625,18.808707249999998,17.47920940625L18.808707249999998,20.90891940625C18.80860925,20.979888406249998,18.82100525,21.05035640625,18.84536125,21.117302406249998C18.87083725,21.273176406250002,18.94693325,21.41716240625,19.062631250000003,21.528415406249998L20.35615425,22.77999740625C20.50420225,22.92406740625,20.706635249999998,23.00341940625,20.91659325,22.99968640625L20.929343250000002,22.99968640625C21.13516825,23.000289406249998,21.332682249999998,22.921177406250003,21.47782725,22.77999740625L22.77135225,21.528415406249998C22.958229250000002,21.34857340625,23.03752025,21.089021406249998,22.98171425,20.83980140625ZM21.67676925,18.02753240625L21.67676925,20.46312040625L21.673582250000003,20.46620440625L20.91712425,21.19798440625L20.160399249999998,20.46620440625C20.14552525,20.45181540625,20.12985525,20.43768440625,20.113387250000002,20.42432340625L20.113387250000002,18.02753340625L21.67676925,18.02753240625ZM21.67676925,14.68415640625L21.67676925,16.76541610625L20.11312125,16.76541610625L20.11312125,14.68415640625L21.67676925,14.68415640625Z" fill="currentColor" fill-opacity="1"></path><path d="M16.868812,21.441244L4.875,21.441254C4.6157641,21.441254,4.4121094,21.23568,4.4121094,20.971283L4.4121094,4.8425598C4.4121094,4.5833017,4.6229516,4.3726044,4.8808594,4.3726044L20.865719,4.3726033C21.123892,4.3726033,21.333725,4.5853543000000005,21.333725,4.8469249L21.333725,12.0670967C21.333725,12.4445696,21.650047,12.7505722,22.040249,12.7505722C22.430452,12.7505722,22.746775,12.4445696,22.746773,12.0670967L22.746773,4.842557C22.746775,3.826594,21.902929,3,20.865721,3L4.8808594,3C3.84364986,3,3,3.82479435,3,4.8389587L3,20.967438C3,21.981859,3.8418687,22.807159,4.8769531,22.807159L16.870671,22.807167C17.253038,22.796482,17.557112,22.493252,17.556535,22.123205C17.55596,21.753159,17.250945,21.450815,16.868546000000002,21.441244L16.868812,21.441244Z" fill="currentColor" fill-opacity="1"></path></g>',2)])])}const mo=he(ya,[["render",xa]]),ba={},La={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"currentColor",version:"1.1",width:"26",height:"26",viewBox:"0 0 26 26"};function ka(Z,u){return n(),v("svg",La,[...u[0]||(u[0]=[a("path",{d:"M22.769575,22L3.2304250000000003,22C2.5508799,22,2,21.469812,2,20.81579L2,5.1842105C2,4.53018898,2.5508799,4,3.2304250000000003,4L22.769575,4C23.44912,4,24,4.53018898,24,5.1842105L24,20.81579C24,21.469812,23.44912,22,22.769575,22ZM19.54586,20.578947L22.031319,20.578947C22.303137,20.578947,22.523489,20.366873,22.523489,20.105263L22.523489,17.855264L19.54586,17.855264L19.54586,20.578947ZM22.523489,16.434210999999998L22.523489,13.7105265L19.54586,13.7105265L19.54586,16.434210999999998L22.523489,16.434210999999998ZM6.3803129,5.4210527L3.96868,5.4210527C3.6968619,5.4210527,3.47651,5.6331282,3.47651,5.8947369L3.47651,8.1210527L6.3803129,8.1210527L6.3803129,5.4210527ZM6.3803129,9.5421052L3.47651,9.5421052L3.47651,12.2894735L6.3803129,12.2894735L6.3803129,9.5421052ZM6.3803129,13.7105265L3.47651,13.7105265L3.47651,16.434210999999998L6.3803129,16.434210999999998L6.3803129,13.7105265ZM6.3803129,17.855264L3.47651,17.855264L3.47651,20.105263C3.47651,20.366873,3.6968619,20.578947,3.96868,20.578947L6.3803129,20.578947L6.3803129,17.855264ZM18.069351,5.4210527L7.856823,5.4210527L7.856823,20.578947L18.069351,20.578947L18.069351,5.4210527ZM22.523489,5.8947369C22.523489,5.6331282,22.303137,5.4210527,22.031319,5.4210527L19.54586,5.4210527L19.54586,8.1210527L22.523489,8.1210527L22.523489,5.8947369ZM19.54586,9.5421052L19.54586,12.2894735L22.523489,12.2894735L22.523489,9.5421052L19.54586,9.5421052ZM11.0477829,10.159789100000001L11.0522614,10.1594577C11.0593004,10.159030900000001,11.0663624,10.1587472,11.0734491,10.1585097Q11.0846958,10.158083399999999,11.0959663,10.1579652L11.1027336,10.1579652C11.2320557,10.157902199999999,11.3591013,10.190704799999999,11.4710245,10.2530575L15.271216,12.3644104C15.744843,12.5934887,15.82034,13.2142305,15.414488,13.5423927C15.396891,13.5567398,15.378559,13.5702324,15.359562,13.5828209Q15.339457,13.5962734,15.31849,13.6083755C15.315021,13.6103649,15.311895,13.612709,15.308375,13.6146755L11.4701385,15.746895C11.2917366,15.846202,11.0782795,15.869076,10.8815527,15.809966L10.8790913,15.809279C10.871069,15.806911,10.863121,15.804187,10.8551722,15.801488C10.8513088,15.800209,10.8474207,15.799002,10.8435812,15.797626C10.8390779,15.796017,10.8346233,15.79424,10.8301458,15.792534C10.8232059,15.789929,10.8162413,15.787348,10.8094006,15.784529C10.8082199,15.784055,10.8069401,15.783486,10.8058329,15.782989C10.5356503,15.670456,10.3607616,15.414186,10.3607883,15.130845L10.3607883,10.868421099999999C10.3608866,10.4952235,10.6609573,10.1857018,11.0477829,10.159789100000001ZM11.8373709,13.901515L13.461212,12.9994783L11.8373709,12.0972757L11.8373709,13.901515Z",fill:"currentColor","fill-opacity":"1"},null,-1)])])}const b1=he(ba,[["render",ka]]),Sa={},wa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"currentColor",version:"1.1",width:"20",height:"20",viewBox:"0 0 20 20"};function Ra(Z,u){return n(),v("svg",wa,[...u[0]||(u[0]=[a("path",{d:"M11.405941519116212,5.725049015625L8.61189891911621,5.725049015625C8.30340291911621,5.725049015625,8.05320741911621,5.475146765625,8.05320741911621,5.166357515625C8.05320741911621,4.857568265625,8.30340291911621,4.607666015625,8.61189891911621,4.607666015625L11.405942419116212,4.607666015625C11.71473171911621,4.607666015625,11.964633419116211,4.857568265625,11.964633419116211,5.166357515625C11.964633419116211,5.475146765625,11.714730719116211,5.725049015625,11.405941519116212,5.725049015625ZM13.98772811911621,16.633301015625L6.035091919116211,16.633301015625C5.4824063791162105,16.633301015625,5.032552719116211,16.183741015625,5.032552719116211,15.631055015625L5.032552719116211,10.138916015625C5.032552719116211,9.830126715625,5.282747979116211,9.580224515625,5.591244219116211,9.580224515625C5.899740459116211,9.580224515625,6.149935719116211,9.830126715625,6.149935719116211,10.138916015625L6.149935719116211,15.515771015625L13.87317851911621,15.515771015625L13.87317851911621,10.138916015625C13.87317851911621,9.830126715625,14.12308121911621,9.580224515625,14.43186951911621,9.580224515625C14.74065781911621,9.580224515625,14.990560519116212,9.830126715625,14.990560519116212,10.138916015625L14.990560519116212,15.631055015625C14.990560519116212,16.183741015625,14.54041291911621,16.633301015625,13.98772811911621,16.633301015625Z",fill:"currentColor"},null,-1),a("path",{d:"M14.434875719116212,10.697337153125C14.27828371911621,10.697337153125,14.12271671911621,10.631858853125,14.011975719116212,10.503684953125C13.81011971911621,10.270189253125,13.836340719116212,9.917747453125,14.06983671911621,9.715891853125001L15.991418719116211,8.056223853125001L12.97208271911621,4.5571516531250005L11.773401219116211,5.589426953125C11.53990551911621,5.7890853531249995,11.18629171911621,5.764622253125,10.985608119116211,5.530540453125C10.784338519116211,5.296458353125,10.810411919116211,4.944017053125,11.044494619116211,4.742747453125L12.35069561911621,3.618186833125C12.550939519116211,3.446800113125,12.806262019116211,3.362278581125,13.064953719116211,3.384104847925C13.323058719116212,3.404319644125,13.557580719116212,3.523265003125,13.72515871911621,3.719114663125L16.92994371911621,7.433518453125C17.09913371911621,7.624973253125,17.18424171911621,7.877073253125,17.16563671911621,8.138401053125001C17.14761971911621,8.395334753124999,17.030871719116213,8.631613753125,16.83663271911621,8.802414853125L14.79991571911621,10.561545353125C14.694593719116211,10.652658453125,14.56480771911621,10.697336153125,14.434875719116212,10.697337153125ZM16.08590171911621,8.165794353125001C16.08692671911621,8.166819553125,16.087512719116212,8.167405653125,16.08809871911621,8.168577653125L16.08590171911621,8.165794353125001ZM12.87716071911621,4.446995153125C12.87716071911621,4.447581153125,12.87774671911621,4.447581153125,12.87774671911621,4.448020553125L12.87716071911621,4.446995153125ZM5.593957419116212,10.697337153125C5.4646120191162115,10.697337153125,5.3345337191162105,10.652659453125,5.2289185191162115,10.561546353125L3.196594239116211,8.806369753125C2.9985473791162107,8.631760553125,2.8817993401162108,8.396067153125,2.863195776916211,8.138547453125C2.844592273116211,7.877219153125,2.929553211116211,7.625705753125,3.102111819116211,7.429270253125L6.305871519116211,3.716916923125C6.470959219116211,3.523264523125,6.705187819116211,3.404319286125,6.963586319116211,3.384104371025C7.220812819116211,3.360080957125,7.477600119116211,3.445774317125,7.677258019116211,3.617014523125L8.98009011911621,4.743186353125C9.21358631911621,4.945041753125,9.23922111911621,5.298069153125,9.03736541911621,5.531565153124999C8.835217019116211,5.764475353125,8.482482419116211,5.789670953125,8.249572319116211,5.588840453125L7.056310619116211,4.557590653125L4.037267819116211,8.056077053125L5.959435919116211,9.715744953125C6.1929316191162105,9.917600653125,6.218566419116211,10.270041453125,6.017004019116211,10.503538153125C5.906554719116211,10.631858853125,5.750842119116211,10.697337153125,5.593957419116212,10.697337153125ZM3.945861819116211,8.161985353125L3.944250419116211,8.163596653125001L3.945861819116211,8.161985353125ZM7.153869619116211,4.444798153125L7.152844419116211,4.445823553125C7.152990819116211,4.445237553125,7.153284119116211,4.445237553125,7.153869619116211,4.444798153125ZM14.271692719116212,13.821994953125L5.7568483191162105,13.821994953125C5.448352319116211,13.821994953125,5.19815681911621,13.572091953125,5.19815681911621,13.263303753125C5.19815681911621,12.954514553125,5.448352319116211,12.704612753125,5.7568483191162105,12.704612753125L14.271692719116212,12.704612753125C14.58048171911621,12.704612753125,14.830383719116211,12.954515453125,14.830383719116211,13.263303753125C14.830383719116211,13.572092953125,14.580627719116212,13.821994953125,14.271692719116212,13.821994953125Z",fill:"currentColor"},null,-1),a("path",{d:"M13.494271269116211,7.780713078125L10.88421248911621,7.780713078125C10.57542323911621,7.780713078125,10.325521469116211,7.530810828125,10.325521469116211,7.222021578125C10.325521469116211,6.913232328125,10.575424199116211,6.663330078125,10.88421248911621,6.663330078125L13.49441816911621,6.663330078125C13.803207369116212,6.663330078125,14.053109169116212,6.913232328125,14.053109169116212,7.222021578125C14.053109169116212,7.530810828125,13.803206469116212,7.780713078125,13.494271269116211,7.780713078125Z",fill:"currentColor"},null,-1)])])}const Ea=he(Sa,[["render",Ra]]),Ia={},Va={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"currentColor",version:"1.1",width:"24",height:"24",viewBox:"0 0 24 24"};function Ua(Z,u){return n(),v("svg",Va,[...u[0]||(u[0]=[a("defs",null,[a("clipPath",{id:"master_svg0_2_5670"},[a("rect",{x:"0",y:"0",width:"24",height:"24",rx:"0"})])],-1),a("g",{"clip-path":"url(#master_svg0_2_5670)"},[a("path",{d:"M11.98718775,0.5301513671875C5.64921855,0.5301513671875,0.51171875,5.6620268671875,0.51171875,11.9931983671875C0.51171875,18.3243713671875,5.64921905,23.4562453671875,11.98718775,23.4562453671875C18.32515675,23.4562453671875,23.46242175,18.3243713671875,23.46242175,11.9931983671875C23.46242175,5.6620273671875,18.32492275,0.5301513671875,11.98718775,0.5301513671875ZM4.96414045,10.2084340671875C4.96156215,10.2039804671875,4.96156215,10.1969499671875,4.95874975,10.1917934671875L4.95171885,10.1636676671875C4.95171885,10.1582765671875,4.94914055,10.1538238671875,4.94914055,10.1496057671875L4.94210915,10.1186675671875C4.94210915,10.1116361671875,4.93953135,10.1071824671875,4.93953135,10.1027307671875C4.93765595,10.0928859671875,4.93765595,10.0806989671875,4.93507765,10.0717925671875C4.93507765,10.0647611671875,4.93226525,10.0593700671875,4.93226525,10.0523395671875C4.93226525,10.0436677671875,4.92968705,10.0338239671875,4.92968705,10.0242137671875C4.92804675,10.0181197671875,4.92804675,10.0082769671875,4.92804675,10.0005416671875L4.92804675,10.0014800671875C4.92804675,9.9944486671875,4.92546845,9.9874172671875,4.92804675,9.9749955671875C4.92546845,9.9609327671875,4.92546845,9.9440574671875,4.92546845,9.9281205671875C4.92546845,9.9114799671875,4.92804675,9.8971824671875,4.92804675,9.8805427671875L4.92968705,9.8575734671875L4.93226525,9.8336677671875C4.93226525,9.8240575671875,4.93226525,9.8142137671875,4.93507765,9.8055419671875C4.93507765,9.7985114671875,4.93765595,9.7931203671875,4.93765595,9.7860889671875C4.93789005,9.7760114671875,4.93953135,9.7659330671875,4.94210915,9.7560891671875C4.94210915,9.7481202671875,4.94468685,9.7436675671875,4.94468685,9.7394485671875L4.95171885,9.7087449671875C4.95171885,9.7033548671875,4.95171885,9.6989021671875,4.95429655,9.6946830671875L4.96132805,9.6665572671875C4.96390625,9.6621045671875,4.96390625,9.6550731671875,4.96648455,9.6506204671875C4.96812485,9.6426515671875,4.97351555,9.6330423671875,4.97609375,9.6241359671875L4.98312475,9.6046829671875C4.98570295,9.5976524671875,4.99015665,9.5887460671875,4.99203105,9.5817146671875L5.00093745,9.5606202671875C5.00257875,9.5535898671875,5.00703145,9.5465583671875,5.00960925,9.5392923671875C5.01148465,9.5322608671875,5.01499985,9.5226516671875,5.02015635,9.5153856671875C5.02460955,9.5102300671875,5.02624985,9.5029640671875,5.02906275,9.4994487671875C5.03164105,9.4889020671875,5.03609375,9.4818706671875,5.04148435,9.4729642671875C5.04546925,9.4689798671875,5.04875045,9.4640579671875,5.05109405,9.4589023671875C5.05554725,9.4490575671875,5.06093785,9.4422616671875,5.06609395,9.4324168671875C5.06984425,9.4284324671875,5.07265665,9.4239806671875,5.07500075,9.4192924671875C5.08015635,9.4094476671875,5.08742235,9.4017143671875,5.09257885,9.3928079671875C5.09445335,9.3876514671875,5.09960985,9.3829641671875,5.10242225,9.3787450671875L5.12187575,9.3522605671875L5.13335995,9.3381976671875C5.13875005,9.3311672671875,5.14296965,9.3241357671875,5.15023465,9.3171043671875C5.15539125,9.3100738671875,5.16265675,9.3056201671875,5.16781285,9.2985887671875C5.17296935,9.2941360671875,5.17765665,9.2861671671875,5.18187575,9.2819480671875L5.21632905,9.2465572671875L7.54226685,6.9857764671875C7.93437625,6.6081976671875,8.55547045,6.6081976671875,8.94757935,6.9857764671875C9.33593845,7.3631200671875,9.33593845,7.9734315671875,8.94757935,8.350776167187501L8.316407250000001,8.9636659671875L17.99820675,8.9636659671875C18.54898875,8.9636659671875,18.99289175,9.3974952671875,18.99289175,9.9299945671875C18.99289175,10.4653081671875,18.54617275,10.8972593671875,17.99820675,10.8972593671875L5.91476535,10.8972593671875C5.90070295,10.8972593671875,5.88382765,10.8944483671875,5.86624955,10.8944483671875L5.84515615,10.8918693671875L5.82031205,10.8902293671875C5.81046865,10.8904633671875,5.80062485,10.8897613671875,5.79124925,10.8876523671875C5.78421835,10.8876523671875,5.77882765,10.8850733671875,5.77179675,10.8850733671875C5.76148365,10.8846053671875,5.75093695,10.8831993671875,5.74085855,10.8806203671875C5.73289015,10.8806203671875,5.72843695,10.8780433671875,5.72304635,10.8780433671875L5.69210865,10.8710123671875C5.68414025,10.8691363671875,5.67968655,10.8691363671875,5.67453055,10.8665593671875L5.64640565,10.8595283671875C5.64101505,10.8569493671875,5.63328075,10.8569493671875,5.62859345,10.8541373671875L5.60210895,10.8454643671875L5.58265545,10.8374963671875L5.55781225,10.8285903671875L5.53671835,10.8215593671875L5.51468705,10.8117153671875C5.50765605,10.8098403671875,5.49804595,10.8072623671875,5.49078085,10.8018713671875C5.48562435,10.7974173671875,5.47835925,10.7957773671875,5.47320275,10.7931983671875C5.46429635,10.7906213671875,5.45539045,10.7861683671875,5.44671825,10.7807773671875C5.44226455,10.7770283671875,5.43710895,10.7739803671875,5.43171835,10.7718713671875L5.40523385,10.7578083671875C5.40078025,10.7540583671875,5.39562415,10.7510113671875,5.39023395,10.7491373671875C5.38132715,10.7437453671875,5.37335875,10.7367153671875,5.36374905,10.7313243671875C5.35835885,10.7294493671875,5.35413935,10.7242933671875,5.34968665,10.7226523671875L5.32320215,10.7031993671875L5.30820225,10.6926513671875L5.28617045,10.6750733671875C5.27913955,10.6706213671875,5.27468585,10.6635893671875,5.26765535,10.6591363671875L5.25007725,10.6450743671875C5.23859265,10.6326523671875,5.22617105,10.6237463671875,5.21374895,10.6115583671875C5.20132685,10.6000743671875,5.19171765,10.5876523671875,5.18023345,10.5764013671875C5.17507695,10.5719503671875,5.17038965,10.5649183671875,5.16617055,10.5595273671875C5.16077995,10.5524963671875,5.15281155,10.5480433671875,5.14859245,10.5410113671875C5.14320185,10.5339803671875,5.13617085,10.5269489671875,5.13171765,10.5196838671875L5.11929555,10.5056199671875C5.11226465,10.4969491671875,5.10429575,10.4889802671875,5.09913925,10.4791364671875C5.09749885,10.4746827671875,5.09281115,10.4704637671875,5.09023285,10.4660119671875C5.08507725,10.4564018671875,5.07781125,10.4484338671875,5.07265475,10.4395265671875C5.06820205,10.4343700671875,5.06562375,10.4299173671875,5.06374835,10.4254646671875L5.04874845,10.3999175671875L5.03913925,10.3849172671875C5.03656105,10.3762445671875,5.03210835,10.3689794671875,5.02671765,10.3603086671875C5.02226405,10.3551521671875,5.01968575,10.3481206671875,5.01710795,10.3427305671875C5.01546715,10.3356981671875,5.01007655,10.3267926671875,5.00749825,10.3197612671875C5.00562335,10.3127298671875,5.00046735,10.3056983671875,4.99765495,10.2986669671875L4.99062345,10.2766351671875L4.98077965,10.2527293671875L4.97374865,10.2351512671875C4.96859215,10.2269487671875,4.96671675,10.2173385671875,4.96414045,10.2084340671875ZM19.04609675,14.1032773671875L19.04445275,14.1271843671875L19.04187375,14.1510903671875C19.04187375,14.1599973671875,19.04187375,14.1696063671875,19.03929875,14.1792153671875C19.03929875,14.1862473671875,19.03648375,14.1906993671875,19.03648375,14.1977323671875C19.03625075,14.2080433671875,19.03461075,14.2185903671875,19.03203175,14.2286693671875C19.03203175,14.2356993671875,19.02945675,14.2401533671875,19.02945675,14.2446073671875L19.02242275,14.2755433671875C19.02242275,14.2809333671875,19.02242275,14.2851533671875,19.01984375,14.2896063671875L19.01281775,14.3177313671875C19.01000175,14.3231213671875,19.01000175,14.3301543671875,19.00742575,14.3346043671875C19.00554875,14.3425743671875,19.00039275,14.3512463671875,18.99781375,14.3601523671875C18.99594075,14.3681233671875,18.99336275,14.3725753671875,18.99078575,14.3796063671875L18.98187975,14.4035133671875L18.97320775,14.4246073671875C18.97156475,14.4316383671875,18.96688075,14.4389043671875,18.96430175,14.4459343671875C18.96242475,14.4529653671875,18.95914475,14.4618733671875,18.95375275,14.4689023671875C18.94930275,14.4740593671875,18.94765875,14.4813263671875,18.94507975,14.4855443671875C18.94226875,14.4944503671875,18.93805075,14.5021853671875,18.93265875,14.5120283671875C18.92820775,14.5164823671875,18.92562875,14.5209363671875,18.92281675,14.5251533671875C18.91836175,14.5347613671875,18.91320775,14.5427313671875,18.90781575,14.5516383671875C18.90336275,14.5567933671875,18.90078375,14.5614823671875,18.89891075,14.5656993671875C18.89375275,14.5746073671875,18.88648575,14.5823413671875,18.88133275,14.5921853671875C18.87945575,14.5966383671875,18.87429775,14.6010913671875,18.87148675,14.6053093671875C18.86445575,14.6149173671875,18.86000275,14.6228873671875,18.85203575,14.6317953671875L18.84054975,14.6458563671875C18.83515975,14.6528873671875,18.83070575,14.6599173671875,18.82273875,14.6671833671875C18.81570475,14.6742143671875,18.81125275,14.6812453671875,18.80328375,14.6882773671875C18.79812575,14.6927313671875,18.79367475,14.7007003671875,18.78922275,14.7049183671875L18.75476875,14.7403103671875L16.427895749999998,17.0010913671875C16.04047375,17.3784353671875,15.41281575,17.3784353671875,15.02445875,17.0010913671875C14.63609675,16.6237483671875,14.63609675,16.013435367187498,15.02445875,15.6360923671875L15.65469375,15.0232003671875L5.97031685,15.0232003671875C5.42047305,15.0232003671875,4.97633215,14.5893723671875,4.97633215,14.0568723671875C4.97633215,13.5215593671875,5.42305085,13.0896063671875,5.97031685,13.0896063671875L18.05656775,13.0896063671875C18.07062875,13.0896063671875,18.08750375,13.0921853671875,18.10508175,13.0921853671875C18.11211375,13.0921853671875,18.11914475,13.0947613671875,18.12711375,13.0947613671875L18.15101975,13.0966373671875C18.16086175,13.0966373671875,18.17141175,13.0966373671875,18.18008375,13.0992153671875C18.18711275,13.0992153671875,18.19250475,13.1020283671875,18.19953575,13.1020283671875C18.20985075,13.1022623671875,18.22039375,13.1039033671875,18.23047675,13.1064803671875C18.23937975,13.1064803671875,18.24383175,13.1090593671875,18.24828675,13.1090593671875L18.27922475,13.1160893671875C18.28789475,13.1177303671875,18.29235075,13.1177303671875,18.29680275,13.1205433671875L18.32586275,13.1275743671875C18.33125275,13.1303863671875,18.33828775,13.1303863671875,18.34367775,13.1329643671875L18.37016275,13.1416363671875L18.38867975,13.1496053671875L18.41352075,13.1585113671875L18.43555475,13.1655423671875L18.45664575,13.1751513671875C18.46461475,13.1770263671875,18.47422375,13.1796043671875,18.48055275,13.1849943671875C18.48570975,13.1894483671875,18.49391175,13.1910883671875,18.49813075,13.1936663671875C18.50797275,13.1964783671875,18.51594575,13.2006983671875,18.52461575,13.2060893671875C18.52906775,13.2098383671875,18.53422575,13.2128853671875,18.53961575,13.2149953671875L18.56610075,13.2290573671875C18.57149075,13.2335103671875,18.57570875,13.2360883671875,18.58110075,13.2379633671875C18.59000775,13.2431193671875,18.59797675,13.2503863671875,18.60758575,13.2555413671875C18.61203775,13.2574163671875,18.61742775,13.2625723671875,18.62258575,13.2644483671875L18.64907075,13.2839023671875L18.66336775,13.2944483671875C18.67039675,13.2996043671875,18.67836775,13.3049953671875,18.68539775,13.3120273671875C18.69242875,13.3164793671875,18.69781875,13.3235113671875,18.70391475,13.3279633671875L18.72149275,13.3420263671875L18.75781975,13.3755413671875L18.79227075,13.4109323671875C18.79766075,13.4153853671875,18.80211675,13.4224173671875,18.80633175,13.4275733671875C18.81172175,13.4346053671875,18.81875575,13.4390573671875,18.82297475,13.4460883671875L18.84078975,13.4674153671875L18.85227175,13.4814783671875C18.86024075,13.4903843671875,18.86727175,13.4981203671875,18.87242875,13.5079623671875C18.87430175,13.5124163671875,18.87945775,13.5168693671875,18.88133475,13.5210883671875C18.88648975,13.5309303671875,18.89375675,13.5386663671875,18.89891275,13.5475723671875C18.90289475,13.5515563671875,18.90617775,13.5564783671875,18.90851975,13.5616353671875C18.91297575,13.5714773671875,18.91836575,13.5782743671875,18.92351875,13.5871823671875C18.92797475,13.5923373671875,18.92961475,13.5970253671875,18.93242675,13.6021813671875C18.93500475,13.6110883671875,18.93946075,13.6181193671875,18.94484875,13.6267913671875C18.94930275,13.6319473671875,18.95188175,13.6392143671875,18.95445975,13.6443693671875L18.96430175,13.6673373671875C18.96688075,13.6743683671875,18.97133275,13.6813993671875,18.97320775,13.6884313671875L18.98187975,13.7104633671875L18.99078575,13.7343703671875L18.99875675,13.7519483671875C19.00320775,13.7601503671875,19.00601975,13.7690573671875,19.00742675,13.7784323671875C19.01000575,13.7828853671875,19.01000575,13.7899163671875,19.01281775,13.7950733671875L19.01984775,13.8231993671875C19.01984775,13.8285893671875,19.01984775,13.8328073671875,19.02242675,13.8374943671875L19.02945675,13.8684333671875C19.02945675,13.8754643671875,19.03203575,13.8799183671875,19.03203575,13.8843693671875C19.03461475,13.8942133671875,19.03461475,13.9064013671875,19.03648775,13.9153083671875C19.03648775,13.9223393671875,19.03929875,13.9277313671875,19.03929875,13.9347623671875C19.03929875,13.9434323671875,19.04187775,13.9532763671875,19.04187775,13.9628873671875C19.04445675,13.9699183671875,19.04445675,13.9788233671875,19.04445675,13.9858563671875C19.04609675,13.9954633671875,19.04609675,14.0024953671875,19.04609675,14.0095273671875C19.04867575,14.0235893671875,19.04867575,14.0395283671875,19.04867575,14.0571073671875C19.04891175,14.0725733671875,19.04609675,14.0866373671875,19.04609675,14.1032773671875Z",fill:"currentColor","fill-opacity":"1"})],-1)])])}const l1=he(Ia,[["render",Ua]]),Pa=(Z,u)=>{let L;const k=p(!1);let V=0;const C=[],A=m=>{C.push(m)},f=m=>{C.splice(C.indexOf(m),1)},S=[],Y=m=>{S.push(m)},g=m=>{S.splice(S.indexOf(m),1)},R=new Worker(new URL("/fastmovie/assets/loadStream-VwtzPW3F.js",import.meta.url),{type:"module"});R.onmessage=m=>{const w=m.data;switch(w.type){case"stop":k.value=!1;break;case"play":V=w.index,k.value=!0;const U=ee[V];ge(U),S.forEach(O=>O(U));break;case"currentTime":C.forEach(O=>O(w.currentTime||0));break}},R.onerror=m=>{console.log("worker error",m)};const z=[],ge=m=>{const w=m.dialogue_audio,U=(F=0)=>{const te=w[F];if(te){const ye=new Audio;ye.src=te,ye.play();const ie=z.push(ye);ye.addEventListener("ended",()=>{F++,z.splice(ie-1,1),k.value&&U(F)})}};U(0);const O=m.narration_audio;if(O){const F=new Audio;F.src=O,F.play();const te=z.push(F);F.addEventListener("ended",()=>{z.splice(te-1,1)})}const D=m.sfx_audio;if(D){const F=new Audio;F.src=D,F.play();const te=z.push(F);F.addEventListener("ended",()=>{z.splice(te-1,1)})}};let ee=[];const se=async(m,w)=>{w&&(V=m.findIndex(O=>O.id===w.id)||0),ee=[];const U=m.length;for(let O=0;O<U;O++){const D=m[O],F={id:D.id,video:D.video,image:D.image,use_material_type:D.use_material_type,duration:D.duration,dialogue_audio:[],narration:D.narration,narration_audio:D.narration_audio,sfx_audio:D.sfx_audio,dialogues:[]};if(D.dialogues)for(const te of D.dialogues)F.dialogue_audio.push(te.audio),F.dialogues.push({start_time:te.start_time,end_time:te.end_time,content:te.actor.name+":"+te.content});ee.push(F)}L?R.postMessage({type:"load",TrackResource:ee,index:V}):(L=Z.value.transferControlToOffscreen(),L.width=u.value.clientWidth,L.height=u.value.clientHeight,R.postMessage({type:"load",offscreen:L,TrackResource:ee,index:V},[L]))};Nt(()=>{R.postMessage({type:"resize",size:{width:u.value.clientWidth,height:u.value.clientHeight}})},300);const x=m=>{if(m){const w=ee.findIndex(U=>U.id===m.id);w!==-1&&(V=w)}R.postMessage({type:"play",index:V}),k.value=!0},N=()=>{k.value=!1,R.postMessage({type:"pause"}),z.forEach(m=>{m.pause()}),z.splice(0,z.length)},r=m=>{R.postMessage({type:"seek",time:m})},d=()=>{R.postMessage({type:"stop"}),k.value=!1,z.forEach(m=>{m.pause()}),z.splice(0,z.length)};return{isPlaying:k,play:x,pause:N,stop:d,parseTrackResource:se,destroy:()=>{d(),R.terminate(),L=void 0},seek:r,onCurrentTime:A,offCurrentTime:f,onSwitchToNextClip:Y,offSwitchToNextClip:g,switchClip:m=>{const w=ee.findIndex(U=>U.id===m.id);w!==-1&&(V=w),R.postMessage({type:"switchClip",index:V})}}};class Aa{combinator;tracks;width;height;durationUs=0;cancelRef=!1;clips=[];sprites=[];constructor(u=1280,L=720,k="#000"){this.width=u,this.height=L,this.combinator=new xt({width:u,height:L,bgColor:k})}setTracks(u){return this.tracks=u,this}async initializationDialogues(){if(this.cancelRef)return;this.events.dialogues?.(0);const u=[],L=this.tracks.dialogues.length;for(let C=0;C<L;C++){if(this.cancelRef)return;const A=this.tracks.dialogues[C];u.push({text:A.text,start:A.startTimeUs,end:A.endTimeUs})}if(this.cancelRef)return;const k=new bt(u,{videoWidth:this.width,videoHeight:this.height,fontSize:24,fontFamily:"Noto Sans SC",strokeStyle:"#000",lineWidth:2,lineJoin:"round",lineCap:"round",bottomOffset:100});this.clips.push(k);const V=new Ue(k);V.time.offset=0,V.time.duration=this.durationUs,this.sprites.push(V),!this.cancelRef&&(await this.combinator.addSprite(V),this.events.dialogues?.(100))}narrationStyle=`
    font-size: 20px; 
  font-weight:600;
    color: white;
    -webkit-text-stroke: 1px #000;
    writing-mode: vertical-lr;
  text-orientation: upright;
  white-space:wrap;
  padding:10px;`;async initializationNarrations(){if(this.cancelRef)return;this.events.narrations?.(0),this.narrationStyle=`
        height:${this.height/2}px;
        ${this.narrationStyle}`;const u=this.tracks.narrations.length;for(let L=0;L<u;L++){if(this.cancelRef)return;const k=this.tracks.narrations[L],V=new fo(await Lt(k.text,this.narrationStyle));if(this.clips.push(V),await V.ready,this.cancelRef)return;const C=new Ue(V);if(C.time.offset=k.startTimeUs,C.time.duration=k.endTimeUs-k.startTimeUs,this.sprites.push(C),this.cancelRef)return;await this.combinator.addSprite(C),this.events.narrations?.(L/u*100)}this.events.narrations?.(100)}events={video:()=>{},dialogues:()=>{},dialogues_audio:()=>{},narrations:()=>{},narrations_audio:()=>{}};on(u,L){this.events[u]=L}off(u){delete this.events[u]}async initialization(){if(this.cancelRef)return;let u,L;this.events.video?.(0);const k=this.tracks.video.length;for(let A=0;A<k;A++){if(this.cancelRef)return;const f=this.tracks.video[A];if(f.type==="video"?(L=new kt(f.stream),this.clips.push(L),u=new Ue(L),u.time.offset=f.offsetUs,u.time.duration=f.durationUs):(L=new fo(f.stream),this.clips.push(L),u=new Ue(L),u.time.offset=f.offsetUs,u.time.duration=f.durationUs),this.sprites.push(u),this.durationUs+=f.durationUs,this.cancelRef)return;await this.combinator.addSprite(u),this.events.video?.(A/k*100)}if(this.cancelRef)return;this.events.dialogues_audio?.(0);const V=this.tracks.dialogues_audio.length;for(let A=0;A<V;A++){if(this.cancelRef)return;const f=this.tracks.dialogues_audio[A];if(L=new _o(f.stream),this.clips.push(L),await L.ready,this.cancelRef||(u=new Ue(L),u.time.offset=f.offsetUs,u.time.duration=L.meta.duration,this.sprites.push(u),this.cancelRef))return;await this.combinator.addSprite(u),this.events.dialogues_audio?.(A/V*100)}if(this.cancelRef)return;this.events.narrations_audio?.(0);const C=this.tracks.narrations_audio.length;for(let A=0;A<C;A++){if(this.cancelRef)return;const f=this.tracks.narrations_audio[A];if(L=new _o(f.stream),this.clips.push(L),await L.ready,this.cancelRef||(u=new Ue(L),u.time.offset=f.offsetUs,u.time.duration=L.meta.duration,this.sprites.push(u),this.cancelRef))return;await this.combinator.addSprite(u),this.events.narrations_audio?.(A/C*100)}this.cancelRef||(await this.initializationDialogues(),!this.cancelRef&&(await this.initializationNarrations(),this.cancelRef))}OutputProgress(u){this.combinator.on("OutputProgress",L=>{u(L*100)})}async export(u){this.cancelRef||await this.combinator.output().pipeTo(u)}destroy(){if(this.clips.forEach(u=>{try{u&&typeof u.destroy=="function"&&u.destroy()}catch(L){console.warn("销毁 clip 时出错:",L)}}),this.clips=[],this.sprites.forEach(u=>{try{u&&typeof u.destroy=="function"&&u.destroy()}catch(L){console.warn("销毁 sprite 时出错:",L)}}),this.sprites=[],this.combinator)try{this.combinator.destroy()}catch(u){console.warn("销毁 combinator 时出错:",u)}}cancel(){this.cancelRef=!0,this.destroy()}}const I={PROGRESS:"progress",SAVE_FILE:"saveFile",PARSE_RESOURCE:"parseResource",COMPLETE:"complete",VIDEO:"video",DIALOGUES:"dialogues",DIALOGUES_AUDIO:"dialogues_audio",NARRATIONS:"narrations",NARRATIONS_AUDIO:"narrations_audio",CANCEL:"cancel",UPLOAD_VIDEO:"uploadVideo"},$a=Z=>{const k=p(!1),V=[],C=p({[I.SAVE_FILE]:()=>{}}),A=async()=>{C.value[I.SAVE_FILE]?.();try{const x=await window.showSaveFilePicker({suggestedName:Z.output||"output.mp4",types:[{description:"MP4 Video",accept:{"video/mp4":[".mp4"]}}]});return{writable:await x.createWritable(),fileHandle:x}}catch(x){throw console.error("创建文件失败:",x),x}},f={video:[],dialogues:[],dialogues_audio:[],narrations:[],narrations_audio:[]};let S=null,Y=null;const g=()=>{if(V.forEach(x=>{try{x.abort()}catch(N){console.warn("取消网络请求时出错:",N)}}),V.length=0,S){try{S.destroy()}catch(x){console.warn("销毁 composer 时出错:",x)}S=null}if(Y){try{const x=Y.getWriter();x&&(x.abort().catch(()=>{}),x.releaseLock())}catch{try{Y&&typeof Y.abort=="function"&&Y.abort()}catch(N){console.warn("关闭文件流时出错:",N)}}Y=null}f.video=[],f.dialogues=[],f.dialogues_audio=[],f.narrations=[],f.narrations_audio=[]},R=async(x,N=1*1024*1024)=>{const r=Math.ceil(x.size/N);try{await E.post("/app/shortplay/api/drama/uploadChunkCheck",{drama_id:Z.drama_id,episode_id:Z.episode_id,fileName:Z.output||"output.mp4"}).then(d=>{if(d.code!=M.SUCCESS)throw new Error(d.msg)}).catch(d=>{throw console.error("分片上传检查出错:",d),d});for(let d=0;d<r;d++){if(k.value){C.value[I.CANCEL]?.();return}const H=d*N,j=Math.min(x.size,H+N),m=x.slice(H,j),w=new FormData;w.append("drama_id",Z.drama_id),w.append("episode_id",Z.episode_id),w.append("chunkIndex",d.toString()),w.append("totalChunks",r.toString()),w.append("chunkData",m),await E.post("/app/shortplay/api/drama/uploadChunk",w,{onUploadProgress:U=>{if(U.lengthComputable){const O=U.loaded/(U.total||1)*100,D=(d+O/100)/r*100;C.value[I.UPLOAD_VIDEO]?.(Math.round(D))}}}).catch(U=>{throw console.error("分片上传出错:",U),U})}await E.post("/app/shortplay/api/drama/mergeChunks",{totalChunks:r,drama_id:Z.drama_id,episode_id:Z.episode_id}),C.value[I.COMPLETE]?.(!0)}catch(d){console.error("上传失败:",d),k.value||C.value[I.COMPLETE]?.(!1)}},z=async(x,N,r)=>{Y=x;const d=r.length;let H=0;C.value[I.PARSE_RESOURCE]?.(0);try{for(let j=0;j<d;j++){if(k.value){C.value[I.CANCEL]?.(),g();return}const m=r[j];let w;if(m.use_material_type==="video"){const U=new AbortController;V.push(U);const O=await fetch(m.video,{signal:U.signal});if(k.value){g();return}w={type:"video",stream:O.body,offsetUs:H,durationUs:m.duration*1e3}}else if(m.image){const U=new AbortController;V.push(U);const O=await fetch(m.image,{signal:U.signal});if(k.value){g();return}w={type:"image",stream:O.body,offsetUs:H,durationUs:m.duration*1e3}}else{const U=new OffscreenCanvas(720,1280),O=U.getContext("2d");O.fillStyle="black",O.fillRect(0,0,720,1280),w={type:"image",stream:U.transferToImageBitmap(),offsetUs:H,durationUs:m.duration*1e3}}if(f.video.push(w),m.dialogues&&m.dialogues.length>0){for(const U of m.dialogues)if(f.dialogues.push({text:U.content,startTimeUs:H+U.start_time*1e3,endTimeUs:H+U.end_time*1e3}),U.audio){const O=new AbortController;V.push(O);const D=await fetch(U.audio,{signal:O.signal});if(k.value){g();return}const F={type:"audio",stream:D.body,trackId:"dialogue_audio",offsetUs:H+U.start_time*1e3};f.dialogues_audio.push(F)}}if(m.narration&&(f.narrations.push({text:m.narration,startTimeUs:H,endTimeUs:H+m.duration*1e3}),m.narration_audio)){const U=new AbortController;V.push(U);const O=await fetch(m.narration_audio,{signal:U.signal});if(k.value){g();return}const D={type:"audio",stream:O.body,trackId:"narration_audio",offsetUs:H};f.narrations_audio.push(D)}H+=m.duration*1e3,C.value[I.PARSE_RESOURCE]?.(j/d*100)}if(C.value[I.PARSE_RESOURCE]?.(100),C.value[I.PROGRESS]?.(0),k.value){C.value[I.CANCEL]?.(),g();return}try{if(S=new Aa(720,1280),S.setTracks(f),S.on(I.VIDEO,C.value[I.VIDEO]),S.on(I.DIALOGUES,C.value[I.DIALOGUES]),S.on(I.DIALOGUES_AUDIO,C.value[I.DIALOGUES_AUDIO]),S.on(I.NARRATIONS,C.value[I.NARRATIONS]),S.on(I.NARRATIONS_AUDIO,C.value[I.NARRATIONS_AUDIO]),await S.initialization(),k.value){g();return}if(S.OutputProgress(m=>{k.value||C.value[I.PROGRESS]?.(m)}),k.value){g();return}if(await S.export(x),k.value){g();return}S.destroy(),S=null,Y=null,V.length=0;const j=await N.getFile();C.value[I.UPLOAD_VIDEO]?.(0),R(j)}catch(j){k.value||C.value[I.COMPLETE]?.(!1),console.info(j),g()}}catch(j){k.value||C.value[I.COMPLETE]?.(!1),console.info(j),g()}};return{on:(x,N)=>{C.value[x]=N},off:x=>{delete C.value[x]},synthesis:x=>{k.value=!1,g(),A().then(({writable:N,fileHandle:r})=>{if(k.value){C.value[I.CANCEL]?.(),g();return}if(C.value[I.SAVE_FILE]?.(!0),k.value){C.value[I.CANCEL]?.(),g();return}z(N,r,x)}).catch(N=>{k.value||C.value[I.SAVE_FILE]?.(!1),console.info(N),g()})},cancel:()=>{k.value=!0,S&&S.cancel(),g(),C.value[I.CANCEL]?.()},cancelRef:k}},Ma={class:"flex flex-column draw-module"},za={class:"flex-1 flex grid-gap-10 overflow-hidden"},Da={class:"flex-1 flex flex-column grid-gap-10 overflow-hidden"},Oa={class:"flex grid-gap-2 flex-center",style:{height:"40px"}},Ba={class:"text-success"},Ta={class:"flex-1 flex overflow-hidden"},Na={class:"position-absolute bottom-0 left-0 right-0 flex z-index"},Ga={key:0,class:"w-100 h-100 overflow-hidden position-absolute z-index-10 top-0 left-0"},Fa=["src"],Za={class:"position-absolute top-1 right-1"},qa={key:0,class:"flex flex-column grid-gap-4 p-4 task-list"},Wa={key:0,class:"position-absolute top-0 left-0 p-2"},Ha=["onClick"],ja={class:"montage-storyboard rounded-4 border"},Ja={class:"montage-storyboard-list"},Qa=["onClick"],Ka={class:"flex montage-storyboard-list-item-title grid-gap-2"},Xa={class:"flex flex-center grid-gap-2"},Ya={class:"h10 flex-1"},es={class:"flex flex-column grid-gap-1 flex-center"},os={class:"flex"},ts={key:0,class:"flex flex-center grid-gap-2"},as={class:"montage-storyboard-list-item-toolbar flex-center"},ss=["onClick"],ls={class:"h10"},is={class:"flex flex-column grid-gap-4"},ns=["onClick"],rs=["onClick"],ds={class:"storyboard-form-wrapper bg-overlay border rounded-4"},cs={key:0,class:"storyboard-form flex flex-column grid-gap-4 p-4"},us={class:"flex flex-column grid-gap-2"},ps={class:"h10 text-info"},fs={class:"flex flex-column grid-gap-2"},_s={class:"bg rounded-4 p-4 border"},vs={class:"flex flex-y-center grid-gap-2"},gs={class:"h10 text-ellipsis-1",style:{"max-width":"60px"}},ms={class:"flex flex-center grid-gap-2"},hs={class:"h10"},ys={class:"flex grid-gap-2"},Cs={class:"flex flex-column grid-gap-2"},xs={class:"grid-columns-8 grid-gap-4"},bs={class:"flex flex-column grid-gap-2"},Ls={class:"flex grid-gap-2 flex-wrap"},ks={class:"flex flex-column grid-gap-2"},Ss={class:"flex grid-gap-2 flex-wrap"},ws={class:"flex flex-column h10 grid-gap-2"},Rs={key:0,class:"pointer text-warning"},Es={key:1,class:"pointer text-primary"},Is={class:"flex flex-column grid-gap-2"},Vs={class:"flex grid-gap-2 flex-wrap"},Us={class:"flex flex-column h10 grid-gap-2"},Ps={key:0,class:"pointer text-warning"},As={key:1,class:"pointer text-primary"},$s={key:0,class:"storyboard-form flex flex-column grid-gap-4 p-4"},Ms={class:"flex flex-column grid-gap-2 flex-y-flex-start"},zs={class:"h10 text-info"},Ds={class:"flex flex-center grid-gap-2 mt-4"},Os={class:"flex flex-column flex-center grid-gap-2"},Bs={class:"flex flex-column grid-gap-2"},Ts={class:"bg rounded-4 p-4 border"},Ns={class:"flex flex-y-center grid-gap-2"},Gs={class:"h10 text-ellipsis-1",style:{"max-width":"60px"}},Fs={class:"h10 text-ellipsis-1",style:{"max-width":"60px"}},Zs={class:"flex flex-center grid-gap-2"},qs={class:"h10"},Ws={class:"flex flex-column grid-gap-4 text-center"},Hs={key:0,class:"storyboard-form flex flex-column grid-gap-4 p-4"},js={key:0,class:"flex flex-column grid-gap-2"},Js=["onClick"],Qs={class:"flex flex-column grid-gap-2"},Ks={class:"bg rounded-4 p-4 border"},Xs={class:"flex flex-y-center grid-gap-2"},Ys={class:"flex flex-column grid-gap-2"},e5={class:"bg rounded-4 p-4 border"},o5={class:"flex flex-center grid-gap-2"},t5={class:"flex-1 flex flex-column grid-gap-2"},a5={class:"flex grid-gap-2"},s5={class:"bg-overlay h10 rounded-2 py-1 px-2"},l5={class:"bg-overlay h10 rounded-2 py-1 px-2"},i5={class:"flex grid-gap-10"},n5={class:"flex-1 flex flex-center mt-6 pointer grid-gap-2"},r5={class:"flex-1 text-info"},d5={class:"flex flex-column grid-gap-4"},c5=["onClick"],u5={class:"flex-1 flex flex-center mt-6 pointer grid-gap-2"},p5={class:"flex-1 text-info"},f5={class:"flex flex-column grid-gap-4"},_5=["onClick"],v5={key:1,class:"flex flex-center grid-gap-2"},g5={class:"flex flex-column grid-gap-2"},m5={class:"px-4 pb-4 flex flex-center grid-gap-4"},h5={class:"h10 text-info text-nowrap text-right",style:{width:"60px"}},y5={class:"flex flex-column grid-gap-2"},C5={class:"px-4 flex flex-center grid-gap-10"},x5={class:"h10 text-info text-nowrap text-right",style:{width:"60px"}},b5={class:"flex"},L5={class:"flex flex-center pointer px-4"},k5={class:"flex flex-column grid-gap-4"},S5={key:0},w5={key:1},R5={key:0},E5={key:1},I5={key:0},V5={key:1},U5={key:0,class:"hover-bg-hover rounded-4 p-2 text-info"},P5={key:0,class:"ml-1"},A5={key:1},$5={key:0,class:"storyboard-form flex flex-column grid-gap-4 p-4"},M5={class:"flex flex-column grid-gap-2"},z5={class:"bg rounded-4 p-4 border"},D5={class:"flex flex-y-center grid-gap-2"},O5={class:"flex flex-column grid-gap-2"},B5={class:"bg rounded-4 p-4 border"},T5={class:"flex flex-center grid-gap-2"},N5={class:"flex-1 flex flex-column grid-gap-2"},G5={class:"flex grid-gap-2"},F5={class:"bg-overlay h10 rounded-2 py-1 px-2"},Z5={class:"bg-overlay h10 rounded-2 py-1 px-2"},q5={class:"flex grid-gap-10"},W5={class:"flex-1 flex flex-center mt-6 pointer grid-gap-2"},H5={class:"flex-1 text-info"},j5={class:"flex flex-column grid-gap-4"},J5=["onClick"],Q5={class:"flex-1 flex flex-center mt-6 pointer grid-gap-2"},K5={class:"flex-1 text-info"},X5={class:"flex flex-column grid-gap-4"},Y5=["onClick"],el={key:1,class:"flex flex-center grid-gap-2"},ol={class:"flex flex-column grid-gap-2"},tl={class:"px-4 pb-4 flex flex-center grid-gap-4"},al={class:"h10 text-info text-nowrap text-right",style:{width:"60px"}},sl={class:"flex flex-column grid-gap-2"},ll={class:"px-4 flex flex-center grid-gap-10"},il={class:"h10 text-info text-nowrap text-right",style:{width:"60px"}},nl={key:0,class:"ml-1"},rl={key:1},dl={class:"flex flex-center grid-gap-2"},cl={class:"h10"},ul={class:"flex flex-center grid-gap-2"},pl={class:"h10"},fl=k1({__name:"index",emits:["update:drama"],setup(Z,{expose:u,emit:L}){const k=St(),V=Gt(),{USERINFO:C}=Ft(V),A=Zt(),f=p(k.params.drama_id),S=p(k.params.episode_id),Y=L,g=p({}),R=()=>{f.value&&E.get("/app/shortplay/api/Works/details",{params:{id:f.value}}).then(o=>{o.code===M.SUCCESS?(g.value=o.data,He.value=A.get("storyboard_narration_voice",g.value.voice?.model_id),Y("update:drama",g.value)):c.error(o.msg)}).catch(()=>{c.error("获取短剧详情失败")})},z=i1({type:"episode",name:"",drama_id:f.value,episode_id:S.value}),ge=p([]),ee=()=>{E.get("/app/shortplay/api/Scene/index",{params:{drama_id:f.value,episode_id:S.value}}).then(o=>{o.code===M.SUCCESS&&(ge.value=o.data)})},se=p([]),ce=()=>{r.value?.id&&E.get("/app/shortplay/api/Actor/index",{params:{type:"storyboard",drama_id:f.value,episode_id:S.value,storyboard_id:r.value?.id}}).then(o=>{o.code===M.SUCCESS&&(se.value=o.data)})},x=p([]),N=p(!1),r=p();vo(r,o=>{ie.value=void 0,o&&ce()});const d=p({drama_id:f.value,episode_id:S.value,storyboard_id:"",title:"",description:"",image_prompt:"",video_prompt:"",video_negative_prompt:"",duration:5e3,first_image:"",last_image:"",storyboard_location:"",storyboard_space:"",storyboard_time:"",storyboard_weather:"",model_id:null,video_model_id:null,storyboards:[]}),H=p(),j=p(),m=p(),w=p([]),U=o=>{j.value?.hide(),w.value.push({id:o.id,image:o.image}),d.value.storyboards.push(o.id)},O=o=>{w.value.splice(o,1),d.value.storyboards.splice(o,1)};vo(x,()=>{try{const o=x.value.find(e=>e.id===r.value?.id);o?Ce(o):(r.value=void 0,d.value={drama_id:f.value,episode_id:S.value,storyboard_id:"",title:"",description:"",image_prompt:"",video_prompt:"",video_negative_prompt:"",duration:5e3,first_image:"",last_image:"",storyboard_location:"",storyboard_space:"",storyboard_time:"",storyboard_weather:"",model_id:null}),me.parseTrackResource(x.value,r.value)}catch(o){console.error("watch storyboardList error",o)}});const D=()=>{N.value=!0,E.get("/app/shortplay/api/Storyboard/index",{params:z}).then(o=>{o.code===M.SUCCESS&&(x.value=o.data,!x.value.find(_=>_.id===r.value?.id)&&x.value.length>0&&Ce(x.value[0]),ee())}).catch(o=>{console.error("getStoryboardList error",o)}).finally(()=>{N.value=!1})},F=p([]),te=p(!1),ye=i1({alias_id:"",scenes:["storyboard_image","storyboard_video"],page:1,page_size:100}),ie=p();let Me=null;const ze=()=>{Me&&Me.abort(),Me=new AbortController,te.value=!0,F.value=[],E.get("/app/model/api/Task/index",{params:ye,signal:Me?.signal}).then(o=>{o.code===M.SUCCESS&&(F.value=o.data.data)}).catch(()=>{}).finally(()=>{te.value=!1})},Ce=o=>{r.value=o,d.value.storyboard_id=o.id,d.value.title=o.title,d.value.description=o.description,d.value.image_prompt=o.image_prompt,d.value.video_prompt=o.video_prompt,d.value.first_image=o.image,d.value.storyboard_location=o.storyboard_location,d.value.storyboard_space=o.storyboard_space,d.value.storyboard_time=o.storyboard_time,d.value.storyboard_weather=o.storyboard_weather,d.value.model_id=o.model_id,d.value.duration=o.duration,d.value.narration=o.narration,ye.alias_id=o.id,ze(),Se.value=[],xe.value==="dialogue"&&Fe(),me.stop(),me.switchClip(o)},V1=p(null),U1=p(null),fe=p({}),r1=o=>{o?fe.value=o:(fe.value={},d.value.model_id=null),V1.value?.hide()},ko=Le([fe]),P1=p(null),A1=p(null),_e=p({}),d1=o=>{o?_e.value=o:(_e.value={},d.value.video_model_id=null),P1.value?.hide()},So=Le([_e]),De=p(!1),wo=()=>{De.value||r.value.image_state||(De.value=!0,E.post("/app/shortplay/api/Generate/storyboardImage",{...d.value,prompt:d.value.image_prompt,model_id:fe.value.id}).then(o=>{o.code===M.SUCCESS?(r.value.image_state=1,ze()):c.error(o.msg)}).catch(()=>{c.error("生成图片失败")}).finally(()=>{De.value=!1}))},Oe=p(!1),Ro=()=>{Oe.value||r.value.video_state||(Oe.value=!0,E.post("/app/shortplay/api/Generate/storyboardVideo",{...d.value,prompt:d.value.video_prompt,negative_prompt:d.value.video_negative_prompt,first_image:d.value.first_image,last_image:d.value.last_image,duration:d.value.duration,model_id:_e.value.id}).then(o=>{o.code===M.SUCCESS?(c.success(o.msg),r.value.video_state=1,ze()):c.error(o.msg)}).catch(()=>{c.error("生成视频失败")}).finally(()=>{Oe.value=!1}))},c1=p(!1),Eo=o=>{c1.value||(c1.value=!0,E.post("/app/shortplay/api/Storyboard/ReplaceStoryboard",{id:r.value.id,drama_id:z.drama_id,episode_id:z.episode_id,task_id:o.id}).then(e=>{e.code===M.SUCCESS?D():c.error(e.msg)}).catch(()=>{c.error("替换分镜失败")}).finally(()=>{c1.value=!1}))},Re=p(!1),Be=p(!1),$1=p(0),Te=p([]),Io=()=>{Re.value=!0,Te.value=x.value.filter(o=>!o.image),$1.value=Te.value.length},Vo=Le([fe],$1),Uo=()=>{Be.value=!0,Promise.all(Te.value.map(o=>E.post("/app/shortplay/api/Generate/storyboardImage",{storyboard_id:o.id,drama_id:f.value,model_id:fe.value.id,prompt:o.image_prompt}))).then(()=>{D()}).catch(o=>{console.error("submitBatchGenerateImage error",o)}).finally(()=>{Be.value=!1,Re.value=!1})},Ee=p(!1),Ne=p(!1),M1=p(0),z1=p([]),Po=()=>{Ee.value=!0,z1.value=x.value.filter(o=>!o.video),M1.value=z1.value.length},Ao=Le([_e],M1),$o=()=>{Ne.value=!0,Promise.all(Te.value.map(o=>E.post("/app/shortplay/api/Generate/storyboardVideo",{storyboard_id:o.id,drama_id:f.value,model_id:_e.value.id,prompt:o.video_prompt,first_image:o.image}))).then(()=>{D()}).catch(o=>{console.error("submitBatchGenerateVideo error",o)}).finally(()=>{Ne.value=!1,Ee.value=!1})},{subscribe:Ie,unsubscribeAll:Mo}=Qt(),zo=()=>{Ie("private-generatestoryboardimage-"+C.value?.user,o=>{console.log("channels complete info message",o);const e=x.value.find(_=>_.id===o.id);e&&(e.image_state=0,o.image?(e.image=o.image,e.use_material_type="image"):c.error("生成图片失败"),e.id===r.value.id&&Ce(e))}),Ie("private-generatestoryboard-"+C.value?.user,o=>{console.log("channels complete info message",o);const e=x.value.find(_=>_.id===o.id);switch(o.event){case"storyboard_image":e&&(e.image_state=0,o.image?(e.image=o.image,e.use_material_type="image"):c.error("生成图片失败"),e.id===r.value.id&&Ce(e));break;case"storyboard_video":e&&(e.video_state=0,o.video?(e.video=o.video,e.use_material_type="video"):c.error("生成视频失败"),e.id===r.value.id&&Ce(e));break;case"storyboard_narration_voice":e&&(e.narration_state=0,o.audio?e.narration_audio=o.audio:c.error("生成旁白音频失败"));break;case"actor_costume":if(e){const _=se.value.find(B=>B.id===o.actor_id);_&&(o.image?_.headimg=o.image:(_.character_look_id=null,_.character_look_state=0,c.error("生成演员形象失败")))}break;case"actor_costume_three_view":if(e){const _=se.value.find(B=>B.id===o.actor_id);_&&(o.image?_.three_view_image=o.image:(_.character_look_id=null,c.error("生成演员形象失败")),_.character_look_state=0)}break;case"dialogue_voice":if(e){const _=Se.value.find(B=>B.id===o.dialogue_id);_&&(o.audio?_.audio=o.audio:c.error("生成对话音频失败"),_.voice_state=0)}break}}),Ie("private-generateactorimage-"+C.value?.user,o=>{console.log("channels complete info message",o);const e=se.value.find(_=>_.id===o.id);e&&(e.actor.status_enum=o.status,o.image?e.headimg=o.image:c.error("生成演员形象失败"))}),Ie("private-generateactorthreeviewimage-"+C.value?.user,o=>{console.log("channels complete info message",o);const e=se.value.find(_=>_.id===o.id);e&&(e.status_enum=o.status,o.image?e.three_view_image=o.image:c.error("生成演员形象失败"))}),Ie("private-generatepropimage-"+C.value?.user,o=>{console.log("channels complete info message",o);const e=r.value.props.find(_=>_.prop_id===o.id);e&&(e.prop.status_enum=o.status,o.image?e.prop.image=o.image:c.error("生成物品失败"))}),Ie("private-generatepropthreeviewimage-"+C.value?.user,o=>{console.log("channels complete info message",o);const e=r.value.props.find(_=>_.prop_id===o.id);e&&(e.prop.status_enum=o.status,o.image?e.prop.three_view_image=o.image:c.error("生成物品失败"))})},Do=o=>{E.post("/app/shortplay/api/Storyboard/insertAfter",{drama_id:o.drama_id,episode_id:o.episode_id,after_id:o?.id}).then(e=>{if(e.code===M.SUCCESS){if(o){const _=x.value.findIndex(B=>B.id===B.id);x.value.splice(_+1,0,e.data)}else x.value.push(e.data);x.value.sort((_,B)=>_.sort-B.sort).forEach(_=>{_.sort>=e.data.sort&&_.id!==e.data.id&&_.sort++}),Ce(e.data)}else c.error(e.msg)}).catch(()=>{c.error("插入失败")})},Oo=o=>{E.post("/app/shortplay/api/Storyboard/deleteStoryboard",{id:o.id,drama_id:o.drama_id,episode_id:o.episode_id}).then(e=>{e.code===M.SUCCESS?(c.success("删除成功"),D()):c.error(e.msg)}).catch(()=>{c.error("删除失败")})},D1=(o,e)=>{if(e===void 0||e<1||e>x.value.length)return;const _=x.value,B=JSON.parse(JSON.stringify(x.value)),oe=_.sort((W,Q)=>W.sort-Q.sort),ue=oe.findIndex(W=>W.id===o.id);if(ue===-1)return;const h=oe.findIndex(W=>W.sort===e);if(h===-1)return;const q=oe.splice(ue,1)[0];oe.splice(h,0,q),oe.forEach((W,Q)=>{W.sort=Q+1}),x.value=_.map(W=>oe.find(re=>re.id===W.id)??W),E.post("/app/shortplay/api/Storyboard/updateSort",{drama_id:o.drama_id,episode_id:o.episode_id,storyboards:oe.map(W=>({id:W.id,sort:W.sort}))}).then(W=>{W.code!==M.SUCCESS&&(c.error(W.msg),x.value=B)}).catch(()=>{c.error("更新分镜失败"),x.value=B})},Bo=o=>{E.post("/app/shortplay/api/Storyboard/copyStoryboard",{drama_id:o.drama_id,episode_id:o.episode_id,copy_id:o.id,new_sort:o.sort+1}).then(e=>{e.code===M.SUCCESS?(D(),c.success("复制成功")):c.error(e.msg)}).catch(()=>{c.error("复制失败")})},O1=p(null),ve=p(!1),B1=o=>{if(ve.value=!1,o.code===M.SUCCESS)switch(o.data.dir_name){case"storyboard/image":r.value.image=o.data.url,E.post("/app/shortplay/api/Storyboard/update",{id:r.value.id,drama_id:z.drama_id,episode_id:z.episode_id,image:o.data.url}).then(e=>{e.code===M.SUCCESS?(D(),c.success("保存成功")):c.error(e.msg)});break;case"storyboard/video":r.value.video=o.data.url,E.post("/app/shortplay/api/Storyboard/update",{id:r.value.id,drama_id:z.drama_id,episode_id:z.episode_id,video:o.data.url}).then(e=>{e.code===M.SUCCESS?(D(),c.success("保存成功")):c.error(e.msg)});break}else c.error(o.msg);O1.value?.clearFiles()},T1=()=>{ve.value=!1,O1.value?.clearFiles()},xe=p("image"),N1=p(),G1=p(),To=o=>{G1.value?.hide(),E.post("/app/shortplay/api/Storyboard/joinActor",{drama_id:f.value,storyboard_id:r.value.id,actor_id:o.id}).then(e=>{e.code===M.SUCCESS?(c.success(e.msg),ce()):c.error(e.msg)})},u1=p(!1),p1=p([]),F1=p(0),Z1=(o,e)=>{e&&(p1.value=o,F1.value=p1.value.findIndex(_=>_===e),$t(()=>{u1.value=!0}))},No=o=>{E.post("/app/shortplay/api/Storyboard/deleteProp",{drama_id:f.value,storyboard_id:r.value.id,id:o.id}).then(e=>{e.code===M.SUCCESS?(c.success(e.msg),r.value=e.data):c.error(e.msg)}).catch(()=>{c.error("删除物品失败")})},q1=p(),W1=p(),Go=o=>{W1.value?.hide(),E.post("/app/shortplay/api/Storyboard/joinProp",{drama_id:f.value,storyboard_id:r.value.id,prop_id:o.id}).then(e=>{e.code===M.SUCCESS?(c.success(e.msg),r.value=e.data):c.error(e.msg)})},H1=p(),Pe=p({}),Fo=o=>{o.character_look_state||(Pe.value=o,H1.value?.open?.({actor:o}))},Zo=o=>{Pe.value.character_look_state=1;let e="/app/shortplay/api/Generate/characterLook";o.type==="actor"&&(e="/app/shortplay/api/Storyboard/CharacterLook"),E.post(e,{drama_id:f.value,episode_id:S.value,storyboard_id:r.value.id,actor_id:Pe.value.id,character_look_id:o.id,actor_costume_model_id:o.actor_costume_model_id,actor_costume_three_view_model_id:o.actor_costume_three_view_model_id}).then(_=>{_.code===M.SUCCESS?(c.success(_.msg),o.type==="actor"&&ce()):(c.error(_.msg),Pe.value.character_look_state=0)}).catch(()=>{c.error("应用形象失败"),Pe.value.character_look_state=0})},qo=o=>{E.post("/app/shortplay/api/Storyboard/deleteActor",{drama_id:f.value,storyboard_id:r.value.id,id:o.storyboard_actor_id}).then(e=>{e.code===M.SUCCESS?(c.success(e.msg),ce()):c.error(e.msg)}).catch(()=>{c.error("删除演员失败")})},Wo=o=>{E.post("/app/shortplay/api/Storyboard/update",{drama_id:f.value,episode_id:S.value,id:r.value.id,scene_id:o.id}).then(e=>{e.code===M.SUCCESS&&(c.success(e.msg),r.value=e.data)}).catch(()=>{c.error("更新分镜失败")})},j1=p(),J1=p(),Q1=p(),K1=p(),X1=p(),Y1=p(),Ho=o=>{d.value.first_image=o.image,J1.value?.hide()},jo=o=>{d.value.last_image=o.image,K1.value?.hide()},f1=p(),Se=p([]),Ge=p(!1),Fe=()=>{Ge.value||(Ge.value=!0,E.get("/app/shortplay/api/StoryboardDialogue/index",{params:{drama_id:f.value,storyboard_id:r.value.id}}).then(o=>{o.code===M.SUCCESS&&(Se.value=o.data,oo(Se.value[0]))}).catch(()=>{c.error("获取对话失败")}).finally(()=>{Ge.value=!1}))},y=p(),eo=p({}),oo=o=>{o?.voice&&(o.voice.selected_emotion=o.voice.emotions_enum.find(e=>e.value===o.emotion),eo.value=A.get("dialogue_voice",o.voice.model_id)),y.value=o},to=()=>{f1.value?.open(r.value)},Jo=()=>{f1.value?.open(r.value,y.value)},Qo=o=>{const e=r.value.dialogues.find(_=>_.id===o.id);e?Object.assign(e,o):r.value.dialogues.push(o)},_1=p(),we=(o,e)=>{y.value.voice=o,E.post("/app/shortplay/api/Actor/voice",{id:y.value.actor.id,dialogue_id:y.value.id,drama_id:f.value,episode_id:S.value,storyboard_id:r.value.id,scene_id:r.value.scene_id,apply_scope:"dialogue",voice:o,...e}).then(_=>{_.code===M.SUCCESS?c.success(_.msg):c.error(_.msg)}).catch(()=>{c.error("设置对话音色失败")})},Ko=()=>{C1.confirm("确定删除该对话吗？","提示",{title:"提示",message:"确定删除该对话吗？",beforeClose:(o,e,_)=>{o==="confirm"?(e.confirmButtonLoading=!0,e.cancelButtonLoading=!0,E.post("/app/shortplay/api/StoryboardDialogue/delete",{drama_id:f.value,storyboard_id:r.value.id,dialogue_id:y.value.id}).then(B=>{B.code===M.SUCCESS?(c.success("删除成功"),Fe(),_()):c.error(B.msg)}).catch(()=>{c.error("删除失败")}).finally(()=>{e.confirmButtonLoading=!1,e.cancelButtonLoading=!1})):_()}})},Ze=p(!1),v1=Le([eo]),Xo=()=>{Ze.value||(Ze.value=!0,E.post("/app/shortplay/api/Generate/storyboardDialogueVoice",{storyboard_id:r.value.id,dialogue_id:y.value.id,drama_id:f.value,prosody_volume:y.value.prosody_volume,prosody_speed:y.value.prosody_speed,emotion:y.value.emotion,voice:y.value.voice}).then(o=>{o.code===M.SUCCESS?(y.value.voice_state=!0,c.success(o.msg)):c.error(o.msg)}).catch(()=>{c.error("生成旁白失败")}).finally(()=>{Ze.value=!1}))},qe=p([]),Yo=async()=>{const o=Mt(),e=await E.get("/app/shortplay/api/StoryboardDialogue/index",{params:{drama_id:f.value,episode_id:S.value}});let _=0,B=0,oe=0,ue=0;if(e.code===M.SUCCESS){const W=e.data.length;for(let Q=0;Q<W;Q++){const re=e.data[Q];if(re.audio)oe++;else if(re.voice_state)_++;else if(!re.voice)B++;else{qe.value.push(re);const Ve=A.get("dialogue_voice",re.voice.model_id),Ke=Le([p(Ve)]);Ke.value!=="免费"&&(ue+=Ke.value)}}o.close()}else{o.close(),c.error(e.msg);return}if(qe.value.length===0){c.info("本集分镜已全部生成对话配音");return}const h=[G("span",{class:"h10"},"本次将生成"),G("span",{class:"h10 text-success"},qe.value.length),G("span",{class:"h10"},"条对话配音。")];h.push(G("span",{class:"h10"},"生成中"),G("span",{class:"h10 text-success"},_),G("span",{class:"h10"},"条。")),h.push(G("span",{class:"h10"},"无音色"),G("span",{class:"h10 text-success"},B),G("span",{class:"h10"},"条。")),h.push(G("span",{class:"h10"},"已生成"),G("span",{class:"h10 text-success"},oe),G("span",{class:"h10"},"条。")),ue&&h.push(G("span",{class:"h10"},"预计需要消耗"),G("span",{class:"h10 text-success"},ue),G("span",{class:"h10"},"积分。")),h.push(G("span",{class:"h10"},"是否继续？")),C1({title:"确定批量生成对话配音吗？",message:()=>G("div",{class:"flex grid-gap-2 flex-wrap"},h),confirmButtonText:"确定",confirmButtonClass:"el-button--success",beforeClose:(W,Q,re)=>{Q.confirmButtonLoading||(W==="confirm"?(Q.confirmButtonLoading=!0,Promise.all(qe.value.map(Ve=>E.post("/app/shortplay/api/Generate/storyboardDialogueVoice",{dialogue_id:Ve.id,storyboard_id:Ve.storyboard_id,drama_id:f.value}))).then(()=>{re()}).catch(()=>{c.error("批量生成对话配音失败")}).finally(()=>{Q.confirmButtonLoading=!1})):re())}}).then(()=>{Fe()}).catch(()=>{})},ao=p(),We=p(),He=p(),g1=Le([He]),m1=o=>{g.value.voice=o,He.value=A.get("storyboard_narration_voice",o.model_id),E.post("/app/shortplay/api/Drama/voice",{drama_id:f.value,voice:o}).then(e=>{e.code===M.SUCCESS?(c.success(e.msg),R()):c.error(e.msg)}).catch(e=>{console.error("handleVoiceSuccess error",e),c.error("设置旁白配音失败")})},je=p(!1),et=()=>{je.value||(je.value=!0,E.post("/app/shortplay/api/Generate/storyboardNarrationVoice",{storyboard_id:r.value.id,drama_id:f.value,prosody_volume:g.value.prosody_volume,prosody_speed:g.value.prosody_speed,narration:r.value.narration,voice:g.value.voice}).then(o=>{o.code===M.SUCCESS?(g.value.narration_state=!0,c.success(o.msg)):c.error(o.msg)}).catch(()=>{c.error("生成旁白失败")}).finally(()=>{je.value=!1}))},Ae=p([]),ot=()=>{if(!g.value.voice)return c.info("当前剧本尚未选择旁白音色，请先选择"),xe.value="narration",We.value?.open({modelScene:"storyboard_narration_voice",voice:g.value.voice});if(Ae.value=x.value.filter(B=>B.narration&&!B.narration_audio&&!B.narration_state),Ae.value.length===0){c.info("本集分镜已全部生成旁白");return}const o=Le([He],p(Ae.value.length)),e=[G("span",{class:"h10"},"本次将生成"),G("span",{class:"h10 text-success"},Ae.value.length),G("span",{class:"h10"},"条旁白。")];o.value!=="免费"&&e.push(G("span",{class:"h10"},"预计需要消耗"),G("span",{class:"h10 text-success"},o.value),G("span",{class:"h10"},"积分。")),e.push(G("span",{class:"h10"},"是否继续？")),C1({title:"确定批量生成旁白吗？",message:()=>G("div",{class:"flex grid-gap-2"},e),confirmButtonText:"确定",confirmButtonClass:"el-button--success",beforeClose:(B,oe,ue)=>{oe.confirmButtonLoading||(B==="confirm"?(oe.confirmButtonLoading=!0,Promise.all(Ae.value.map(h=>E.post("/app/shortplay/api/Generate/storyboardNarrationVoice",{storyboard_id:h.id,drama_id:f.value}))).then(()=>{ue()}).catch(()=>{c.error("批量生成旁白失败")}).finally(()=>{oe.confirmButtonLoading=!1})):ue())}}).then(()=>{D()}).catch(()=>{})},Je=o=>o===1?"正常":`${o}x倍速`,Qe=o=>o===0?"静音":o===100?"最大":o===50?"正常":o<50?`-${o}%`:`+${o}%`,tt=o=>{o==="dialogue"&&!Se.value.length&&Fe()},so=p(null),lo=p(null),me=Pa(so,lo),at=()=>{me.isPlaying.value?me.pause():me.play()};me.onSwitchToNextClip(o=>{r.value=x.value.find(e=>e.id===o.id),d.value.storyboard_id=r.value.id,d.value.title=r.value.title,d.value.description=r.value.description,d.value.image_prompt=r.value.image_prompt,d.value.video_prompt=r.value.video_prompt,d.value.first_image=r.value.image,d.value.storyboard_location=r.value.storyboard_location,d.value.storyboard_space=r.value.storyboard_space,d.value.storyboard_time=r.value.storyboard_time,d.value.storyboard_weather=r.value.storyboard_weather,d.value.model_id=r.value.model_id,d.value.duration=r.value.duration,d.value.narration=r.value.narration,ye.alias_id=r.value.id,ze()});const io=o=>{if(!o)return;new Audio(o).play()},T=Kt({title:"正在合成",tips:"请勿退出页面，否则合成会中断",list:[{title:"获取分镜中..."},{title:"选择保存位置..."},{title:"正在准备素材..."},{title:"正在解析视频素材..."},{title:"正在解析对话素材..."},{title:"正在解析对话音频素材..."},{title:"正在解析旁白素材..."},{title:"正在解析旁白音频素材..."},{title:"正在合成中..."},{title:"正在上传视频..."}],showCancelButton:!0,cancelButtonText:"取消合成",cancelButtonClick:()=>{ne.cancel(),T.close()}}),ne=$a({drama_id:f.value,episode_id:S.value,output:f.value+"_"+S.value+".mp4"});ne.on(I.SAVE_FILE,o=>{o===!0?T.xlLoadingRef.value?.setProgress(10):o===!1?T.close():T.xlLoadingRef.value?.setCurrentIndex(1)}),ne.on(I.PARSE_RESOURCE,o=>{T.xlLoadingRef.value?.setCurrentIndex(2);const e=15+o*15/100;T.xlLoadingRef.value?.setProgress(e)}),ne.on(I.VIDEO,o=>{T.xlLoadingRef.value?.setCurrentIndex(3);const e=30+o*10/100;T.xlLoadingRef.value?.setProgress(e)}),ne.on(I.DIALOGUES,o=>{T.xlLoadingRef.value?.setCurrentIndex(4);const e=40+o*5/100;T.xlLoadingRef.value?.setProgress(e)}),ne.on(I.DIALOGUES_AUDIO,o=>{T.xlLoadingRef.value?.setCurrentIndex(5);const e=45+o*5/100;T.xlLoadingRef.value?.setProgress(e)}),ne.on(I.NARRATIONS,o=>{T.xlLoadingRef.value?.setCurrentIndex(6);const e=50+o*5/100;T.xlLoadingRef.value?.setProgress(e)}),ne.on(I.NARRATIONS_AUDIO,o=>{T.xlLoadingRef.value?.setCurrentIndex(7);const e=50+o*5/100;T.xlLoadingRef.value?.setProgress(e)}),ne.on(I.PROGRESS,o=>{T.xlLoadingRef.value?.setCurrentIndex(8);const e=55+o*25/100;T.xlLoadingRef.value?.setProgress(e)}),ne.on(I.UPLOAD_VIDEO,o=>{T.xlLoadingRef.value?.setCurrentIndex(9);const e=80+o*20/100;T.xlLoadingRef.value?.setProgress(e)}),ne.on(I.COMPLETE,o=>{o===!0?(T.close(),c.success("合成成功")):(T.close(),c.error("合成失败"))});const st=async()=>{if(!await T.open())return;T.xlLoadingRef.value?.setCurrentIndex(0);const e=await E.get("/app/shortplay/api/Storyboard/index",{params:z});if(e.code===M.SUCCESS){if(ne.cancelRef.value)return;T.xlLoadingRef.value?.setProgress(5),ne.synthesis(e.data)}else T.close(),c.error(e.msg)},lt=()=>{c.info("打包下载功能暂未开放，敬请期待"),console.log("downloadPackage")};return xo(()=>{D(),R(),zo()}),wt(()=>{console.log("storyboards unmounted"),Mo(),me.destroy()}),u({BatchImage:Io,BatchVideo:Po,BatchAudio:Yo,BatchSFX:()=>{c.info("音效生成功能暂未开放，敬请期待")},BatchNarration:ot,compsite:st,downloadPackage:lt}),(o,e)=>{const _=Rt,B=zt,oe=K("VideoPlay"),ue=K("VideoPause"),h=w1,q=I1,W=K("Download"),Q=K("Close"),re=E1,Ve=K("ArrowLeftBold"),Ke=K("ArrowRightBold"),it=K("Delete"),nt=Et,rt=K("Microphone"),$e=K("Plus"),ae=It,Xe=S1,no=K("Top"),Ye=jt,dt=Ht,ct=ca,h1=sa,ut=Tt,e1=Vt,pt=K("DArrowRight"),ft=K("Clock"),_t=K("Check"),vt=Co,ro=K("Headset"),o1=K("ArrowDown"),t1=Ut,gt=K("More"),co=Bt,mt=Ot,ht=Pt,uo=At,yt=Dt,po=R1;return n(),v("div",Ma,[a("div",za,[a("div",Da,[a("div",Oa,[a("span",null,b(t(r)?.sceneFind?.title),1),a("span",Ba,"#"+b(t(r)?.sort),1),e[44]||(e[44]=a("div",{class:"flex-1"},null,-1)),t(d).storyboard_id&&t(xe)==="image"?(n(),P(B,{key:0,ref:"uploadImageRef",data:{dir_name:"storyboard/image",dir_title:"分镜图"},action:t(E).getCompleteUrl("app/shortplay/api/Uploads/upload"),headers:t(E).getHeaders(),accept:"image/jpeg,image/png",limit:1,type:"cover",disabled:t(ve),"before-upload":()=>(ve.value=!0,!0),"on-success":B1,"show-file-list":!1,"on-error":()=>{ve.value=!1,T1()}},{default:i(()=>[s(_,{size:"small",bg:"",text:"",icon:"UploadFilled",loading:t(ve)},{default:i(()=>[...e[42]||(e[42]=[a("span",null,"本地上传",-1)])]),_:1},8,["loading"])]),_:1},8,["action","headers","disabled","before-upload","on-error"])):$("",!0),t(d).storyboard_id&&t(xe)==="video"?(n(),P(B,{key:1,ref:"uploadImageRef",data:{dir_name:"storyboard/video",dir_title:"分镜视频"},action:t(E).getCompleteUrl("app/shortplay/api/Uploads/upload"),headers:t(E).getHeaders(),accept:"video/mp4,video/webm",limit:1,type:"cover",disabled:t(ve),"before-upload":()=>(ve.value=!0,!0),"on-success":B1,"show-file-list":!1,"on-error":()=>{ve.value=!1,T1()}},{default:i(()=>[s(_,{size:"small",bg:"",text:"",icon:"UploadFilled",loading:t(ve)},{default:i(()=>[...e[43]||(e[43]=[a("span",null,"本地上传",-1)])]),_:1},8,["loading"])]),_:1},8,["action","headers","disabled","before-upload","on-error"])):$("",!0)]),a("div",Ta,[a("div",{class:"flex-1 preview-image overflow-hidden position-relative",ref_key:"cvsWrapElWrapper",ref:lo},[a("canvas",{class:"w-100 h-100",ref_key:"cvsWrapEl",ref:so},null,512),a("div",Na,[s(h,{size:"30",onClick:at,class:"pointer"},{default:i(()=>[t(me).isPlaying.value?(n(),P(ue,{key:1})):(n(),P(oe,{key:0}))]),_:1})]),t(ie)?(n(),v("div",Ga,[t(ie).scene==="storyboard_image"?(n(),P(q,{key:0,src:t(ie).result.image_path,fit:"contain",shape:"square",class:"task-item-avatar bg-mosaic"},null,8,["src"])):$("",!0),t(ie).scene==="storyboard_video"?(n(),v("video",{key:1,src:t(ie).result.video_path,controls:"",class:"task-item-avatar",autoplay:"",muted:""},null,8,Fa)):$("",!0),a("div",Za,[s(_,{bg:"",text:"",onClick:e[0]||(e[0]=l=>Eo(t(ie)))},{default:i(()=>[s(h,null,{default:i(()=>[s(Jt)]),_:1}),e[45]||(e[45]=a("span",null,"替换",-1))]),_:1}),s(_,{bg:"",text:"",tag:"a",href:t(ie).result[t(ie).scene==="storyboard_image"?"image_path":"video_path"],target:"_blank",download:""},{default:i(()=>[s(h,null,{default:i(()=>[s(W)]),_:1}),e[46]||(e[46]=a("span",null,"下载",-1))]),_:1},8,["href"]),s(_,{bg:"",text:"",onClick:e[1]||(e[1]=l=>ie.value=null)},{default:i(()=>[s(h,null,{default:i(()=>[s(Q)]),_:1}),e[47]||(e[47]=a("span",null,"关闭",-1))]),_:1})])])):$("",!0)],512),s(re,{class:"task-list-scrollbar"},{default:i(()=>[t(F).length>0?(n(),v("div",qa,[(n(!0),v(X,null,le(t(F),l=>(n(),v("div",{class:pe(["task-item",{active:t(r).use_material_type==="image"&&l.result.image_path===t(r).image||t(r).use_material_type==="video"&&l.result.video_path===t(r).video}]),key:l.id},[s(q,{src:l.status==="success"?l.result.image_path:"",fit:"contain",shape:"square",class:"task-item-avatar"},{default:i(()=>[l.status!="success"?(n(),P(h,{key:0,size:"20",color:"var(--el-color-info)"},{default:i(()=>[s(t(be),{class:"circular"})]),_:1})):l.scene==="storyboard_image"?(n(),P(h,{key:1,size:"30"},{default:i(()=>[s(x1)]),_:1})):l.scene==="storyboard_video"?(n(),P(h,{key:2,size:"30"},{default:i(()=>[s(b1)]),_:1})):$("",!0)]),_:2},1032,["src"]),l.status==="success"&&l.result.image_path?(n(),v("div",Wa,[l.scene==="storyboard_image"?(n(),P(h,{key:0,size:"16"},{default:i(()=>[s(x1)]),_:1})):$("",!0),l.scene==="storyboard_video"?(n(),P(h,{key:1,size:"16"},{default:i(()=>[s(b1)]),_:1})):$("",!0)])):$("",!0),l.status==="success"&&(t(r).use_material_type==="image"&&l.result.image_path!==t(r).image||t(r).use_material_type==="video"&&l.result.video_path!==t(r).video)?(n(),v("div",{key:1,class:"flex flex-center grid-gap-2 task-item-replace pointer",onClick:J=>ie.value=l},null,8,Ha)):$("",!0)],2))),128))])):$("",!0)]),_:1})]),a("div",ja,[s(re,{ref:"videoScrollbarRef",class:"montage-storyboard-video montage-storyboard-scrollbar","x-scroll":"","y-scroll":!1,"wrap-class":"montage-storyboard-video-wrap"},{default:i(()=>[a("div",Ja,[(n(!0),v(X,null,le(t(x),l=>(n(),v("div",{class:pe(["montage-storyboard-list-item rounded-4",{active:l.id===t(r)?.id}]),key:l.id,onClick:J=>{Ce(l)}},[a("div",Ka,[a("div",Xa,[s(h,{class:"icon-button",onClick:J=>D1(l,l.sort-1),disabled:l.sort===1},{default:i(()=>[s(Ve)]),_:1},8,["onClick","disabled"]),s(h,{class:"icon-button",onClick:J=>D1(l,l.sort+1),disabled:l.sort===t(x).length},{default:i(()=>[s(Ke)]),_:1},8,["onClick","disabled"])]),a("span",Ya,"场景"+b(l.scene_id)+" - #"+b(l.sort),1),s(nt,{title:"确定删除该分镜吗？",placement:"bottom-end","confirm-button-type":"danger",teleported:!1,width:"fit-content",onConfirm:J=>Oo(l)},{reference:i(()=>[s(h,{class:"icon-button hover-show"},{default:i(()=>[s(it)]),_:1})]),_:1},8,["onConfirm"])]),n1((n(),P(q,{class:"montage-storyboard-list-item-image bg-mosaic",src:l.image,fit:["9:16","16:9"].includes(t(g).aspect_ratio)?"contain":"cover","element-loading-text":"生成中..."},{default:i(()=>[a("div",es,[a("div",os,[l.image_state?(n(),v("span",ts,[s(h,{size:"20"},{default:i(()=>[s(t(be),{class:"circular"})]),_:1}),e[48]||(e[48]=a("span",{class:"h10"},"生成中...",-1))])):$("",!0)])])]),_:2},1032,["src","fit"])),[[po,l.image_state&&l.image||l.video_state&&l.image]]),a("div",as,[a("span",{class:"flex flex-center grid-gap-2 p-2 pointer",onClick:ke(J=>{Ce(l),xe.value="dialogue"},["stop"])},[s(h,null,{default:i(()=>[s(rt)]),_:1}),e[49]||(e[49]=a("span",{class:"h10"},"配音",-1))],8,ss),e[50]||(e[50]=a("div",{class:"flex-1"},null,-1)),a("span",ls,b(t(qt)(l.duration)),1)]),s(ae,{placement:"top",teleported:!0,"popper-class":"episode-popover"},{reference:i(()=>[s(h,{class:pe(["montage-storyboard-list-item-plus",{active:t(r)?.id===l.id}])},{default:i(()=>[s($e)]),_:1},8,["class"])]),default:i(()=>[a("div",is,[a("span",{class:"flex flex-center grid-gap-2 p-2 pointer",onClick:ke(J=>Bo(l),["stop"])},[s(h,null,{default:i(()=>[s(_a)]),_:1}),e[51]||(e[51]=a("span",{class:"h10"},"复制分镜",-1))],8,ns),a("span",{class:"flex flex-center grid-gap-2 p-2 pointer",onClick:ke(J=>Do(l),["stop"])},[s(h,null,{default:i(()=>[s(ha)]),_:1}),e[52]||(e[52]=a("span",{class:"h10"},"添加分镜",-1))],8,rs)])]),_:2},1024)],10,Qa))),128))]),e[53]||(e[53]=a("div",{class:"bg-overlay rounded-4 p-4"}," 背景音乐 ",-1))]),_:1},512)])]),a("div",ds,[s(ht,{modelValue:t(xe),"onUpdate:modelValue":e[34]||(e[34]=l=>y1(xe)?xe.value=l:null),class:"storyboard-form-tabs",onTabChange:tt},{default:i(()=>[s(e1,{name:"image"},{label:i(()=>[s(h,{size:"16"},{default:i(()=>[s(x1)]),_:1}),e[54]||(e[54]=a("span",null,"分镜图",-1))]),default:i(()=>[t(d).storyboard_id?n1((n(),v("div",cs,[a("div",us,[a("span",null,"分镜#"+b(t(r).sort)+" 描述",1),a("span",ps,b(t(r).description),1)]),a("div",fs,[e[56]||(e[56]=a("span",null,"首帧提示词",-1)),a("div",_s,[s(Xe,{modelValue:t(d).image_prompt,"onUpdate:modelValue":e[2]||(e[2]=l=>t(d).image_prompt=l),placeholder:"请输入首帧提示词",size:"small",class:"storyboard-form-textarea",type:"textarea",autosize:{minRows:6,maxRows:20}},null,8,["modelValue"]),a("div",vs,[a("div",{class:"bg-overlay rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover",ref_key:"modelButtonRef",ref:U1,title:"选择使用AI生成图"},[t(fe).id?(n(),v(X,{key:0},[s(q,{src:t(fe).icon,alt:t(fe).name,shape:"square",size:16},null,8,["src","alt"]),a("span",gs,b(t(fe).name),1),s(h,{size:"16",class:"pointer",onClick:e[3]||(e[3]=ke(l=>r1(),["stop"]))},{default:i(()=>[s(Q)]),_:1})],64)):(n(),P(h,{key:1,size:"16"},{default:i(()=>[s(go)]),_:1}))],512),e[55]||(e[55]=a("div",{class:"flex-1"},null,-1)),a("div",ms,[s(h,{size:"16"},{default:i(()=>[s(s1)]),_:1}),a("span",hs,b(t(ko)),1)]),a("div",{class:"rounded-round p-3 flex flex-center grid-gap-2 pointer",style:{"background-color":"#FFFFFF",color:"#141414"},onClick:wo},[s(h,{size:"20"},{default:i(()=>[t(De)||t(r).image_state?(n(),P(t(be),{key:0,class:"circular"})):(n(),P(no,{key:1}))]),_:1})])])])]),a("div",ys,[a("div",Cs,[e[57]||(e[57]=a("span",null,"场景",-1)),s(ae,{placement:"bottom",teleported:!1,"popper-class":"episode-popover",width:"fit-content"},{reference:i(()=>[s(q,{src:t(r).sceneFind?.image,fit:"contain",size:100,shape:"square"},null,8,["src"])]),default:i(()=>[a("div",xs,[(n(!0),v(X,null,le(t(ge),l=>(n(),v("div",{class:"grid-column-2",key:l.id},[s(q,{src:l.image,fit:"contain",size:100,shape:"square",class:"pointer",onClick:J=>Wo(l)},{default:i(()=>[de(b(l.title),1)]),_:2},1032,["src","onClick"])]))),128))])]),_:1})]),a("div",bs,[e[58]||(e[58]=a("span",null,"引用分镜",-1)),a("div",Ls,[(n(!0),v(X,null,le(t(w),(l,J)=>(n(),v("div",{key:l.id,class:"actor-item"},[s(q,{src:l.image,fit:"contain",size:100,shape:"square"},null,8,["src"]),s(h,{class:"actor-close",onClick:a1=>O(J)},{default:i(()=>[s(Q)]),_:1},8,["onClick"])]))),128)),s(q,{fit:"contain",size:100,shape:"square",class:"pointer",ref_key:"storyboardButtonRef",ref:H},{default:i(()=>[s(h,{size:"26"},{default:i(()=>[s($e)]),_:1})]),_:1},512)])])]),a("div",ks,[e[59]||(e[59]=a("span",null,"出镜演员",-1)),a("div",Ss,[(n(!0),v(X,null,le(t(se),l=>(n(),v("div",{key:l.id,class:"actor-item"},[s(q,{src:l.headimg,fit:"contain",size:100,shape:"square",title:l.name,alt:l.name,class:"pointer bg-mosaic",onClick:J=>Z1(t(se).map(a1=>a1.headimg),l.headimg)},{default:i(()=>[a("div",ws,[a("span",null,b(l.name),1),l.status_enum?.value=="pending"?(n(),v("span",Rs,b(l.status_enum?.label),1)):l.status_enum?.value!="generated"?(n(),v("span",Es,b(l.status_enum?.label),1)):$("",!0)])]),_:2},1032,["src","title","alt","onClick"]),l.character_look_state?$("",!0):(n(),P(h,{key:0,class:"actor-close",onClick:J=>qo(l)},{default:i(()=>[s(Q)]),_:1},8,["onClick"])),l.status_enum?.value==="generated"?(n(),P(h,{key:1,class:pe(["actor-character-look",{"actor-character-look-selected":l.character_look_id}]),onClick:J=>Fo(l)},{default:i(()=>[l.character_look_state?(n(),P(t(be),{key:1,class:"circular"})):(n(),P(Ea,{key:0}))]),_:2},1032,["onClick","class"])):$("",!0)]))),128)),s(q,{fit:"contain",size:100,shape:"square",class:"pointer",ref_key:"actorButtonRef",ref:N1},{default:i(()=>[s(h,{size:"26"},{default:i(()=>[s($e)]),_:1})]),_:1},512)])]),a("div",Is,[e[60]||(e[60]=a("span",null,"出镜物品",-1)),a("div",Vs,[(n(!0),v(X,null,le(t(r).props,l=>(n(),v("div",{key:l.id,class:"actor-item"},[s(q,{src:l.prop.image,fit:"contain",size:100,shape:"square",title:l.prop.name,alt:l.prop.name,class:"pointer bg-mosaic",onClick:J=>Z1(t(r).props.map(a1=>a1.prop.image),l.prop.image)},{default:i(()=>[a("div",Us,[a("span",null,b(l.prop.name),1),l.prop.status_enum.value=="pending"?(n(),v("span",Ps,b(l.prop.status_enum.label),1)):l.prop.status_enum.value!="generated"?(n(),v("span",As,b(l.prop.status_enum.label),1)):$("",!0)])]),_:2},1032,["src","title","alt","onClick"]),s(h,{class:"actor-close",onClick:J=>No(l)},{default:i(()=>[s(Q)]),_:1},8,["onClick"])]))),128)),s(q,{fit:"contain",size:100,shape:"square",class:"pointer",ref_key:"propButtonRef",ref:q1},{default:i(()=>[s(h,{size:"26"},{default:i(()=>[s($e)]),_:1})]),_:1},512)])]),s(ae,{ref_key:"modelPopoverRef",ref:V1,"popper-class":"model-popover","virtual-ref":t(U1),"virtual-triggering":"",placement:"bottom",width:"min(100vw,380px)",trigger:"click"},{default:i(()=>[s(Ye,{modelValue:t(d).model_id,"onUpdate:modelValue":e[4]||(e[4]=l=>t(d).model_id=l),onSelect:r1,"no-init":"",scene:"storyboard_image"},null,8,["modelValue"])]),_:1},8,["virtual-ref"]),s(ae,{ref_key:"actorPopoverRef",ref:G1,"virtual-ref":t(N1),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,880px)",trigger:"click"},{default:i(()=>[s(dt,{onSelect:To,types:[{label:"本集",value:"episode"},{label:"本剧",value:"drama"}],query:{drama_id:t(f),episode_id:t(S)}},null,8,["query"])]),_:1},8,["virtual-ref"]),s(ae,{ref_key:"propPopoverRef",ref:W1,"virtual-ref":t(q1),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,880px)",trigger:"click"},{default:i(()=>[s(ct,{onSelect:Go,types:[{label:"本集",value:"episode"},{label:"本剧",value:"drama"}],query:{drama_id:t(f),episode_id:t(S)}},null,8,["query"])]),_:1},8,["virtual-ref"]),s(ae,{ref_key:"storyboardPopoverRef",ref:j,"virtual-ref":t(H),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,880px)",trigger:"click",onShow:e[5]||(e[5]=l=>t(m)?.getStoryboardList())},{default:i(()=>[s(h1,{ref_key:"storyboardRef",ref:m,onSelect:U,query:{drama_id:t(f),episode_id:t(S)}},null,8,["query"])]),_:1},8,["virtual-ref"]),s(ut,{ref_key:"characterLookRef",ref:H1,onSelect:Zo,query:{drama_id:t(f),episode_id:t(S)}},null,8,["query"])])),[[po,t(Ge)]]):$("",!0)]),_:1}),s(e1,{name:"video"},{label:i(()=>[s(h,{size:"16"},{default:i(()=>[s(b1)]),_:1}),e[61]||(e[61]=a("span",null,"分镜视频",-1))]),default:i(()=>[t(d).storyboard_id?(n(),v("div",$s,[a("div",Ms,[a("span",null,"分镜#"+b(t(r).sort)+" 描述",1),a("span",zs,b(t(r).description),1),a("div",Ds,[s(q,{src:t(d).first_image,fit:"contain",size:100,class:"pointer",shape:"square",ref_key:"firstImageButtonRef",ref:j1},null,8,["src"]),s(h,{color:"var(--el-color-info)"},{default:i(()=>[s(pt)]),_:1}),s(q,{src:t(d).last_image,fit:"contain",size:100,shape:"square",class:"pointer",ref_key:"lastImageButtonRef",ref:Q1},{default:i(()=>[a("div",Os,[s(h,{color:"var(--el-text-color-primary)",size:"16"},{default:i(()=>[s($e)]),_:1}),e[62]||(e[62]=a("span",{class:"h10 text-text-primary"},"尾帧",-1))])]),_:1},8,["src"])])]),a("div",Bs,[e[64]||(e[64]=a("span",null,"视频提示词",-1)),a("div",Ts,[s(Xe,{modelValue:t(d).video_prompt,"onUpdate:modelValue":e[6]||(e[6]=l=>t(d).video_prompt=l),placeholder:"请输入视频提示词",size:"small",class:"storyboard-form-textarea",type:"textarea",autosize:{minRows:6,maxRows:20}},null,8,["modelValue"]),a("div",Ns,[a("div",{class:"bg-overlay rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover",ref_key:"videoModelButtonRef",ref:A1,title:"选择使用AI生成视频"},[t(_e).id?(n(),v(X,{key:0},[s(q,{src:t(_e).icon,alt:t(_e).name,shape:"square",size:16},null,8,["src","alt"]),a("span",Gs,b(t(_e).name),1),s(h,{size:"16",class:"pointer",onClick:e[7]||(e[7]=ke(l=>d1(),["stop"]))},{default:i(()=>[s(Q)]),_:1})],64)):(n(),P(h,{key:1,size:"16"},{default:i(()=>[s(go)]),_:1}))],512),a("div",{class:"bg-overlay rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover",ref_key:"durationButtonRef",ref:ao,title:"选择视频时长"},[s(h,{size:"16"},{default:i(()=>[s(ft)]),_:1}),a("span",Fs,b(Math.floor(t(d).duration/1e3))+"s",1)],512),e[63]||(e[63]=a("div",{class:"flex-1"},null,-1)),a("div",Zs,[s(h,{size:"16"},{default:i(()=>[s(s1)]),_:1}),a("span",qs,b(t(So)),1)]),a("div",{class:"rounded-round p-3 flex flex-center grid-gap-2 pointer",style:{"background-color":"#FFFFFF",color:"#141414"},onClick:Ro},[s(h,{size:"20"},{default:i(()=>[t(Oe)||t(r).video_state?(n(),P(t(be),{key:0,class:"circular"})):(n(),P(no,{key:1}))]),_:1})])])])]),s(ae,{ref_key:"videoModelPopoverRef",ref:P1,"popper-class":"model-popover","virtual-ref":t(A1),"virtual-triggering":"",placement:"bottom",width:"min(100vw,380px)",trigger:"click"},{default:i(()=>[s(Ye,{modelValue:t(d).video_model_id,"onUpdate:modelValue":e[8]||(e[8]=l=>t(d).video_model_id=l),onSelect:d1,"no-init":"",scene:"storyboard_video"},null,8,["modelValue"])]),_:1},8,["virtual-ref"]),s(ae,{"popper-class":"episode-popover","virtual-ref":t(ao),"virtual-triggering":"",placement:"bottom",width:"fit-content"},{default:i(()=>[a("div",Ws,[a("span",{class:"pointer hover-bg-hover rounded-round p-2",onClick:e[9]||(e[9]=l=>t(d).duration=5e3)},"5s"),a("span",{class:"pointer hover-bg-hover rounded-round p-2",onClick:e[10]||(e[10]=l=>t(d).duration=1e4)},"10s"),a("span",{class:"pointer hover-bg-hover rounded-round p-2",onClick:e[11]||(e[11]=l=>t(d).duration=15e3)},"15s")])]),_:1},8,["virtual-ref"]),s(ae,{ref_key:"firstImagePopoverRef",ref:J1,"virtual-ref":t(j1),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,880px)",trigger:"click",onShow:e[12]||(e[12]=l=>t(X1)?.getStoryboardList())},{default:i(()=>[s(h1,{ref_key:"firstImageStoryboardRef",ref:X1,onSelect:Ho,query:{drama_id:t(f),episode_id:t(S)}},null,8,["query"])]),_:1},8,["virtual-ref"]),s(ae,{ref_key:"lastImagePopoverRef",ref:K1,"virtual-ref":t(Q1),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,880px)",trigger:"click",onShow:e[13]||(e[13]=l=>t(Y1)?.getStoryboardList())},{default:i(()=>[s(h1,{ref_key:"lastImageStoryboardRef",ref:Y1,onSelect:jo,query:{drama_id:t(f),episode_id:t(S)}},null,8,["query"])]),_:1},8,["virtual-ref"])])):$("",!0)]),_:1}),s(e1,{name:"dialogue"},{label:i(()=>[s(h,{size:"16"},{default:i(()=>[s(mo)]),_:1}),e[65]||(e[65]=a("span",null,"对话配音",-1))]),default:i(()=>[t(d).storyboard_id?(n(),v("div",Hs,[t(Se)?.length>0?(n(),v("div",js,[(n(!0),v(X,null,le(t(Se),l=>(n(),v("div",{class:"flex flex-center grid-gap-4 text-info pointer",key:l.id,onClick:J=>oo(l)},[s(h,{size:"16",color:t(y)?.id===l.id?"var(--el-color-success)":"var(--el-color-info)"},{default:i(()=>[l.voice_state?(n(),P(t(be),{key:0,class:"circular"})):(n(),P(_t,{key:1,class:pe(["border rounded-round",{"border-success text-success":t(y)?.id===l.id}])},null,8,["class"]))]),_:2},1032,["color"]),a("span",{class:pe(["flex-1 border h10 p-2 rounded-2 text-wrap",{"border-success text-success":t(y)?.id===l.id}])},b(l.actor.name)+b(l.inner_monologue?"(内心OS)":"")+":"+b(l.content),3)],8,Js))),128))])):(n(),P(vt,{key:1,description:"暂无对话"},{default:i(()=>[s(_,{type:"success",size:"large",bg:"",text:"",onClick:e[14]||(e[14]=ke(l=>to(),["stop"]))},{default:i(()=>[...e[66]||(e[66]=[a("span",null,"新增对话",-1)])]),_:1})]),_:1})),t(y)?.id?(n(),v(X,{key:2},[a("div",Qs,[e[68]||(e[68]=a("span",null,"台词",-1)),a("div",Ks,[s(Xe,{modelValue:t(y).content,"onUpdate:modelValue":e[15]||(e[15]=l=>t(y).content=l),placeholder:"台词",size:"small",class:"storyboard-form-textarea",type:"textarea",maxlength:200,"show-word-limit":"",autosize:{minRows:6,maxRows:20}},null,8,["modelValue"]),a("div",Xs,[a("div",{class:pe(["flex flex-center grid-gap-2 pointer",[t(y).audio?"text-success":"text-info"]]),onClick:e[16]||(e[16]=l=>io(t(y).audio))},[s(h,null,{default:i(()=>[t(y).voice_state?(n(),P(t(be),{key:0,class:"circular"})):(n(),P(ro,{key:1}))]),_:1}),e[67]||(e[67]=a("span",{class:"h10"},"播放",-1))],2)])])]),a("div",Ys,[e[73]||(e[73]=a("span",null,"音色情绪",-1)),a("div",e5,[t(y).voice?(n(),v(X,{key:0},[a("div",o5,[s(q,{src:t(y).voice.headimg,fit:"contain",size:40,shape:"square"},{default:i(()=>[de(b(t(L1)(t(y).voice.name,1)),1)]),_:1},8,["src"]),a("div",t5,[a("span",null,b(t(y).voice.name),1),a("div",a5,[a("span",s5,b(t(y).voice.gender_enum.label),1),a("span",l5,b(t(y).voice.age_enum.label),1)])]),s(h,{color:"var(--el-color-info)",size:"24",class:"pointer",onClick:e[17]||(e[17]=l=>t(_1)?.open({modelScene:"dialogue_voice",voice:t(y).voice}))},{default:i(()=>[s(l1)]),_:1})]),a("div",i5,[e[71]||(e[71]=a("span",{style:{width:"18px"}},null,-1)),t(y).voice.emotions_enum.length>0?(n(),P(ae,{key:0,"popper-class":"episode-popover",placement:"bottom",width:"fit-content"},{reference:i(()=>[a("div",n5,[e[69]||(e[69]=a("span",null,"情绪：",-1)),a("span",r5,b(t(y).voice.selected_emotion?.label),1),s(h,null,{default:i(()=>[s(o1)]),_:1})])]),default:i(()=>[a("div",d5,[(n(!0),v(X,null,le(t(y).voice.emotions_enum,l=>(n(),v("span",{class:"pointer hover-bg-hover rounded-4 p-2",key:l.value,onClick:J=>{t(y).voice.selected_emotion=l,we(t(y).voice,{apply_scope:t(y).voice_level})}},b(l.label),9,c5))),128))])]),_:1})):$("",!0),t(y).voice.emotions_enum.length>0?(n(),P(ae,{key:1,"popper-class":"episode-popover",placement:"bottom",width:"fit-content"},{reference:i(()=>[a("div",u5,[e[70]||(e[70]=a("span",null,"语言：",-1)),a("span",p5,b(t(y).voice.selected_language?.label),1),s(h,null,{default:i(()=>[s(o1)]),_:1})])]),default:i(()=>[a("div",f5,[(n(!0),v(X,null,le(t(y).voice.language_enum,l=>(n(),v("span",{class:"pointer hover-bg-hover rounded-4 p-2",key:l.value,onClick:J=>{t(y).voice.selected_language=l,we(t(y).voice,{apply_scope:t(y).voice_level})}},b(l.label),9,_5))),128))])]),_:1})):$("",!0)])],64)):(n(),v("div",v5,[s(q,{fit:"contain",size:40,shape:"square"}),e[72]||(e[72]=a("div",{class:"flex-1 flex flex-column grid-gap-2"},[a("span",{class:"text-info"},"选择音色")],-1)),s(h,{color:"var(--el-color-info)",size:"24",class:"pointer",onClick:e[18]||(e[18]=l=>t(_1)?.open({modelScene:"dialogue_voice",voice:t(y).voice}))},{default:i(()=>[s(l1)]),_:1})]))])]),a("div",g5,[e[74]||(e[74]=a("span",null,"音量",-1)),a("div",m5,[s(t1,{modelValue:t(y).prosody_volume,"onUpdate:modelValue":e[19]||(e[19]=l=>t(y).prosody_volume=l),step:1,min:0,max:100,class:"storyboard-form-slider flex-1","format-tooltip":Qe,marks:{0:"静音",100:"最大",50:"正常"}},null,8,["modelValue"]),a("span",h5,b(Qe(t(y).prosody_volume)),1)])]),a("div",y5,[e[75]||(e[75]=a("span",null,"语速",-1)),a("div",C5,[s(t1,{modelValue:t(y).prosody_speed,"onUpdate:modelValue":e[20]||(e[20]=l=>t(y).prosody_speed=l),step:.1,"show-stops":"",min:.5,max:2,"format-tooltip":Je,class:"storyboard-form-slider"},null,8,["modelValue"]),a("span",x5,b(Je(t(y).prosody_speed)),1)])]),e[77]||(e[77]=a("div",{class:"flex-1"},null,-1)),a("div",b5,[s(ae,{"popper-class":"episode-popover",placement:"bottom",width:"fit-content"},{reference:i(()=>[a("div",L5,[s(h,null,{default:i(()=>[s(gt)]),_:1})])]),default:i(()=>[a("div",k5,[a("span",{class:"pointer hover-bg-hover rounded-4 p-2",onClick:e[21]||(e[21]=l=>to())},"新增对话"),a("span",{class:"pointer hover-bg-hover rounded-4 p-2",onClick:e[22]||(e[22]=l=>Jo())},"编辑当前对话"),a("span",{class:"pointer hover-bg-hover rounded-4 p-2",onClick:e[23]||(e[23]=l=>Ko())},"删除当前对话"),a("span",{class:pe(["pointer hover-bg-hover rounded-4 p-2",{"text-info":t(y).voice_level==="storyboard",pointer:t(y).voice_level!=="storyboard"}]),onClick:e[24]||(e[24]=l=>we(t(y).voice,{apply_scope:"storyboard"}))},[t(y).voice_level==="storyboard"?(n(),v("span",S5,"音色已应用到当前分镜")):(n(),v("span",w5,"将所选音色应用到当前分镜"))],2),a("span",{class:"pointer hover-bg-hover rounded-4 p-2",onClick:e[25]||(e[25]=l=>we(t(y).voice,{apply_scope:"scene"}))},"将所选音色应用到当前场景"),a("span",{class:pe(["hover-bg-hover rounded-4 p-2",{"text-info":t(y).voice_level==="episode",pointer:t(y).voice_level!=="episode"}]),onClick:e[26]||(e[26]=l=>we(t(y).voice,{apply_scope:"episode"}))},[t(y).voice_level==="episode"?(n(),v("span",R5,"音色已应用到当前分集")):(n(),v("span",E5,"将所选音色应用到当前分集"))],2),a("span",{class:pe(["pointer hover-bg-hover rounded-4 p-2",{"text-info":t(y).voice_level==="drama",pointer:t(y).voice_level!=="drama"}]),onClick:e[27]||(e[27]=l=>we(t(y).voice,{apply_scope:"drama"}))},[t(y).voice_level==="drama"?(n(),v("span",I5,"音色已应用到当前剧本")):(n(),v("span",V5,"将所选音色应用到当前剧本"))],2),t(y).voice_level==="actor"?(n(),v("span",U5,"将所选音色应用到当前角色")):$("",!0)])]),_:1}),s(_,{type:"success",size:"large",class:"flex-1",onClick:Xo,loading:t(Ze)||!!t(y).voice_state},{default:i(()=>[e[76]||(e[76]=a("span",null,"确认修改",-1)),t(v1)!="免费"?(n(),v("span",P5,b(t(v1)),1)):$("",!0),t(v1)!="免费"?(n(),v("span",A5,"积分/次")):$("",!0)]),_:1},8,["loading"])])],64)):$("",!0),s(co,{ref_key:"dialogueVoiceDialogRef",ref:_1,onSuccess:we},null,512),s(mt,{ref_key:"dialogueCreateRef",ref:f1,onSuccess:Qo},null,512)])):$("",!0)]),_:1}),s(e1,{name:"narration"},{label:i(()=>[s(h,{size:"16"},{default:i(()=>[s(mo)]),_:1}),e[78]||(e[78]=a("span",null,"旁白配音",-1))]),default:i(()=>[t(d).storyboard_id?(n(),v("div",$5,[a("div",M5,[e[80]||(e[80]=a("span",null,"旁白台词",-1)),a("div",z5,[s(Xe,{modelValue:t(d).narration,"onUpdate:modelValue":e[28]||(e[28]=l=>t(d).narration=l),placeholder:"旁白台词",size:"small",class:"storyboard-form-textarea",type:"textarea",maxlength:200,"show-word-limit":"",autosize:{minRows:6,maxRows:20}},null,8,["modelValue"]),a("div",D5,[a("div",{class:pe(["flex flex-center grid-gap-2 pointer",[t(r).narration_audio?"text-success":"text-info"]]),onClick:e[29]||(e[29]=l=>io(t(r).narration_audio))},[s(h,null,{default:i(()=>[t(r).narration_state?(n(),P(t(be),{key:0,class:"circular"})):(n(),P(ro,{key:1}))]),_:1}),e[79]||(e[79]=a("span",{class:"h10"},"播放",-1))],2)])])]),a("div",O5,[e[85]||(e[85]=a("span",null,"音色情绪",-1)),a("div",B5,[t(g).voice?(n(),v(X,{key:0},[a("div",T5,[s(q,{src:t(g).voice.headimg,fit:"contain",size:40,shape:"square"},{default:i(()=>[de(b(t(L1)(t(g).voice.name,1)),1)]),_:1},8,["src"]),a("div",N5,[a("span",null,b(t(g).voice.name),1),a("div",G5,[a("span",F5,b(t(g).voice.gender_enum.label),1),a("span",Z5,b(t(g).voice.age_enum.label),1)])]),s(h,{color:"var(--el-color-info)",size:"24",class:"pointer",onClick:e[30]||(e[30]=l=>t(We)?.open({modelScene:"storyboard_narration_voice",voice:t(g).voice}))},{default:i(()=>[s(l1)]),_:1})]),a("div",q5,[e[83]||(e[83]=a("span",{style:{width:"18px"}},null,-1)),t(g).voice.emotions_enum.length>0?(n(),P(ae,{key:0,"popper-class":"episode-popover",placement:"bottom",width:"fit-content"},{reference:i(()=>[a("div",W5,[e[81]||(e[81]=a("span",null,"情绪：",-1)),a("span",H5,b(t(g).voice.selected_emotion?.label),1),s(h,null,{default:i(()=>[s(o1)]),_:1})])]),default:i(()=>[a("div",j5,[(n(!0),v(X,null,le(t(g).voice.emotions_enum,l=>(n(),v("span",{class:"pointer hover-bg-hover rounded-4 p-2",key:l.value,onClick:J=>{t(g).voice.selected_emotion=l,m1(t(g).voice)}},b(l.label),9,J5))),128))])]),_:1})):$("",!0),t(g).voice.emotions_enum.length>0?(n(),P(ae,{key:1,"popper-class":"episode-popover",placement:"bottom",width:"fit-content"},{reference:i(()=>[a("div",Q5,[e[82]||(e[82]=a("span",null,"语言：",-1)),a("span",K5,b(t(g).voice.selected_language?.label),1),s(h,null,{default:i(()=>[s(o1)]),_:1})])]),default:i(()=>[a("div",X5,[(n(!0),v(X,null,le(t(g).voice.language_enum,l=>(n(),v("span",{class:"pointer hover-bg-hover rounded-4 p-2",key:l.value,onClick:J=>{t(g).voice.selected_language=l,m1(t(g).voice)}},b(l.label),9,Y5))),128))])]),_:1})):$("",!0)])],64)):(n(),v("div",el,[s(q,{fit:"contain",size:40,shape:"square"}),e[84]||(e[84]=a("div",{class:"flex-1 flex flex-column grid-gap-2"},[a("span",{class:"text-info"},"选择音色")],-1)),s(h,{color:"var(--el-color-info)",size:"24",class:"pointer",onClick:e[31]||(e[31]=l=>t(We)?.open({modelScene:"storyboard_narration_voice",voice:t(g).voice}))},{default:i(()=>[s(l1)]),_:1})]))])]),a("div",ol,[e[86]||(e[86]=a("span",null,"音量",-1)),a("div",tl,[s(t1,{modelValue:t(g).prosody_volume,"onUpdate:modelValue":e[32]||(e[32]=l=>t(g).prosody_volume=l),step:1,min:0,max:100,class:"storyboard-form-slider flex-1","format-tooltip":Qe,marks:{0:"静音",100:"最大",50:"正常"}},null,8,["modelValue"]),a("span",al,b(Qe(t(g).prosody_volume)),1)])]),a("div",sl,[e[87]||(e[87]=a("span",null,"语速",-1)),a("div",ll,[s(t1,{modelValue:t(g).prosody_speed,"onUpdate:modelValue":e[33]||(e[33]=l=>t(g).prosody_speed=l),step:.1,"show-stops":"",min:.5,max:2,"format-tooltip":Je,class:"storyboard-form-slider"},null,8,["modelValue"]),a("span",il,b(Je(t(g).prosody_speed)),1)])]),e[89]||(e[89]=a("div",{class:"flex-1"},null,-1)),s(_,{type:"success",size:"large",onClick:et,loading:t(je)||!!t(r).narration_state},{default:i(()=>[e[88]||(e[88]=a("span",null,"确认修改",-1)),t(g1)!="免费"?(n(),v("span",nl,b(t(g1)),1)):$("",!0),t(g1)!="免费"?(n(),v("span",rl,"积分/次")):$("",!0)]),_:1},8,["loading"]),s(co,{ref_key:"narrationVoiceDialogRef",ref:We,onSuccess:m1},null,512)])):$("",!0)]),_:1})]),_:1},8,["modelValue"])])]),s(uo,{modelValue:t(Re),"onUpdate:modelValue":e[37]||(e[37]=l=>y1(Re)?Re.value=l:null),class:"generate-storyboard-dialog",draggable:"",width:"800px"},{header:i(()=>[...e[90]||(e[90]=[a("span",{class:"font-weight-600"},"批量生成分镜",-1)])]),footer:i(()=>[s(_,{type:"info",onClick:e[36]||(e[36]=l=>Re.value=!1),disabled:t(Be)},{default:i(()=>[...e[91]||(e[91]=[de("取消",-1)])]),_:1},8,["disabled"]),e[93]||(e[93]=a("div",{class:"flex-1"},null,-1)),a("div",dl,[s(h,{size:"16"},{default:i(()=>[s(s1)]),_:1}),a("span",cl,b(t(Vo)),1)]),s(_,{type:"success",icon:"Check",onClick:Uo,disabled:!t(d).model_id,loading:t(Be)},{default:i(()=>[...e[92]||(e[92]=[de("生成",-1)])]),_:1},8,["disabled","loading"])]),default:i(()=>[s(Ye,{title:"模型",modelValue:t(d).model_id,"onUpdate:modelValue":e[35]||(e[35]=l=>t(d).model_id=l),onSelect:r1,"no-init":"",class:"flex-1 bg-overlay rounded-4 p-4",scene:"storyboard_image"},null,8,["modelValue"])]),_:1},8,["modelValue"]),s(uo,{modelValue:t(Ee),"onUpdate:modelValue":e[40]||(e[40]=l=>y1(Ee)?Ee.value=l:null),class:"generate-storyboard-dialog",draggable:"",width:"800px"},{header:i(()=>[...e[94]||(e[94]=[a("span",{class:"font-weight-600"},"批量生成视频",-1)])]),footer:i(()=>[s(_,{type:"info",onClick:e[39]||(e[39]=l=>Ee.value=!1),disabled:t(Ne)},{default:i(()=>[...e[95]||(e[95]=[de("取消",-1)])]),_:1},8,["disabled"]),e[97]||(e[97]=a("div",{class:"flex-1"},null,-1)),a("div",ul,[s(h,{size:"16"},{default:i(()=>[s(s1)]),_:1}),a("span",pl,b(t(Ao)),1)]),s(_,{type:"success",icon:"Check",onClick:$o,disabled:!t(d).video_model_id,loading:t(Ne)},{default:i(()=>[...e[96]||(e[96]=[de("生成",-1)])]),_:1},8,["disabled","loading"])]),default:i(()=>[s(Ye,{title:"模型",modelValue:t(d).video_model_id,"onUpdate:modelValue":e[38]||(e[38]=l=>t(d).video_model_id=l),onSelect:d1,"no-init":"",class:"flex-1 bg-overlay rounded-4 p-4",scene:"storyboard_video"},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(u1)?(n(),P(yt,{key:0,"url-list":t(p1),"show-progress":"","initial-index":t(F1),onClose:e[41]||(e[41]=l=>u1.value=!1)},null,8,["url-list","initial-index"])):$("",!0)])}}}),Rl=he(fl,[["__scopeId","data-v-dcff6d0c"]]);export{Rl as default};
