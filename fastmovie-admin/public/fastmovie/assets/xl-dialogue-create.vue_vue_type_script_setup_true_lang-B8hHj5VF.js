import{d as M,r as d,k as g,f as W,u as o,m as a,S as J,J as K,s as r,ak as H,l as n,aj as Q,a7 as X,t as C,B as Y,aK as Z,aN as ee,I as oe,M as te,ap as ae,C as le,x as v,ab as se,O as re,E as b,h as p,e as ne,aO as de}from"./vendor-t8h0TCfL.js";import{_ as ie}from"./index-BFBlsriZ.js";import{a as ue,u as me,$ as pe,R as _e}from"./index-B0RNcuq8.js";const ce={key:0},ge={key:0,class:"font-weight-600"},fe={key:1,class:"font-weight-600"},ve={class:"flex grid-gap-4"},be={class:"h10"},ye={class:"flex grid-gap-4"},xe={class:"w-100 px-6"},Ve={class:"w-100 px-6 pb-7"},he={class:"flex grid-gap-4"},ke={class:"flex flex-center grid-gap-2 w-100"},De=M({__name:"xl-dialogue-create",emits:["success"],setup(Ce,{expose:E,emit:w}){const R=ue(),{WEBCONFIG:D}=me(R),u=d(!1),_=d(),t=d({id:"",drama_id:"",storyboard_id:"",actor_id:"",prosody_speed:1,prosody_volume:50,emotion:"",start_time:0,end_time:1e3,content:"",actor:{name:"选择演员",headimg:""}}),F=d({actor_id:[{required:!0,message:"请选择演员",trigger:"change"}],content:[{required:!0,message:"请输入对话内容",trigger:"blur"}],prosody_speed:[{required:!0,message:"请选择语速",trigger:"change"}],prosody_volume:[{required:!0,message:"请选择音量",trigger:"change"}],emotion:[{required:!0,message:"请选择情感",trigger:"change"}],start_time:[{required:!0,message:"请选择字幕&语音开始时间",trigger:"change"}],end_time:[{required:!0,message:"请选择字幕结束时间",trigger:"change"}]}),S=w,f=d(),q=(l,e)=>{e&&(t.value=Object.assign(t.value,e)),_.value=l,t.value.storyboard_id=l.id,t.value.drama_id=l.drama_id,re(()=>{u.value=!0})},c=()=>{f.value?.resetFields(),t.value={id:"",drama_id:"",storyboard_id:"",actor_id:"",prosody_speed:1,prosody_volume:50,emotion:"",start_time:0,end_time:1e3,content:"",actor:{name:"选择演员",headimg:""}},u.value=!1},m=d(!1),B=()=>{f.value?.validate().then(l=>{if(l){if(m.value)return;m.value=!0,pe.post("/app/shortplay/api/StoryboardDialogue/save",t.value).then(e=>{e.code===_e.SUCCESS?(b.success(e.msg),c(),S("success",_.value,e.data)):b.error(e.msg)}).catch(()=>{b.error("创建失败")}).finally(()=>{m.value=!1})}})},y=d(),x=d(),U=l=>{t.value.actor_id=l.id,t.value.actor=l,y.value?.hide()},N=l=>l===1?"正常":`${l}x倍速`,I=l=>l===0?"静音":l===100?"最大":l===50?"正常":l<50?`-${l}%`:`+${l}%`,$=()=>{m.value||c()};return E({open:q,close:c}),(l,e)=>{const O=X,i=Q,T=Y,V=Z,P=de,j=ee,h=ae,z=H,k=le,A=J,G=ie,L=se;return o(u)?(p(),g("div",ce,[a(A,{modelValue:o(u),"onUpdate:modelValue":e[6]||(e[6]=s=>K(u)?u.value=s:null),class:"generate-scene-dialog",draggable:"","append-to-body":"","close-on-press-escape":!1,"close-on-click-modal":!1,"before-close":$,width:"min(100%,800px)"},{header:r(()=>[o(t).id?(p(),g("span",fe,"编辑对话")):(p(),g("span",ge,"新增对话"))]),footer:r(()=>[n("div",ke,[a(k,{type:"info",onClick:c,disabled:o(m)},{default:r(()=>[...e[7]||(e[7]=[v("取消",-1)])]),_:1},8,["disabled"]),e[9]||(e[9]=n("div",{class:"flex-1"},null,-1)),a(k,{type:"success",onClick:B,loading:o(m)},{default:r(()=>[...e[8]||(e[8]=[v("提交",-1)])]),_:1},8,["loading"])])]),default:r(()=>[a(z,{"label-position":"top",model:o(t),rules:o(F),ref_key:"dialogueFormRef",ref:f,size:"large"},{default:r(()=>[n("div",ve,[a(i,{label:"演员",prop:"actor",class:"w-30"},{default:r(()=>[n("div",{class:"flex flex-y-center grid-gap-2 rounded-4 p-4 bg-overlay w-100 pointer bg-hover-bg",ref_key:"actorButtonRef",ref:x},[a(O,{src:o(t).actor.headimg,alt:o(t).actor.name,shape:"square",class:"icon-model"},null,8,["src","alt"]),n("span",be,C(o(t).actor.name),1)],512)]),_:1}),a(i,{label:"对话内容",prop:"content",class:"flex-1"},{default:r(()=>[a(T,{type:"textarea",modelValue:o(t).content,"onUpdate:modelValue":e[0]||(e[0]=s=>o(t).content=s),placeholder:"请输入对话内容",autosize:{minRows:3,maxRows:10}},null,8,["modelValue"])]),_:1})]),n("div",ye,[a(i,{label:"语速",prop:"prosody_speed",class:"flex-1"},{default:r(()=>[n("div",xe,[a(V,{modelValue:o(t).prosody_speed,"onUpdate:modelValue":e[1]||(e[1]=s=>o(t).prosody_speed=s),step:.1,"show-stops":"",min:.5,max:2,"format-tooltip":N},null,8,["modelValue"])])]),_:1}),a(i,{label:"音量",prop:"prosody_volume",class:"flex-1"},{default:r(()=>[n("div",Ve,[a(V,{modelValue:o(t).prosody_volume,"onUpdate:modelValue":e[2]||(e[2]=s=>o(t).prosody_volume=s),step:1,min:0,max:100,"format-tooltip":I,marks:{0:"静音",100:"最大",50:"正常"}},null,8,["modelValue"])])]),_:1})]),a(i,{label:"情感",prop:"emotion"},{default:r(()=>[a(j,{modelValue:o(t).emotion,"onUpdate:modelValue":e[3]||(e[3]=s=>o(t).emotion=s)},{default:r(()=>[(p(!0),g(oe,null,te(o(D)?.enum?.voice_emotion,s=>(p(),ne(P,{key:s.value,value:s.value,border:""},{default:r(()=>[v(C(s.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n("div",he,[a(i,{label:"字幕&语音开始时间(毫秒)",prop:"start_time"},{default:r(()=>[a(h,{modelValue:o(t).start_time,"onUpdate:modelValue":e[4]||(e[4]=s=>o(t).start_time=s),min:0,max:1e6,step:100},null,8,["modelValue"])]),_:1}),a(i,{label:"字幕结束时间(毫秒)",prop:"end_time"},{default:r(()=>[a(h,{modelValue:o(t).end_time,"onUpdate:modelValue":e[5]||(e[5]=s=>o(t).end_time=s),min:0,max:1e6,step:100},null,8,["modelValue"])]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a(L,{ref_key:"actorPopoverRef",ref:y,"virtual-ref":o(x),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,880px)",trigger:"click"},{default:r(()=>[a(G,{onSelect:U,types:[{label:"本集",value:"episode"},{label:"本剧",value:"drama"}],query:{drama_id:o(_)?.drama_id,episode_id:o(_)?.episode_id}},null,8,["query"])]),_:1},8,["virtual-ref"])])):W("",!0)}}});export{De as _};
