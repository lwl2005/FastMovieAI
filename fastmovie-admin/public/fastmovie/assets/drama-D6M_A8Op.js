import{k as m,h as s,l as o,d as Te,r as c,w as Je,z as we,j as T,m as l,f as X,I as z,M as de,u as e,P as We,a6 as hl,s as t,q as Ge,t as y,e as w,K as yl,J as Ie,ak as Ze,aj as Ke,B as Xe,ao as zl,C as Ye,x as Y,ap as Il,S as cl,E as S,ae as j,a7 as el,ab as ll,D as rl,o as ol,g as Ll,ai as Pl,ah as _l,O as bl,aq as kl,a as ml,L as Al,N as Fl,p as Re,al as Dl,am as wl,a4 as Cl,ar as ze,a5 as Sl,an as Vl,H as Bl,ac as Ml,as as Tl,at as Gl,au as ql}from"./vendor-t8h0TCfL.js";import{_ as qe,$ as L,R as D,r as ke,c as tl,u as dl,a as Nl,s as jl}from"./index-B0RNcuq8.js";import{_ as al,a as Ol,u as ul,I as He}from"./usePoints-C21LjXJs.js";import{_ as Wl,I as Hl,a as Jl}from"./icon-style-DNHHFpUS.js";import{_ as Zl}from"./index-NttUUQHN.js";import{_ as Kl,c as Xl}from"./xl-actor-create-BekV8bjq.js";import{I as pl}from"./icon-points-01HE_Clx.js";import{I as Ql}from"./icon-replace-0MVmRYmL.js";import{u as fl}from"./usePush-v4t_r-_Z.js";import{_ as Yl}from"./xl-prop-create-KRM39Wah.js";import{I as eo}from"./icon-batch-CVIIjHri.js";import"./icon-image-BfHAjLRU.js";const lo={},oo={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",fill:"none",version:"1.1",width:"60",height:"60",viewBox:"0 0 60 60"};function to(he,re){return s(),m("svg",oo,[...re[0]||(re[0]=[o("path",{d:"M60,30Q60,30.736458,59.96386,31.472031Q59.927727,32.207603,59.855541,32.940514Q59.783356,33.673428,59.675293,34.401917Q59.56723,35.130402,59.423553,35.852707Q59.279877,36.575012,59.100929,37.289402Q58.921989,38.003792,58.708206,38.708538Q58.494423,39.413284,58.246315,40.106689Q57.998207,40.800098,57.716377,41.480495Q57.434547,42.160896,57.119671,42.826649Q56.804798,43.492401,56.457634,44.141899Q56.110466,44.791397,55.73185,45.423077Q55.353233,46.054756,54.94408,46.667099Q54.534927,47.279442,54.096218,47.870972Q53.657513,48.462502,53.190311,49.031792Q52.723106,49.601082,52.228531,50.146759Q51.733955,50.69244,51.2132,51.213196Q50.692444,51.733948,50.146763,52.228523Q49.601082,52.723099,49.031792,53.190308Q48.462502,53.657509,47.870972,54.096218Q47.279442,54.534927,46.667099,54.94408Q46.054756,55.353233,45.423077,55.73185Q44.791397,56.110466,44.141899,56.457634Q43.492401,56.804798,42.826649,57.119675Q42.160896,57.434547,41.480499,57.716377Q40.800102,57.998207,40.106689,58.246311Q39.413284,58.494419,38.708538,58.708202Q38.003792,58.921986,37.289402,59.100933Q36.575012,59.279877,35.852707,59.423553Q35.130402,59.56723,34.401917,59.675293Q33.673431,59.783356,32.940517,59.855541Q32.207603,59.927727,31.472031,59.96386Q30.736458,60,30,60Q29.263542,60,28.527969,59.96386Q27.792398,59.927727,27.059486,59.855541Q26.326572,59.783356,25.598085,59.675293Q24.869596,59.56723,24.147289,59.423553Q23.42498,59.279877,22.710594,59.100929Q21.996206,58.921989,21.29146,58.708206Q20.586712,58.494423,19.893303,58.246315Q19.199894,57.998207,18.519495,57.716377Q17.839096,57.434547,17.173346,57.119671Q16.507595,56.804798,15.858096,56.457634Q15.208597,56.110466,14.576916,55.73185Q13.945234,55.353233,13.332891,54.94408Q12.720549,54.534927,12.12902,54.096218Q11.537491,53.657513,10.968202,53.190311Q10.398911,52.723106,9.8532305,52.228531Q9.3075504,51.733955,8.7867956,51.2132Q8.2660408,50.692444,7.7714653,50.146763Q7.2768898,49.601082,6.8096857,49.031792Q6.3424807,48.462502,5.9037724,47.870972Q5.465065,47.279442,5.0559106,46.667099Q4.6467562,46.054756,4.2681408,45.423077Q3.8895254,44.791397,3.5423617,44.141899Q3.1951976,43.492401,2.880321,42.826649Q2.5654442,42.160896,2.2836137,41.480499Q2.0017831,40.800102,1.7536777,40.106689Q1.5055723,39.413284,1.2917898,38.708538Q1.0780071,38.003792,0.89906228,37.289402Q0.72011739,36.575012,0.57644147,35.852707Q0.43276554,35.130402,0.32470462,34.401917Q0.21664374,33.673431,0.14445817,32.940517Q0.072272614,32.207603,0.036136307,31.472031Q0,30.736458,0,30Q0,29.263542,0.036136307,28.527969Q0.072272614,27.792398,0.14445817,27.059486Q0.21664374,26.326572,0.32470465,25.598085Q0.43276554,24.869596,0.57644147,24.147289Q0.72011739,23.42498,0.89906222,22.710594Q1.0780071,21.996206,1.2917898,21.29146Q1.5055723,20.586712,1.7536777,19.893303Q2.0017831,19.199894,2.2836137,18.519495Q2.5654442,17.839096,2.8803208,17.173346Q3.1951976,16.507595,3.5423617,15.858096Q3.8895259,15.208597,4.2681413,14.576916Q4.6467562,13.945234,5.0559111,13.332891Q5.465065,12.720549,5.9037733,12.12902Q6.3424811,11.537491,6.8096857,10.968202Q7.2768898,10.398911,7.7714653,9.8532305Q8.2660408,9.3075504,8.7867956,8.7867956Q9.3075504,8.2660408,9.8532305,7.7714653Q10.398911,7.2768898,10.968201,6.8096857Q11.537491,6.3424807,12.12902,5.9037724Q12.720549,5.465065,13.332891,5.0559106Q13.945234,4.6467562,14.576916,4.2681408Q15.208597,3.8895254,15.858097,3.5423617Q16.507595,3.1951976,17.173346,2.880321Q17.839096,2.5654442,18.519495,2.2836137Q19.199894,2.0017831,19.893303,1.7536777Q20.586712,1.5055723,21.291458,1.2917898Q21.996204,1.0780071,22.710594,0.89906228Q23.42498,0.72011739,24.147289,0.57644147Q24.869596,0.43276554,25.598083,0.32470462Q26.326572,0.21664374,27.059486,0.14445817Q27.792398,0.072272614,28.527969,0.036136307Q29.263542,0,30,0Q30.736458,0,31.472031,0.036136307Q32.207603,0.072272614,32.940514,0.14445817Q33.673428,0.21664374,34.401917,0.32470465Q35.130402,0.43276554,35.852707,0.57644147Q36.575012,0.72011739,37.289402,0.89906222Q38.003792,1.0780071,38.708538,1.2917898Q39.413284,1.5055723,40.106689,1.7536777Q40.800098,2.0017831,41.480495,2.2836137Q42.160896,2.5654442,42.826649,2.8803208Q43.492401,3.1951976,44.141899,3.5423617Q44.791397,3.8895259,45.423077,4.2681413Q46.054756,4.6467562,46.667099,5.0559111Q47.279442,5.465065,47.870972,5.9037733Q48.462502,6.3424811,49.031792,6.8096857Q49.601082,7.2768898,50.146759,7.7714653Q50.69244,8.2660408,51.213196,8.7867956Q51.733948,9.3075504,52.228523,9.8532305Q52.723099,10.398911,53.190308,10.968201Q53.657509,11.537491,54.096218,12.12902Q54.534927,12.720549,54.94408,13.332891Q55.353233,13.945234,55.73185,14.576916Q56.110466,15.208597,56.457634,15.858097Q56.804798,16.507595,57.119675,17.173346Q57.434547,17.839096,57.716377,18.519495Q57.998207,19.199894,58.246311,19.893303Q58.494419,20.586712,58.708202,21.291458Q58.921986,21.996204,59.100933,22.710594Q59.279877,23.42498,59.423553,24.147289Q59.56723,24.869596,59.675293,25.598083Q59.783356,26.326572,59.855541,27.059486Q59.927727,27.792398,59.96386,28.527969Q60,29.263542,60,30Z",fill:"#000000","fill-opacity":"0.4000000059604645",style:{"mix-blend-mode":"passthrough"}},null,-1),o("path",{d:"M22.94117546081543,40.191558486938476C22.94137583933543,40.986764486938476,23.33128399081543,41.71765148693848,23.95638606081543,42.09459648693848C24.58148786081543,42.47155148693848,25.34087206081543,42.43370048693848,25.93361716081543,41.996055486938474L39.72049946081543,31.803787486938475L39.72119146081543,31.805713486938476C40.87724846081543,30.951181486938477,40.87724846081543,29.051258486938476,39.72119146081543,28.196723486938474L25.93430786081543,18.004454466938476C25.34154106081543,17.566382497938477,24.58189036081543,17.528297336938476,23.95655176081543,17.905300526938476C23.331214550815428,18.282302856938475,22.94121174983543,19.013489686938478,22.94117546081543,19.808949986938476L22.94117546081543,40.191558486938476Z",fill:"#FFFFFF","fill-opacity":"1",style:{"mix-blend-mode":"passthrough"}},null,-1)])])}const ao=qe(lo,[["render",to]]),so={class:"grid-gap-4 px-10 grid-columns-xxl-8 grid-columns-xl-7 grid-columns-lg-6 grid-columns-md-5 grid-columns-sm-4 grid-columns-xs-3 grid-columns-p-2 grid-columns-p-1"},no={class:"position-relative episode-image"},io=["onClick"],ro={class:"h10"},uo={class:"h10 text-ellipsis-10 text-info episode-content"},po={class:"flex grid-gap-2 p-4 flex-center episode-title"},co={class:"font-weight-600"},_o=["onClick"],mo=["onClick"],fo=["onClick"],go=["onClick"],vo={class:"episode-image flex flex-center flex-column grid-gap-4"},xo={class:"h10 text-info"},ho={class:"h10 text-info"},yo={key:1,class:"grid-column-1 input-button rounded-4 flex flex-column episode-item"},bo={class:"episode-image flex flex-center flex-column grid-gap-4"},ko={key:0,class:"font-weight-600"},wo={key:1,class:"font-weight-600"},Co={key:2,class:"flex flex-column grid-gap-4"},So={class:"flex flex-center grid-gap-2 w-100"},Vo=Te({__name:"episodes",props:{find:{default:()=>({})}},emits:["update"],setup(he,{emit:re}){const H=he,Q=re,U=c(H.find);Je(()=>H.find,u=>{U.value=u});const b=u=>{ke.push("/generate/drama/"+H.find.id+"/"+u.id)},k=c(!1),G=()=>{k.value||(k.value=!0,L.post("/app/shortplay/api/Generate/continueEpisode",{...v,drama_id:H.find.id}).then(u=>{u.code===D.SUCCESS?(U.value.continue_episode_state=1,R()):S.error(u.msg)}).finally(()=>{k.value=!1}))},v=we({id:"",model_id:"",title:"",content:"",episode_no:"",episode_sum:1}),I={title:[{required:!0,message:"请输入分集标题",trigger:"blur"}],content:[{required:!0,message:"请输入分集内容",trigger:"blur"}]},f=c(null),N=c(!1),C=c("form"),B=()=>{N.value=!0,v.episode_sum=H.find.episode_sum-H.find.episode_num},A=c(),O=(u,_)=>{N.value=!0,C.value="form",A.value=_,v.id=u.id,v.title=u.title,v.content=u.content,v.episode_no=u.episode_no},E=()=>{A.value<U.value.episodes.length-1&&A.value++,O(U.value.episodes[A.value],A.value)},g=()=>{A.value>0&&A.value--,O(U.value.episodes[A.value],A.value)},R=()=>{f.value?.resetFields?.(),C.value="form",v.id="",v.model_id="",v.title="",v.content="",v.episode_no="",v.episode_sum=1,N.value=!1},oe=()=>{if(C.value==="ai"){if(!v.model_id){S.error("请选择AI模型");return}G();return}f.value.validate().then(u=>{if(u){if(k.value)return;k.value=!0,L.post("/app/shortplay/api/DramaEpisode/create",{...v,drama_id:H.find.id}).then(_=>{_.code===D.SUCCESS?(S.success(_.msg),R(),Q("update")):S.error(_.msg)}).catch(()=>{S.error("创建分集失败")}).finally(()=>{k.value=!1})}})},fe=u=>{rl.confirm(`确定删除第${u.episode_no}集【${u.title}】吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",beforeClose:(_,Z,le)=>{_==="confirm"?(Z.confirmButtonLoading=!0,L.post("/app/shortplay/api/DramaEpisode/delete",{id:u.id,drama_id:H.find.id}).then(ie=>{ie.code===D.SUCCESS?(Q("update"),le()):S.error(ie.msg)}).catch(()=>{S.error("删除分集失败")}).finally(()=>{Z.confirmButtonLoading=!1})):le()}})},ee=u=>{const _=document.createElement("a");_.href=u.video_path,_.download=u.drama_id+"_"+u.episode_id+".mp4",_.target="_blank",_.click()};return(u,_)=>{const Z=el,le=Ge,ie=T("More"),q=ll,ce=T("Plus"),h=T("Loading"),a=yl,_e=Xe,te=Ke,W=Ze,ue=zl,ye=al,J=Ye,ae=Il,F=cl,K=hl;return s(),m(z,null,[o("div",so,[(s(!0),m(z,null,de(e(U).episodes,($,me)=>(s(),m("div",{class:"grid-column-1 input-button rounded-4 flex flex-column episode-item",key:$.id},[o("div",no,[l(Z,{src:$.cover,class:"episode-image"},{default:t(()=>[o("div",{class:"flex flex-column grid-gap-4 flex-center pointer",onClick:j(se=>b($),["stop"])},[o("span",ro,y($.title),1),o("span",uo,y($.outline),1)],8,io)]),_:2},1032,["src"]),$.video_path?(s(),w(le,{key:0,class:"play-icon pointer",size:"36",onClick:se=>e(ke).push("/play/"+H.find.id+"/"+$.id+"?view=share")},{default:t(()=>[l(ao)]),_:1},8,["onClick"])):X("",!0)]),o("div",po,[o("span",co,"第 "+y($.episode_no)+" 集",1)]),l(q,{placement:"bottom-end","popper-class":"episode-popover",width:"100px",teleported:!1,onClick:_[2]||(_[2]=j(()=>{},["stop"]))},{reference:t(()=>[l(le,{class:"more-icon pointer",onClick:_[0]||(_[0]=j(()=>{},["stop"]))},{default:t(()=>[l(ie)]),_:1})]),default:t(()=>[o("div",{class:"flex flex-column grid-gap-2 h10",onClick:_[1]||(_[1]=j(()=>{},["stop"]))},[o("span",{class:"text-center py-2 pointer",onClick:j(se=>b($),["stop"])},"工程",8,_o),o("span",{class:"text-center py-2 pointer",onClick:j(se=>O($,me),["stop"])},"编辑",8,mo),$.video_path?(s(),m("span",{key:0,class:"text-center py-2 pointer",onClick:j(se=>ee($),["stop"])},"下载",8,fo)):X("",!0),o("span",{class:"text-center py-2 pointer",onClick:j(se=>fe($),["stop"])},"删除",8,go)])]),_:2},1024)]))),128)),e(U).episode_num<e(U).episode_sum?(s(),m(z,{key:0},[e(U).continue_episode_state?(s(),m("div",yo,[o("div",bo,[l(le,{size:"36"},{default:t(()=>[l(h,{class:"circular"})]),_:1}),_[9]||(_[9]=o("span",{class:"h10 text-info"},"续写分集中...",-1))])])):We((s(),m("div",{key:0,class:"grid-column-1 input-button rounded-4 flex flex-column episode-item",onClick:B},[o("div",vo,[l(le,{size:"36"},{default:t(()=>[l(ce)]),_:1}),o("span",xo,"添加第"+y(e(U).episode_num+1)+"集",1),o("span",ho,"全 "+y(e(U).episode_sum)+" 集，更新至 "+y(e(U).episode_num)+" 集",1)])])),[[K,e(k)]])],64)):X("",!0)]),l(F,{modelValue:e(N),"onUpdate:modelValue":_[8]||(_[8]=$=>Ie(N)?N.value=$:null),class:"generate-scene-dialog",draggable:"",width:"min(100%,800px)",onClose:R},{header:t(()=>[e(v).id?(s(),m("span",wo,"编辑第"+y(e(v).episode_no)+"集",1)):(s(),m("span",ko,"创建分集"))]),footer:t(()=>[o("div",So,[l(J,{type:"info",onClick:R,disabled:e(k)},{default:t(()=>[..._[10]||(_[10]=[Y("取消",-1)])]),_:1},8,["disabled"]),_[15]||(_[15]=o("div",{class:"flex-1"},null,-1)),e(v).id?(s(),w(J,{key:0,type:"primary",onClick:g,disabled:e(k)||e(A)<=0},{default:t(()=>[..._[11]||(_[11]=[Y("上一集",-1)])]),_:1},8,["disabled"])):X("",!0),e(v).id?(s(),w(J,{key:1,type:"primary",onClick:E,disabled:e(k)||e(A)>=e(U).episodes.length-1},{default:t(()=>[..._[12]||(_[12]=[Y("下一集",-1)])]),_:1},8,["disabled"])):X("",!0),!e(v).id&&e(C)==="ai"?(s(),m(z,{key:2},[!e(v).id&&e(C)==="ai"?(s(),w(ae,{key:0,modelValue:e(v).episode_sum,"onUpdate:modelValue":_[7]||(_[7]=$=>e(v).episode_sum=$),min:1,max:e(U).episode_sum-e(U).episode_num,disabled:e(k)},{prefix:t(()=>[..._[13]||(_[13]=[o("span",null,"集数",-1)])]),_:1},8,["modelValue","max","disabled"])):X("",!0),l(J,{type:"success",onClick:oe,disabled:e(k)},{default:t(()=>[Y("生成"+y(e(v).episode_sum)+"集",1)]),_:1},8,["disabled"])],64)):(s(),w(J,{key:3,type:"success",onClick:oe,disabled:e(k)},{default:t(()=>[..._[14]||(_[14]=[Y("提交",-1)])]),_:1},8,["disabled"]))])]),default:t(()=>[e(v).id?X("",!0):(s(),w(a,{key:0,modelValue:e(C),"onUpdate:modelValue":_[3]||(_[3]=$=>Ie(C)?C.value=$:null),disabled:e(k),options:[{label:"填写分集",value:"form"},{label:"AI续写",value:"ai"}],class:"tabs-segmented border"},null,8,["modelValue","disabled"])),e(C)==="form"?(s(),w(W,{key:1,"label-position":"top",model:e(v),rules:I,ref_key:"createEpisodeFormRef",ref:f},{default:t(()=>[l(te,{label:"分集标题",prop:"title"},{default:t(()=>[l(_e,{modelValue:e(v).title,"onUpdate:modelValue":_[4]||(_[4]=$=>e(v).title=$),placeholder:"请输入分集标题"},null,8,["modelValue"])]),_:1}),l(te,{label:"分集内容",prop:"content"},{default:t(()=>[l(_e,{modelValue:e(v).content,"onUpdate:modelValue":_[5]||(_[5]=$=>e(v).content=$),type:"textarea",autosize:{minRows:10,maxRows:30},placeholder:"请输入分集内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):X("",!0),e(C)==="ai"?(s(),m("div",Co,[l(ue,{title:"灵感缺乏？使用AI续写",type:"success",closable:!1}),We(l(ye,{modelValue:e(v).model_id,"onUpdate:modelValue":_[6]||(_[6]=$=>e(v).model_id=$),scene:"creative_episode","no-init":""},null,8,["modelValue"]),[[K,e(k)]])])):X("",!0)]),_:1},8,["modelValue"])],64)}}}),xl=qe(Vo,[["__scopeId","data-v-000b77f0"]]),Qo={class:"flex drama-details"},$o={class:"drama-image"},Uo={class:"flex flex-center h-100 bg rounded-4"},Eo={key:0,class:"flex flex-column grid-gap-1 flex-center"},Ro={key:1,class:"flex flex-column grid-gap-1"},zo={class:"drama-image-action flex flex-center"},Io={key:0,class:"h10 flex grid-gap-2 action-cover"},Lo={key:1,class:"h10 flex grid-gap-2 action-cover"},Po={key:1,class:"flex flex-column grid-gap-4 flex-1"},Ao={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},Fo={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},Do={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},Bo={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page flex-y-center"},Mo=["view"],To={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},Go={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},qo={class:"text-secondary"},No={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},jo={class:"text-info text-pre"},Oo={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},Wo={class:"text-info text-pre"},Ho={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},Jo={class:"text-info text-pre"},Zo={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},Ko={class:"text-info text-pre"},Xo={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},Yo={class:"text-info text-pre"},et={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},lt={class:"text-info text-pre"},ot={class:"flex grid-gap-1 rounded-4 p-4 hover-bg-page"},tt={class:"text-secondary text-pre"},at={class:"h10"},st={class:"flex flex-x-flex-end flex-y-center grid-gap-4"},nt={class:"font-weight-600"},it=Te({__name:"details",props:{find:{default:()=>({})}},emits:["update"],setup(he,{emit:re}){const H=tl(),Q=he,U=re,b=c(Q.find);Je(()=>Q.find,h=>{b.value=h,u.id=h.id,u.title=h.title,u.aspect_ratio=h.aspect_ratio,u.style_id=h.style_id,u.overall_hook=h.overall_hook,u.core_catharsis_mechanism=h.core_catharsis_mechanism,u.main_conflict=h.main_conflict,u.relationship_mainline=h.relationship_mainline,u.description=h.description,u.background_description=h.background_description,u.outline=h.outline,_.value=h.style});const k=c(!1),G=c(),v=c({}),I=()=>{k.value=!0},f=c(!1),N=h=>H.hasLogin()?(f.value=!0,!0):(G.value?.clearFiles(),!1),C=h=>{if(h.code===D.SUCCESS)switch(h.data.dir_name){case"drama/cover":v.value=h.data,G.value?.clearFiles(),L.post("/app/shortplay/api/Works/updateCover",{id:Q.find.id,cover:h.data.url}).then(a=>{a.code===D.SUCCESS?S.success("上传封面成功"):S.info(a.msg)}).catch(()=>{S.error("上传封面失败")}).finally(()=>{k.value=!1,f.value=!1,U("update")});break}else S.error(h.msg),f.value=!1},B=()=>{G.value?.clearFiles(),f.value=!1},A=c(),O=c(),E=c(!1),g=c({id:""}),R=c(!1),oe=h=>{g.value=h,R.value=!0,L.post("/app/shortplay/api/Generate/dramaCover",{id:Q.find.id,model_id:g.value.id}).then(a=>{a.code===D.SUCCESS?(S.success(a.msg),b.value.cover=null,b.value.cover_state=1):S.error(a.msg)}).catch(()=>{S.error("生成封面失败")}).finally(()=>{R.value=!1,O.value?.hide()})},fe=h=>{R.value||(A.value=h.target,bl(()=>{E.value=!0}))},ee=c("view"),u=we({id:"",title:"",aspect_ratio:"",style_id:"",overall_hook:"",core_catharsis_mechanism:"",main_conflict:"",relationship_mainline:"",description:"",background_description:"",outline:""}),_=c({id:""}),Z=c(),le=c(),ie=h=>{_.value=h,le.value?.hide()},q=c(!1),ce=()=>{q.value||(q.value=!0,L.post("/app/shortplay/api/Drama/update",u).then(h=>{h.code===D.SUCCESS?(S.success("保存成功"),ee.value="view",U("update")):S.error(h.msg)}).catch(()=>{S.error("保存失败")}).finally(()=>{q.value=!1}))};return ol(()=>{Q.find.id&&(u.id=Q.find.id,u.title=Q.find.title,u.aspect_ratio=Q.find.aspect_ratio,u.style_id=Q.find.style_id,u.overall_hook=Q.find.overall_hook,u.core_catharsis_mechanism=Q.find.core_catharsis_mechanism,u.main_conflict=Q.find.main_conflict,u.relationship_mainline=Q.find.relationship_mainline,u.description=Q.find.description,u.background_description=Q.find.background_description,u.outline=Q.find.outline,_.value=Q.find.style)}),(h,a)=>{const _e=T("Loading"),te=Ge,W=Ll,ue=Ye,ye=T("Edit"),J=Pl,ae=Xe,F=Ke,K=Wl,$=el,me=Ze,se=Jl,Ce=ll,Le=_l,Se=cl,Ve=al,Qe=hl;return s(),m("div",Qo,[o("div",$o,[l(W,{src:e(b).cover,class:"drama-image","preview-src-list":[e(b).cover]},{placeholder:t(()=>[o("div",Uo,[e(b).cover_state?(s(),m("div",Eo,[l(te,{size:"40"},{default:t(()=>[l(_e,{class:"circular"})]),_:1}),a[17]||(a[17]=o("span",{class:"h10 font-weight-600 text-success"},"AI正在生成封面...",-1))])):(s(),m("div",Ro,[o("span",null,y(e(b).title),1)]))])]),_:1},8,["src","preview-src-list"]),o("div",zo,[e(R)?e(R)?(s(),m("div",Lo,[...a[20]||(a[20]=[o("span",{class:"text-success"},"提交中...",-1)])])):X("",!0):(s(),m("div",Io,[l(ue,{type:"success",onClick:a[0]||(a[0]=j(V=>fe(V),["stop"])),size:"small"},{default:t(()=>[...a[18]||(a[18]=[Y("AI生成",-1)])]),_:1}),l(ue,{type:"info",onClick:a[1]||(a[1]=j(V=>I(),["stop"])),size:"small"},{default:t(()=>[...a[19]||(a[19]=[Y("上传",-1)])]),_:1})]))])]),e(ee)==="view"?(s(),m("div",{key:0,class:"flex flex-center grid-gap-4 position-edit",onClick:a[2]||(a[2]=V=>ee.value="edit")},[l(te,null,{default:t(()=>[l(ye)]),_:1}),a[21]||(a[21]=o("span",null,"编辑",-1))])):X("",!0),e(ee)==="view"?(s(),m("div",Po,[o("div",Ao,[a[22]||(a[22]=o("span",{class:"font-weight-600 text-nowrap"},"剧名：",-1)),o("span",null,y(e(b).title),1)]),o("div",Fo,[a[23]||(a[23]=o("span",{class:"font-weight-600 text-nowrap"},"集数：",-1)),o("span",null,"全 "+y(e(b).episode_sum)+" 集，",1),o("span",null,"更新至 "+y(e(b).episode_num)+" 集",1)]),o("div",Do,[a[24]||(a[24]=o("span",{class:"font-weight-600 text-nowrap"},"时长：",-1)),o("span",null,"每集 "+y(e(b).episode_duration)+" 秒",1)]),o("div",Bo,[a[25]||(a[25]=o("span",{class:"font-weight-600 text-nowrap"},"画面：",-1)),o("span",{class:"icon-aspect-ratio",view:e(b).aspect_ratio},null,8,Mo),l(J,{type:"success",size:"small"},{default:t(()=>[Y(y(e(b).aspect_ratio),1)]),_:1})]),o("div",To,[a[26]||(a[26]=o("span",{class:"font-weight-600 text-nowrap"},"画风：",-1)),l(J,{type:"warning",size:"small"},{default:t(()=>[Y(y(e(b).style.name),1)]),_:1})]),o("div",Go,[a[27]||(a[27]=o("span",{class:"font-weight-600 text-nowrap"},"创建：",-1)),o("span",qo,y(e(b).create_time),1)]),o("div",No,[a[28]||(a[28]=o("span",{class:"font-weight-600 text-nowrap"},"卖点：",-1)),o("span",jo,y(e(b).overall_hook),1)]),o("div",Oo,[a[29]||(a[29]=o("span",{class:"font-weight-600 text-nowrap"},"爽点：",-1)),o("span",Wo,y(e(b).core_catharsis_mechanism),1)]),o("div",Ho,[a[30]||(a[30]=o("span",{class:"font-weight-600 text-nowrap"},"主线：",-1)),o("span",Jo,y(e(b).main_conflict),1)]),o("div",Zo,[a[31]||(a[31]=o("span",{class:"font-weight-600 text-nowrap"},"关系：",-1)),o("span",Ko,y(e(b).relationship_mainline),1)]),o("div",Xo,[a[32]||(a[32]=o("span",{class:"font-weight-600 text-nowrap"},"描述：",-1)),o("span",Yo,y(e(b).description),1)]),o("div",et,[a[33]||(a[33]=o("span",{class:"font-weight-600 text-nowrap"},"背景：",-1)),o("span",lt,y(e(b).background_description),1)]),o("div",ot,[a[34]||(a[34]=o("span",{class:"font-weight-600 text-nowrap"},"大纲：",-1)),o("span",tt,y(e(b).outline),1)])])):(s(),w(me,{key:2,size:"large",class:"flex-1",model:e(u),disabled:e(q)},{default:t(()=>[l(F,{label:"剧名"},{default:t(()=>[l(ae,{modelValue:e(u).title,"onUpdate:modelValue":a[3]||(a[3]=V=>e(u).title=V),class:"input-textarea"},null,8,["modelValue"])]),_:1}),l(F,{label:"画面"},{default:t(()=>[l(K,{modelValue:e(u).aspect_ratio,"onUpdate:modelValue":a[4]||(a[4]=V=>e(u).aspect_ratio=V)},null,8,["modelValue"])]),_:1}),l(F,{label:"画风"},{default:t(()=>[o("div",{class:"flex flex-center grid-gap-2 input-button rounded-4 py-2 px-6",ref_key:"styleButtonRef",ref:Z},[e(_).id?(s(),m(z,{key:1},[l($,{src:e(_).image,alt:e(_).name,class:"icon-style"},null,8,["src","alt"]),o("span",at,y(e(_).name),1)],64)):(s(),m(z,{key:0},[l(te,{alt:"风格",class:"icon-style"},{default:t(()=>[l(Hl)]),_:1}),a[35]||(a[35]=o("span",{class:"h10"},"风格",-1))],64))],512)]),_:1}),l(F,{label:"卖点"},{default:t(()=>[l(ae,{modelValue:e(u).overall_hook,"onUpdate:modelValue":a[5]||(a[5]=V=>e(u).overall_hook=V),type:"textarea",autosize:{minRows:4,maxRows:20},class:"input-textarea"},null,8,["modelValue"])]),_:1}),l(F,{label:"爽点"},{default:t(()=>[l(ae,{modelValue:e(u).core_catharsis_mechanism,"onUpdate:modelValue":a[6]||(a[6]=V=>e(u).core_catharsis_mechanism=V),type:"textarea",autosize:{minRows:4,maxRows:20},class:"input-textarea"},null,8,["modelValue"])]),_:1}),l(F,{label:"主线"},{default:t(()=>[l(ae,{modelValue:e(u).main_conflict,"onUpdate:modelValue":a[7]||(a[7]=V=>e(u).main_conflict=V),type:"textarea",autosize:{minRows:4,maxRows:20},class:"input-textarea"},null,8,["modelValue"])]),_:1}),l(F,{label:"关系"},{default:t(()=>[l(ae,{modelValue:e(u).relationship_mainline,"onUpdate:modelValue":a[8]||(a[8]=V=>e(u).relationship_mainline=V),type:"textarea",autosize:{minRows:4,maxRows:20},class:"input-textarea"},null,8,["modelValue"])]),_:1}),l(F,{label:"描述"},{default:t(()=>[l(ae,{modelValue:e(u).description,"onUpdate:modelValue":a[9]||(a[9]=V=>e(u).description=V),type:"textarea",autosize:{minRows:4,maxRows:20},class:"input-textarea"},null,8,["modelValue"])]),_:1}),l(F,{label:"背景"},{default:t(()=>[l(ae,{modelValue:e(u).background_description,"onUpdate:modelValue":a[10]||(a[10]=V=>e(u).background_description=V),type:"textarea",autosize:{minRows:4,maxRows:20},class:"input-textarea"},null,8,["modelValue"])]),_:1}),l(F,{label:"大纲"},{default:t(()=>[l(ae,{modelValue:e(u).outline,"onUpdate:modelValue":a[11]||(a[11]=V=>e(u).outline=V),type:"textarea",autosize:{minRows:10,maxRows:50},class:"input-textarea"},null,8,["modelValue"])]),_:1}),o("div",st,[l(ue,{type:"info",bg:"",text:"",onClick:a[12]||(a[12]=V=>ee.value="view"),disabled:e(q)},{default:t(()=>[...a[36]||(a[36]=[Y("取消",-1)])]),_:1},8,["disabled"]),l(ue,{type:"success",bg:"",text:"",onClick:ce,loading:e(q)},{default:t(()=>[...a[37]||(a[37]=[Y("保存",-1)])]),_:1},8,["loading"])])]),_:1},8,["model","disabled"])),l(Ce,{ref_key:"stylePopoverRef",ref:le,"virtual-ref":e(Z),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,880px)",trigger:"click"},{default:t(()=>[l(se,{modelValue:e(u).style,"onUpdate:modelValue":a[13]||(a[13]=V=>e(u).style=V),onSelect:ie},null,8,["modelValue"])]),_:1},8,["virtual-ref"]),l(Se,{modelValue:e(k),"onUpdate:modelValue":a[14]||(a[14]=V=>Ie(k)?k.value=V:null),class:"drama-dialog",draggable:""},{header:t(()=>[o("span",nt,"《"+y(e(b).title)+"》上传封面",1)]),default:t(()=>[We((s(),w(Le,{ref_key:"uploadCoverRef",ref:G,class:"input-upload flex-1",drag:"",data:{dir_name:"drama/cover",dir_title:"剧本封面"},action:e(L).getCompleteUrl("app/shortplay/api/Uploads/upload"),"before-upload":N,headers:e(L).getHeaders(),accept:"image/jpeg,image/png",limit:1,type:"cover","on-success":C,"show-file-list":!1,"on-error":B},{default:t(()=>[e(v).url?(s(),w(W,{key:1,src:e(v).url,class:"image-cover",fit:"contain"},null,8,["src"])):(s(),m(z,{key:0},[l(te,{class:"el-icon--upload"},{default:t(()=>[l(Ol)]),_:1}),a[38]||(a[38]=o("div",{class:"el-upload__text"},[o("span",{class:"h10"},"拖拽剧本封面到此处或"),o("span",{class:"h10"},"点击上传")],-1)),a[39]||(a[39]=o("div",{class:"el-upload__text"},[o("span",{class:"h10"},"支持上传格式："),o("span",{class:"h10"},"PNG, JPG, JPEG")],-1)),a[40]||(a[40]=o("div",{class:"el-upload__text"},[o("span",{class:"h10"},"封面比例："),o("span",{class:"h10"},"4:3")],-1))],64))]),_:1},8,["action","headers"])),[[Qe,e(f)]])]),_:1},8,["modelValue"]),l(Ce,{visible:e(E),"onUpdate:visible":a[16]||(a[16]=V=>Ie(E)?E.value=V:null),ref_key:"modelPopoverRef",ref:O,"virtual-ref":e(A),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,380px)",trigger:"click"},{default:t(()=>[We(l(Ve,{modelValue:e(g).id,"onUpdate:modelValue":a[15]||(a[15]=V=>e(g).id=V),onSelect:oe,scene:"drama_cover","no-init":""},null,8,["modelValue"]),[[Qe,e(R)]])]),_:1},8,["visible","virtual-ref"])])}}}),rt=qe(it,[["__scopeId","data-v-1865f4da"]]),dt={class:"flex flex-column draw-module"},ut={class:"flex-1 flex grid-gap-10 overflow-hidden"},pt={class:"flex-1 flex flex-column grid-gap-4 overflow-hidden"},ct={class:"grid-columns-xxl-7 grid-columns-xl-6 grid-columns-lg-5 grid-columns-md-4 grid-columns-sm-3 grid-columns-xs-2 grid-columns-p-1 grid-gap-4"},_t=["onClick"],mt=["onClick"],ft={class:"flex grid-gap-2 actor-status"},gt={class:"flex flex-column flex-y-flex-end grid-gap-2"},vt={class:"flex flex-column grid-gap-2 actor-info"},xt={class:"actor-action flex flex-center px-4"},ht={key:0},yt={key:1},bt={key:0},kt={key:1},wt={key:2},Ct={class:"actor-form-wrapper bg-overlay border rounded-4 actor-form flex flex-column grid-gap-4"},St={class:"border-bottom flex flex-center"},Vt={class:"flex flex-column grid-gap-2 px-4"},Qt={class:"flex grid-gap-2"},$t={class:"flex flex-column grid-gap-2 px-4"},Ut={class:"bg rounded-4 p-4 border"},Et={class:"flex flex-y-center grid-gap-2"},Rt={class:"h10 text-ellipsis-1",style:{"max-width":"60px"}},zt={class:"h10 text-ellipsis-1",style:{"max-width":"60px"}},It={class:"bg-overlay rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover"},Lt={class:"flex flex-center grid-gap-2"},Pt={class:"h10"},At={key:0,class:"grid-columns-2 grid-gap-4 p-4"},Ft=["onClick"],Dt=Te({__name:"actors",emits:["update:drama"],setup(he,{emit:re}){const H=kl(),Q=tl(),{USERINFO:U}=dl(Q),b=Nl(),{WEBCONFIG:k}=dl(b),G=c(H.params.drama_id),v=c(H.params.episode_id),I=re,f=c({}),N=()=>{G.value&&L.get("/app/shortplay/api/Works/details",{params:{id:G.value}}).then(i=>{i.code===D.SUCCESS?(f.value=i.data,I("update:drama",f.value)):S.error(i.msg)}).catch(()=>{S.error("获取短剧详情失败")})},C=we({type:"drama",name:"",actor_id:"",species_type:null,gender:null,age:null,drama_id:G.value,episode_id:v.value}),B=c([]),A=c(!1),O=c(null),E=c(),g=c({actor_id:"",drama_id:G.value,episode_id:v.value,name:"",species_type:null,gender:null,age:null,remarks:"",image_model_id:null,three_view_model_id:null,image_state:!1,three_view_image_state:!1,image_reference_state:!1,reference_headimg:"",image:"",three_view_image:""});Je(B,()=>{try{const i=B.value.find(n=>n.id===E.value?.id);if(i)ie(i);else{const n=B.value.find(ne=>ne.is_edit);n?ie(n):(E.value=void 0,g.value={id:"",drama_id:G.value,episode_id:v.value,name:"",species_type:null,gender:null,age:null,remarks:"",image_model_id:null,three_view_model_id:null,image_state:!1,three_view_image_state:!1,image_reference_state:!1,reference_headimg:"",image:"",three_view_image:""})}}catch(i){console.error("watch actorList error",i)}});const R=()=>{A.value=!0,L.get("/app/shortplay/api/Actor/index",{params:C}).then(i=>{i.code===D.SUCCESS&&(B.value=i.data)}).catch(i=>{console.error("getActorList error",i)}).finally(()=>{A.value=!1})},oe=c(!1),fe=c([]),ee=c([]),u=c(!1),_=we({alias_id:"",scene:"actor_image",page:1,page_size:100});let Z=null;const le=()=>{Z&&Z.abort(),Z=new AbortController,u.value=!0,ee.value=[],L.get("/app/model/api/Task/index",{params:_,signal:Z?.signal}).then(i=>{i.code===D.SUCCESS&&(ee.value=i.data.data)}).finally(()=>{u.value=!1})},ie=i=>{i.is_edit&&(E.value=i,g.value.id=i.id,g.value.name=i.name,g.value.species_type=i.species_type,g.value.gender=i.gender,g.value.age=i.age,g.value.remarks=i.remarks,g.value.image=i.headimg,g.value.three_view_image=i.three_view_image,g.value.image_reference_state=!1,g.value.reference_headimg="",_.alias_id=i.id,le())},q=c(null),ce=c(null),h=c({}),a=i=>{i?(h.value=i,g.value.image_state=!0):(h.value={},g.value.image_model_id=null,g.value.image_state=!1),q.value?.hide()},_e=c(null),te=c(null),W=c({}),ue=i=>{i?(W.value=i,g.value.three_view_image_state=!0):(W.value={},g.value.three_view_model_id=null,g.value.three_view_image_state=!1),_e.value?.hide()},ye=ul([h,W]),J=c(!1),ae=()=>{J.value||E.value.status_enum.value==="pending"||(J.value=!0,L.post("/app/shortplay/api/Actor/initializing",{...g.value,image:"",three_view_image:""}).then(i=>{i.code===D.SUCCESS?(E.value.status=i.data.status,E.value.status_enum=i.data.status_enum):S.error(i.msg)}).catch(()=>{S.error("生成图片失败")}).finally(()=>{J.value=!1}))},F=c(null),K=c(!1),$=i=>{K.value=!1,i.code===D.SUCCESS?(g.value.image_reference_state=!0,g.value.reference_headimg=i.data.url):S.error(i.msg),F.value?.clearFiles()},me=()=>{K.value=!1,F.value?.clearFiles()},se=c(!1),Ce=i=>{se.value||(se.value=!0,L.post("/app/shortplay/api/Actor/ReplaceActor",{id:E.value.id,task_id:i.id}).then(n=>{n.code===D.SUCCESS?(E.value.headimg=i.result.image_path,E.value.character_look_id||(E.value.origin_headimg=i.result.image_path),E.value.status=n.data.status,E.value.status_enum=n.data.status_enum,g.value.image=i.result.image_path):S.error(n.msg)}).catch(()=>{S.error("替换演员失败")}).finally(()=>{se.value=!1}))},Le=i=>{L.post("/app/shortplay/api/DramaEpisode/deleteActor",{id:i.id,drama_id:G.value,episode_id:v.value}).then(n=>{n.code===D.SUCCESS?(S.success(n.msg),R()):S.error(n.msg)})},Se=c(),Ve=i=>{E.value=i,Se.value?.open({modelScene:"dialogue_voice",voice:i.voice})},Qe=i=>{L.post("/app/shortplay/api/Actor/voice",{id:E.value.id,drama_id:G.value,episode_id:v.value,apply_scope:"episode",voice:i}).then(n=>{n.code===D.SUCCESS?(S.success(n.msg),R()):S.error(n.msg)}).catch(n=>{console.error("handleVoiceSuccess error",n),S.error("设置演员音色失败")})},V=c(),p=i=>{E.value=i,V.value?.open?.({actor:i})},r=i=>{let n="/app/shortplay/api/Generate/characterLook";i.type==="actor"&&(n="/app/shortplay/api/DramaEpisode/CharacterLook"),L.post(n,{drama_id:G.value,episode_id:v.value,actor_id:E.value.id,character_look_id:i.id,actor_costume_model_id:i.actor_costume_model_id,actor_costume_three_view_model_id:i.actor_costume_three_view_model_id}).then(ne=>{if(ne.code===D.SUCCESS){S.success(ne.msg);const M=B.value.find(pe=>pe.id===ne.data.id);i.type!="actor"&&M?M.character_look_state=1:R()}else S.error(ne.msg)})},{subscribe:P,unsubscribeAll:$e}=fl(),Pe=()=>{P("private-generateactorimage-"+U.value?.user,i=>{console.log("channels complete info message",i);const n=B.value.find(ne=>ne.id===i.id);n&&(n.status_enum=i.status,i.image&&(n.headimg=i.image)),O.value?.subscribe?.("generateactorimage",i)}),P("private-generateactorthreeviewimage-"+U.value?.user,i=>{console.log("channels complete info message",i);const n=B.value.find(ne=>ne.id===i.id);n&&(n.status_enum=i.status,i.image&&(n.three_view_image=i.image)),O.value?.subscribe?.("generateactorthreeviewimage",i)})};return ol(()=>{R(),N(),Pe()}),ml(()=>{console.log("actors unmounted"),$e()}),(i,n)=>{const ne=T("Search"),M=Ge,pe=Xe,Ue=Ke,ge=Fl,ve=Al,Ne=Ze,Ae=T("Plus"),xe=el,sl=T("Delete"),Fe=wl,nl=T("UserFilled"),je=Ye,be=Cl,De=T("Close"),Oe=T("ArrowDown"),il=T("PictureRounded"),Be=ll,x=_l,Ee=T("Top"),gl=al,vl=Sl,$l=Vl,Ul=Kl,El=Xl,Rl=Zl;return s(),m("div",dt,[o("div",ut,[o("div",pt,[l(Ne,{class:"flex flex-center grid-gap-4",onSubmit:j(R,["prevent"])},{default:t(()=>[l(Ue,{class:"mb-0"},{default:t(()=>[l(pe,{modelValue:e(C).name,"onUpdate:modelValue":n[0]||(n[0]=d=>e(C).name=d),placeholder:"搜索演员",clearable:"",onChange:R},{suffix:t(()=>[l(M,null,{default:t(()=>[l(ne)]),_:1})]),_:1},8,["modelValue"])]),_:1}),n[16]||(n[16]=o("div",{class:"flex-1"},null,-1)),l(Ue,{class:"mb-0",style:{width:"80px"}},{default:t(()=>[l(ve,{modelValue:e(C).species_type,"onUpdate:modelValue":n[1]||(n[1]=d=>e(C).species_type=d),placeholder:"物种",clearable:"",teleported:!1,onChange:R},{default:t(()=>[(s(!0),m(z,null,de(e(k)?.enum?.actor_species_type,d=>(s(),w(ge,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(Ue,{class:"mb-0",style:{width:"80px"}},{default:t(()=>[l(ve,{modelValue:e(C).gender,"onUpdate:modelValue":n[2]||(n[2]=d=>e(C).gender=d),placeholder:"性别",clearable:"",teleported:!1,onChange:R},{default:t(()=>[(s(!0),m(z,null,de(e(k)?.enum?.actor_gender,d=>(s(),w(ge,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(Ue,{class:"mb-0",style:{width:"80px"}},{default:t(()=>[l(ve,{modelValue:e(C).age,"onUpdate:modelValue":n[3]||(n[3]=d=>e(C).age=d),placeholder:"年龄",clearable:"",teleported:!1,onChange:R},{default:t(()=>[(s(!0),m(z,null,de(e(k)?.enum?.actor_age,d=>(s(),w(ge,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(be,{class:"flex-1"},{default:t(()=>[o("div",ct,[o("div",{class:"grid-column-1 rounded-4 p-4 actor-item flex flex-column flex-center grid-gap-4 pointer bg-overlay",onClick:n[4]||(n[4]=d=>e(O)?.open?.(null,e(C).drama_id,e(C).episode_id))},[l(M,{class:"rounded-4",size:"20",style:{height:"40px",width:"40px","background-color":"var(--el-fill-color-dark)"}},{default:t(()=>[l(Ae)]),_:1}),n[17]||(n[17]=o("span",null,"添加演员",-1))]),(s(!0),m(z,null,de(e(B),d=>(s(),m("div",{class:Re(["grid-column-1 input-button rounded-4 flex flex-column flex-center grid-gap-2 actor-item bg-overlay border",{"border-success":d.id===e(g).id}]),key:d.id},[l(xe,{src:d.headimg,class:"actor-avatar bg-mosaic",fit:"cover",title:d.is_edit?d.name:"公共角色不可编辑"},{default:t(()=>[Y(y(d.name),1)]),_:2},1032,["src","title"]),d.is_edit?(s(),m("div",{key:0,class:"actor-edit-mask flex flex-column grid-gap-4 flex-center pointer",onClick:Me=>ie(d)},[o("div",{class:"flex flex-center bg-overlay rounded-round p-2 pointer grid-gap-2",onClick:j(Me=>e(O)?.upload?.(d,e(C).drama_id,e(C).episode_id),["stop"])},[l(M,{size:"16"},{default:t(()=>[l(e(Dl))]),_:1}),n[18]||(n[18]=o("span",{class:"h10"},"手动上传",-1))],8,mt),l(Fe,{title:"确定删除该演员吗？",width:"fit-content",onConfirm:Me=>Le(d),placement:"bottom-end"},{reference:t(()=>[o("div",{class:"flex flex-center bg-overlay rounded-round p-2 pointer grid-gap-2",onClick:n[5]||(n[5]=j(()=>{},["stop"]))},[l(M,{size:"16"},{default:t(()=>[l(sl)]),_:1}),n[19]||(n[19]=o("span",{class:"h10"},"删除演员",-1))])]),_:1},8,["onConfirm"])],8,_t)):X("",!0),o("div",ft,[n[20]||(n[20]=o("div",{class:"flex-1"},null,-1)),o("div",gt,[o("span",{class:Re(["actor-tag",["actor-tag--"+d.status_enum.props.type]])},y(d.status_enum.label),3)])]),o("div",vt,[o("div",{class:Re(["actor-name flex flex-center grid-gap-1",{pointer:d.is_edit,"actor-name--success":d.id===e(g).id}])},[l(M,null,{default:t(()=>[l(nl)]),_:1}),o("span",null,y(d.name),1)],2)]),o("div",xt,[l(je,{text:"",bg:"",onClick:Me=>Ve(d),class:"flex-1 text-ellipsis-1"},{default:t(()=>[d.voice?(s(),m("span",ht,"音色:"+y(d.voice.name),1)):(s(),m("span",yt,"演员音色"))]),_:2},1032,["onClick"]),l(je,{text:"",bg:"",onClick:Me=>p(d),class:"flex-1 text-ellipsis-1",disabled:!!d.character_look_state},{default:t(()=>[d.character_look_state?(s(),m("span",bt,"换装中")):d.characterLook?(s(),m("span",kt,y(d.characterLook.title),1)):(s(),m("span",wt,"演员装扮"))]),_:2},1032,["onClick","disabled"])])],2))),128))])]),_:1})]),o("div",Ct,[e(g).id?(s(),m(z,{key:0},[o("div",St,[l(pe,{modelValue:e(g).name,"onUpdate:modelValue":n[6]||(n[6]=d=>e(g).name=d),placeholder:"角色演员",size:"large",class:"actor-form-input flex-1"},null,8,["modelValue"])]),o("div",Vt,[n[21]||(n[21]=o("span",null,"基础信息",-1)),o("div",Qt,[l(ve,{modelValue:e(g).species_type,"onUpdate:modelValue":n[7]||(n[7]=d=>e(g).species_type=d),placeholder:"请选择物种",size:"small",class:"flex-1 actor-form-select"},{default:t(()=>[(s(!0),m(z,null,de(e(k)?.enum?.actor_species_type,d=>(s(),w(ge,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(ve,{modelValue:e(g).gender,"onUpdate:modelValue":n[8]||(n[8]=d=>e(g).gender=d),placeholder:"请选择性别",size:"small",class:"flex-1 actor-form-select"},{default:t(()=>[(s(!0),m(z,null,de(e(k)?.enum?.actor_gender,d=>(s(),w(ge,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(ve,{modelValue:e(g).age,"onUpdate:modelValue":n[9]||(n[9]=d=>e(g).age=d),placeholder:"请选择年龄",size:"small",class:"flex-1 actor-form-select"},{default:t(()=>[(s(!0),m(z,null,de(e(k)?.enum?.actor_age,d=>(s(),w(ge,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),o("div",$t,[n[25]||(n[25]=o("span",null,"角色描述",-1)),o("div",Ut,[l(pe,{modelValue:e(g).remarks,"onUpdate:modelValue":n[10]||(n[10]=d=>e(g).remarks=d),placeholder:"请输入角色描述",size:"small",class:"actor-form-textarea",type:"textarea",autosize:{minRows:6,maxRows:20}},null,8,["modelValue"]),o("div",Et,[o("div",{class:"bg-overlay rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover",ref_key:"modelButtonRef",ref:ce,title:"选择使用AI生成形象图"},[e(h).id?(s(),m(z,{key:0},[l(xe,{src:e(h).icon,alt:e(h).name,shape:"square",size:16},null,8,["src","alt"]),o("span",Rt,y(e(h).name),1),l(M,{size:"16",class:"pointer",onClick:n[11]||(n[11]=j(d=>a(),["stop"]))},{default:t(()=>[l(De)]),_:1})],64)):(s(),m(z,{key:1},[l(M,{size:"16"},{default:t(()=>[l(He)]),_:1}),n[22]||(n[22]=o("span",{class:"h10"},"形象图",-1)),l(M,{size:"16"},{default:t(()=>[l(Oe)]),_:1})],64))],512),o("div",{class:"bg-overlay rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover",ref_key:"threeViewModelButtonRef",ref:te,title:"选择使用AI生成三视图"},[e(W).id?(s(),m(z,{key:0},[l(xe,{src:e(W).icon,alt:e(W).name,shape:"square",size:16},null,8,["src","alt"]),o("span",zt,y(e(W).name),1),l(M,{size:"16",class:"pointer",onClick:n[12]||(n[12]=j(d=>ue(),["stop"]))},{default:t(()=>[l(De)]),_:1})],64)):(s(),m(z,{key:1},[l(M,{size:"16"},{default:t(()=>[l(He)]),_:1}),n[23]||(n[23]=o("span",{class:"h10"},"三视图",-1)),l(M,{size:"16"},{default:t(()=>[l(Oe)]),_:1})],64))],512),l(x,{ref_key:"uploadImageRef",ref:F,title:"添加参考图",data:{dir_name:"actor/reference",dir_title:"演员形象参考照片"},action:e(L).getCompleteUrl("app/shortplay/api/Uploads/upload"),headers:e(L).getHeaders(),accept:"image/jpeg,image/png",limit:1,type:"cover",disabled:e(K),"before-upload":()=>(K.value=!0,!0),"on-success":$,"show-file-list":!1,"on-error":me},{default:t(()=>[o("div",It,[l(Be,{placement:"top",disabled:!e(g).reference_headimg,width:"fit-content"},{reference:t(()=>[!e(g).reference_headimg||e(K)?(s(),w(M,{key:0,size:"16"},{default:t(()=>[e(K)?(s(),w(e(ze),{key:0,class:"circular"})):(s(),w(Ae,{key:1}))]),_:1})):(s(),w(M,{key:1,size:"16",color:"var(--el-color-success)"},{default:t(()=>[l(il)]),_:1}))]),default:t(()=>[l(xe,{src:e(g).reference_headimg,fit:"contain",size:130,shape:"square"},null,8,["src"])]),_:1},8,["disabled"])])]),_:1},8,["action","headers","disabled","before-upload"]),n[24]||(n[24]=o("div",{class:"flex-1"},null,-1)),o("div",Lt,[l(M,{size:"16"},{default:t(()=>[l(pl)]),_:1}),o("span",Pt,y(e(ye)),1)]),o("div",{class:"rounded-round p-3 flex flex-center grid-gap-2 pointer",style:{"background-color":"#FFFFFF",color:"#141414"},onClick:ae},[l(M,{size:"20"},{default:t(()=>[e(J)||e(E).status_enum.value==="pending"?(s(),w(e(ze),{key:0,class:"circular"})):(s(),w(Ee,{key:1}))]),_:1})])])])]),l(Be,{ref_key:"modelPopoverRef",ref:q,"popper-class":"model-popover","virtual-ref":e(ce),"virtual-triggering":"",placement:"bottom",width:"min(100vw,380px)",trigger:"click"},{default:t(()=>[l(gl,{modelValue:e(g).image_model_id,"onUpdate:modelValue":n[13]||(n[13]=d=>e(g).image_model_id=d),onSelect:a,"no-init":"",scene:"actor_image"},null,8,["modelValue"])]),_:1},8,["virtual-ref"]),l(Be,{ref_key:"threeViewModelPopoverRef",ref:_e,"popper-class":"model-popover","virtual-ref":e(te),"virtual-triggering":"",placement:"bottom",width:"min(100vw,380px)",trigger:"click"},{default:t(()=>[l(gl,{modelValue:e(g).three_view_model_id,"onUpdate:modelValue":n[14]||(n[14]=d=>e(g).three_view_model_id=d),onSelect:ue,"no-init":"",scene:"actor_three_view_image"},null,8,["modelValue"])]),_:1},8,["virtual-ref"]),n[27]||(n[27]=o("div",{class:"flex flex-column grid-gap-2 px-4 pt-4"},[o("span",null,"角色原始形象记录")],-1)),l(be,{class:"flex-1"},{default:t(()=>[e(ee).length>0?(s(),m("div",At,[(s(!0),m(z,null,de(e(ee),d=>(s(),m("div",{class:"grid-column-1 task-item",key:d.id},[l(xe,{src:d.result.image_path,fit:"contain",shape:"square",size:206},null,8,["src"]),d.status==="success"&&d.result.image_path!==e(E).headimg&&d.result.image_path!==e(E).origin_headimg?(s(),m("div",{key:0,class:"flex flex-center grid-gap-2 task-item-replace pointer",onClick:Me=>Ce(d)},[l(M,null,{default:t(()=>[e(se)?(s(),w(e(ze),{key:0,class:"circular"})):(s(),w(Ql,{key:1}))]),_:1}),n[26]||(n[26]=o("span",{class:"h10 text-nowrap"},"替换原始形象",-1))],8,Ft)):X("",!0)]))),128))])):(s(),w(vl,{key:1,description:"暂无原始形象记录"}))]),_:1})],64)):(s(),w(vl,{key:1,description:"点击角色名称选择角色"}))])]),e(oe)?(s(),w($l,{key:0,"url-list":e(fe),onClose:n[15]||(n[15]=d=>oe.value=!1)},null,8,["url-list"])):X("",!0),l(Ul,{ref_key:"actorCreateRef",ref:O,onSuccess:R},null,512),l(El,{ref_key:"voiceDialogRef",ref:Se,onSuccess:Qe},null,512),l(Rl,{ref_key:"characterLookRef",ref:V,onSelect:r,query:{drama_id:e(G),episode_id:e(v)}},null,8,["query"])])}}}),Bt=qe(Dt,[["__scopeId","data-v-169cfec1"]]),Mt={class:"flex flex-column draw-module"},Tt={class:"flex-1 flex grid-gap-10 overflow-hidden"},Gt={class:"flex-1 flex flex-column grid-gap-4 overflow-hidden"},qt={class:"grid-columns-xxl-7 grid-columns-xl-6 grid-columns-lg-5 grid-columns-md-4 grid-columns-sm-3 grid-columns-xs-2 grid-columns-p-1 grid-gap-4"},Nt={class:"flex grid-gap-2 prop-status"},jt=["onClick"],Ot={class:"flex flex-column flex-y-flex-end grid-gap-2"},Wt={class:"prop-tag p-2 prop-delete pointer"},Ht={class:"flex flex-column grid-gap-2 prop-info"},Jt=["onClick"],Zt={class:"prop-form-wrapper bg-overlay border rounded-4 prop-form flex flex-column grid-gap-4"},Kt={class:"border-bottom flex flex-center"},Xt={class:"flex flex-column grid-gap-2 px-4"},Yt={class:"bg rounded-4 p-4 border"},ea={class:"flex flex-y-center grid-gap-2"},la={class:"h10 text-ellipsis-1",style:{"max-width":"60px"}},oa={class:"h10 text-ellipsis-1",style:{"max-width":"60px"}},ta={class:"bg-overlay rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover"},aa={class:"flex flex-center grid-gap-2"},sa={class:"h10"},na={key:0,class:"grid-columns-2 grid-gap-4 p-4"},ia=["onClick"],ra={class:"flex grid-gap-10"},da={class:"flex flex-center grid-gap-2"},ua={class:"h10"},pa=Te({__name:"props",setup(he){const re=kl(),H=tl(),{USERINFO:Q}=dl(H),U=c(re.params.drama_id),b=we({type:"drama",name:"",prop_id:"",drama_id:U.value}),k=c([]),G=c(!1),v=c(null),I=c(),f=c({prop_id:"",drama_id:U.value,name:"",description:"",image_model_id:null,three_view_model_id:null,image_state:!1,three_view_image_state:!1,image_reference_state:!1,reference_image:"",image:"",three_view_image:""});Je(k,()=>{try{const p=k.value.find(r=>r.id===I.value?.id);p?(I.value=void 0,fe(p)):(I.value=void 0,f.value={id:"",drama_id:U.value,name:"",description:"",image_model_id:null,three_view_model_id:null,image_state:!1,three_view_image_state:!1,image_reference_state:!1,reference_image:"",image:"",three_view_image:""})}catch(p){console.error("watch propList error",p)}});const N=()=>{G.value=!0,L.get("/app/shortplay/api/Prop/index",{params:b}).then(p=>{p.code===D.SUCCESS&&(k.value=p.data)}).catch(p=>{console.error("getPropList error",p)}).finally(()=>{G.value=!1})},C=c(!1),B=c([]),A=p=>{!p.image&&!p.three_view_image||(B.value=[p.image,p.three_view_image],bl(()=>{C.value=!0}))},O=c([]),E=c(!1),g=we({alias_id:"",scene:"prop_image",page:1,page_size:100});let R=null;const oe=()=>{R&&R.abort(),R=new AbortController,E.value=!0,O.value=[],L.get("/app/model/api/Task/index",{params:g,signal:R?.signal}).then(p=>{p.code===D.SUCCESS&&(O.value=p.data.data)}).finally(()=>{E.value=!1})},fe=p=>{p.id!==I.value?.id&&(I.value=p,f.value.id=p.id,f.value.name=p.name,f.value.description=p.description,f.value.image=p.image,f.value.three_view_image=p.three_view_image,f.value.image_reference_state=!1,f.value.reference_image="",g.alias_id=p.id,oe())},ee=c(null),u=c(null),_=c({}),Z=p=>{p?(_.value=p,f.value.image_state=!0):(_.value={},f.value.image_model_id=null,f.value.image_state=!1),ee.value?.hide()},le=c(null),ie=c(null),q=c({}),ce=p=>{p?(q.value=p,f.value.three_view_image_state=!0):(q.value={},f.value.three_view_model_id=null,f.value.three_view_image_state=!1),le.value?.hide()},h=ul([_,q]),a=c(!1),_e=()=>{a.value||I.value.status_enum.value==="pending"||(a.value=!0,L.post("/app/shortplay/api/Prop/initializing",{...f.value,image:"",three_view_image:""}).then(p=>{p.code===D.SUCCESS?(I.value.status=p.data.status,I.value.status_enum=p.data.status_enum):S.error(p.msg)}).catch(()=>{S.error("生成图片失败")}).finally(()=>{a.value=!1}))},te=c(null),W=c(!1),ue=p=>{W.value=!1,p.code===D.SUCCESS?(f.value.image_reference_state=!0,f.value.reference_image=p.data.url):S.error(p.msg),te.value?.clearFiles()},ye=()=>{W.value=!1,te.value?.clearFiles()},J=c(!1),ae=p=>{J.value||(J.value=!0,L.post("/app/shortplay/api/Prop/ReplaceProp",{id:I.value.id,task_id:p.id}).then(r=>{r.code===D.SUCCESS?(I.value.image=p.result.image_path,I.value.status=r.data.status,I.value.status_enum=r.data.status_enum,f.value.image=p.result.image_path):S.error(r.msg)}).catch(()=>{S.error("替换物品失败")}).finally(()=>{J.value=!1}))},F=c(!1),K=c(!1),$=c(0),me=c([]),se=()=>{F.value=!0,me.value=k.value.filter(p=>p.status==="initializing"),$.value=me.value.length},Ce=ul([_,q],$),Le=()=>{K.value=!0,Promise.all(me.value.map(p=>L.post("/app/shortplay/api/Prop/initializing",{id:p.id,image_reference_state:!!p.image,reference_image:p.image?p.image:"",image_state:!0,three_view_image_state:!0,image_model_id:_.value.id,three_view_model_id:q.value.id}))).then(()=>{N()}).catch(p=>{console.error("submitBatchGenerate error",p)}).finally(()=>{K.value=!1,F.value=!1})},Se=p=>{L.post("/app/shortplay/api/Prop/delete",{id:p.id,drama_id:U.value}).then(r=>{r.code===D.SUCCESS?(S.success(r.msg),N()):S.error(r.msg)})},{subscribe:Ve,unsubscribeAll:Qe}=fl(),V=()=>{Ve("private-generatepropimage-"+Q.value?.user,p=>{console.log("channels complete info message",p);const r=k.value.find(P=>P.id===p.id);r&&(r.status_enum=p.status,p.image&&(r.image=p.image)),v.value?.subscribe?.("generatepropimage",p)}),Ve("private-generatepropthreeviewimage-"+Q.value?.user,p=>{console.log("channels complete info message",p);const r=k.value.find(P=>P.id===p.id);r&&(r.status_enum=p.status,p.image&&(r.three_view_image=p.image)),v.value?.subscribe?.("generatepropthreeviewimage",p)})};return ol(()=>{N(),V()}),ml(()=>{console.log("props unmounted"),Qe()}),(p,r)=>{const P=Ge,$e=Ye,Pe=Ke,i=T("Search"),n=Xe,ne=Ze,M=T("Plus"),pe=el,Ue=T("Delete"),ge=wl,ve=T("UserFilled"),Ne=Cl,Ae=T("Close"),xe=T("ArrowDown"),sl=T("PictureRounded"),Fe=ll,nl=_l,je=T("Top"),be=al,De=Sl,Oe=Vl,il=Yl,Be=cl;return s(),m("div",Mt,[o("div",Tt,[o("div",Gt,[l(ne,{class:"flex flex-center grid-gap-4",onSubmit:j(N,["prevent"])},{default:t(()=>[l(Pe,{class:"mb-0"},{default:t(()=>[l($e,{type:"success",disabled:e(k).filter(x=>x.status==="initializing").length<=0,onClick:se},{default:t(()=>[l(P,{size:"16"},{default:t(()=>[l(eo)]),_:1}),r[15]||(r[15]=o("span",null,"批量生成",-1))]),_:1},8,["disabled"])]),_:1}),l(Pe,{class:"mb-0"},{default:t(()=>[l(n,{modelValue:e(b).name,"onUpdate:modelValue":r[0]||(r[0]=x=>e(b).name=x),placeholder:"搜索物品",clearable:"",onChange:N},{suffix:t(()=>[l(P,null,{default:t(()=>[l(i)]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(Pe,{class:"mb-0"},{default:t(()=>[l(n,{modelValue:e(b).prop_id,"onUpdate:modelValue":r[1]||(r[1]=x=>e(b).prop_id=x),placeholder:"物品ID",clearable:"",onChange:N},{suffix:t(()=>[l(P,null,{default:t(()=>[l(i)]),_:1})]),_:1},8,["modelValue"])]),_:1}),r[16]||(r[16]=o("div",{class:"flex-1"},null,-1))]),_:1}),l(Ne,{class:"flex-1"},{default:t(()=>[o("div",qt,[o("div",{class:"grid-column-1 rounded-4 p-4 prop-item flex flex-column flex-center grid-gap-4 pointer bg-overlay",onClick:r[2]||(r[2]=x=>e(v)?.open?.(null,e(b).drama_id))},[l(P,{class:"rounded-4",size:"20",style:{height:"40px",width:"40px","background-color":"var(--el-fill-color-dark)"}},{default:t(()=>[l(M)]),_:1}),r[17]||(r[17]=o("span",null,"添加物品",-1))]),(s(!0),m(z,null,de(e(k),x=>(s(),m("div",{class:"grid-column-1 input-button rounded-4 flex flex-column flex-center grid-gap-2 prop-item bg-overlay",key:x.id},[l(pe,{src:x.image,class:Re(["prop-avatar bg-mosaic",{pointer:x.image}]),onClick:Ee=>A(x),fit:"contain"},{default:t(()=>[Y(y(x.name),1)]),_:2},1032,["src","class","onClick"]),o("div",Nt,[o("span",{class:"prop-tag pointer",title:"复制物品",onClick:j(Ee=>e(jl)(`@${x.name}(${x.prop_id}) `),["stop"])},y(x.prop_id),9,jt),r[18]||(r[18]=o("div",{class:"flex-1"},null,-1)),o("div",Ot,[o("span",{class:Re(["prop-tag",["prop-tag--"+x.status_enum.props.type]])},y(x.status_enum.label),3),l(ge,{title:"确定删除该物品吗？",width:"fit-content",onConfirm:Ee=>Se(x),placement:"bottom-end"},{reference:t(()=>[o("div",Wt,[l(P,{size:"16"},{default:t(()=>[l(Ue)]),_:1})])]),_:1},8,["onConfirm"])])]),o("div",Ht,[o("div",{class:Re(["prop-name flex flex-center grid-gap-1 pointer",{"prop-name--success":x.id===e(f).id}]),onClick:j(Ee=>fe(x),["stop"])},[l(P,null,{default:t(()=>[l(ve)]),_:1}),o("span",null,y(x.name),1)],10,Jt)])]))),128))])]),_:1})]),o("div",Zt,[e(f).id?(s(),m(z,{key:0},[o("div",Kt,[l(n,{modelValue:e(f).name,"onUpdate:modelValue":r[4]||(r[4]=x=>e(f).name=x),placeholder:"物品物品",size:"large",class:"prop-form-input flex-1"},{suffix:t(()=>[l($e,{type:"primary",bg:"",text:"",size:"small",onClick:r[3]||(r[3]=x=>e(v)?.open?.(e(I),e(b).drama_id))},{default:t(()=>[...r[19]||(r[19]=[Y("编辑",-1)])]),_:1})]),_:1},8,["modelValue"])]),o("div",Xt,[r[23]||(r[23]=o("span",null,"物品描述",-1)),o("div",Yt,[l(n,{modelValue:e(f).description,"onUpdate:modelValue":r[5]||(r[5]=x=>e(f).description=x),placeholder:"请输入物品描述",size:"small",class:"prop-form-textarea",type:"textarea",autosize:{minRows:6,maxRows:20}},null,8,["modelValue"]),o("div",ea,[o("div",{class:"bg-overlay rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover",ref_key:"modelButtonRef",ref:u,title:"选择使用AI生成图"},[e(_).id?(s(),m(z,{key:0},[l(pe,{src:e(_).icon,alt:e(_).name,shape:"square",size:16},null,8,["src","alt"]),o("span",la,y(e(_).name),1),l(P,{size:"16",class:"pointer",onClick:r[6]||(r[6]=j(x=>Z(),["stop"]))},{default:t(()=>[l(Ae)]),_:1})],64)):(s(),m(z,{key:1},[l(P,{size:"16"},{default:t(()=>[l(He)]),_:1}),r[20]||(r[20]=o("span",{class:"h10"},"物品图",-1)),l(P,{size:"16"},{default:t(()=>[l(xe)]),_:1})],64))],512),o("div",{class:"bg-overlay rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover",ref_key:"threeViewModelButtonRef",ref:ie,title:"选择使用AI生成三视图"},[e(q).id?(s(),m(z,{key:0},[l(pe,{src:e(q).icon,alt:e(q).name,shape:"square",size:16},null,8,["src","alt"]),o("span",oa,y(e(q).name),1),l(P,{size:"16",class:"pointer",onClick:r[7]||(r[7]=j(x=>ce(),["stop"]))},{default:t(()=>[l(Ae)]),_:1})],64)):(s(),m(z,{key:1},[l(P,{size:"16"},{default:t(()=>[l(He)]),_:1}),r[21]||(r[21]=o("span",{class:"h10"},"三视图",-1)),l(P,{size:"16"},{default:t(()=>[l(xe)]),_:1})],64))],512),l(nl,{ref_key:"uploadImageRef",ref:te,title:"添加参考图",data:{dir_name:"prop/reference",dir_title:"物品参考照片"},action:e(L).getCompleteUrl("app/shortplay/api/Uploads/upload"),headers:e(L).getHeaders(),accept:"image/jpeg,image/png",limit:1,type:"cover",disabled:e(W),"before-upload":()=>(W.value=!0,!0),"on-success":ue,"show-file-list":!1,"on-error":ye},{default:t(()=>[o("div",ta,[l(Fe,{placement:"top",disabled:!e(f).reference_image,width:"fit-content"},{reference:t(()=>[!e(f).reference_image||e(W)?(s(),w(P,{key:0,size:"16"},{default:t(()=>[e(W)?(s(),w(e(ze),{key:0,class:"circular"})):(s(),w(M,{key:1}))]),_:1})):(s(),w(P,{key:1,size:"16",color:"var(--el-color-success)"},{default:t(()=>[l(sl)]),_:1}))]),default:t(()=>[l(pe,{src:e(f).reference_image,fit:"contain",size:130,shape:"square"},null,8,["src"])]),_:1},8,["disabled"])])]),_:1},8,["action","headers","disabled","before-upload"]),r[22]||(r[22]=o("div",{class:"flex-1"},null,-1)),o("div",aa,[l(P,{size:"16"},{default:t(()=>[l(pl)]),_:1}),o("span",sa,y(e(h)),1)]),o("div",{class:"rounded-round p-3 flex flex-center grid-gap-2 pointer",style:{"background-color":"#FFFFFF",color:"#141414"},onClick:_e},[l(P,{size:"20"},{default:t(()=>[e(a)||e(I).status_enum.value==="pending"?(s(),w(e(ze),{key:0,class:"circular"})):(s(),w(je,{key:1}))]),_:1})])])])]),l(Fe,{ref_key:"modelPopoverRef",ref:ee,"popper-class":"model-popover","virtual-ref":e(u),"virtual-triggering":"",placement:"bottom",width:"min(100vw,380px)",trigger:"click"},{default:t(()=>[l(be,{modelValue:e(f).image_model_id,"onUpdate:modelValue":r[8]||(r[8]=x=>e(f).image_model_id=x),onSelect:Z,"no-init":"",scene:"prop_image"},null,8,["modelValue"])]),_:1},8,["virtual-ref"]),l(Fe,{ref_key:"threeViewModelPopoverRef",ref:le,"popper-class":"model-popover","virtual-ref":e(ie),"virtual-triggering":"",placement:"bottom",width:"min(100vw,380px)",trigger:"click"},{default:t(()=>[l(be,{modelValue:e(f).three_view_model_id,"onUpdate:modelValue":r[9]||(r[9]=x=>e(f).three_view_model_id=x),onSelect:ce,"no-init":"",scene:"prop_three_view_image"},null,8,["modelValue"])]),_:1},8,["virtual-ref"]),r[25]||(r[25]=o("div",{class:"flex flex-column grid-gap-2 px-4 pt-4"},[o("span",null,"物品原始记录")],-1)),l(Ne,{class:"flex-1"},{default:t(()=>[e(O).length>0?(s(),m("div",na,[(s(!0),m(z,null,de(e(O),x=>(s(),m("div",{class:"grid-column-1 task-item",key:x.id},[l(pe,{src:x.result.image_path,fit:"contain",shape:"square",size:206},null,8,["src"]),x.status==="success"&&x.result.image_path!==e(f).image?(s(),m("div",{key:0,class:"flex flex-center grid-gap-2 task-item-replace pointer",onClick:Ee=>ae(x)},[l(P,null,{default:t(()=>[e(J)?(s(),w(e(ze),{key:0,class:"circular"})):(s(),w(Ql,{key:1}))]),_:1}),r[24]||(r[24]=o("span",{class:"h10 text-nowrap"},"替换原始",-1))],8,ia)):X("",!0)]))),128))])):(s(),w(De,{key:1,description:"暂无原始记录"}))]),_:1})],64)):(s(),w(De,{key:1,description:"点击物品名称选择物品"}))])]),e(C)?(s(),w(Oe,{key:0,"url-list":e(B),onClose:r[10]||(r[10]=x=>C.value=!1)},null,8,["url-list"])):X("",!0),l(il,{ref_key:"propCreateRef",ref:v,onSuccess:N},null,512),l(Be,{modelValue:e(F),"onUpdate:modelValue":r[14]||(r[14]=x=>Ie(F)?F.value=x:null),class:"generate-storyboard-dialog",draggable:"",width:"800px"},{header:t(()=>[...r[26]||(r[26]=[o("span",{class:"font-weight-600"},"批量生成物品",-1)])]),footer:t(()=>[l($e,{type:"info",onClick:r[13]||(r[13]=x=>F.value=!1),disabled:e(K)},{default:t(()=>[...r[27]||(r[27]=[Y("取消",-1)])]),_:1},8,["disabled"]),r[29]||(r[29]=o("div",{class:"flex-1"},null,-1)),o("div",da,[l(P,{size:"16"},{default:t(()=>[l(pl)]),_:1}),o("span",ua,y(e(Ce)),1)]),l($e,{type:"success",icon:"Check",onClick:Le,disabled:!e(f).image_model_id||!e(f).three_view_model_id,loading:e(K)},{default:t(()=>[...r[28]||(r[28]=[Y("生成",-1)])]),_:1},8,["disabled","loading"])]),default:t(()=>[o("div",ra,[l(be,{title:"模型",modelValue:e(f).image_model_id,"onUpdate:modelValue":r[11]||(r[11]=x=>e(f).image_model_id=x),onSelect:Z,"no-init":"",class:"flex-1 bg-overlay rounded-4 p-4",scene:"prop_image"},null,8,["modelValue"]),l(be,{title:"三视图模型",modelValue:e(f).three_view_model_id,"onUpdate:modelValue":r[12]||(r[12]=x=>e(f).three_view_model_id=x),onSelect:ce,class:"flex-1 bg-overlay rounded-4 p-4","no-init":"",scene:"prop_three_view_image"},null,8,["modelValue"])])]),_:1},8,["modelValue"])])}}}),ca=qe(pa,[["__scopeId","data-v-548b11b3"]]),_a={class:"flex flex-column grid-gap-10 p-10"},ma={class:"flex"},fa={class:"flex-1 flex flex-center"},ga={class:"grid-gap-4 grid-columns-xxl-8 grid-columns-xl-7 grid-columns-lg-6 grid-columns-md-5 grid-columns-sm-4 grid-columns-xs-3 grid-columns-p-2 grid-columns-p-1"},va={class:"flex flex-y-center flex-x-space-between grid-gap-4 p-10"},xa={class:"flex-1 flex flex-flex-start"},ha={class:"h8 font-weight-600"},za=Te({__name:"drama",setup(he){const re=tl(),H=we({...ke.currentRoute.value.query,id:ke.currentRoute.value.params.drama_id}),Q=c({}),U=c(!0);let b;const{subscribe:k,unsubscribeAll:G}=fl(),v=()=>{Q.value.id&&(k("private-continueepisode-"+Q.value.id,C=>{console.log("channels complete info message",C),I()}),k("private-generatedramacover-"+Q.value.id,C=>{console.log("channels complete info message",C),I()}))},I=()=>{re.hasLogin()&&(Q.value.id?U.value=!0:b=Gl.service({lock:!0,text:"加载中..."}),L.get("/app/shortplay/api/Works/details",{params:H}).then(C=>{C.code===D.SUCCESS?(Q.value=C.data,v()):(b?.close(),rl.confirm(C.msg,"提示",{confirmButtonText:"重新加载",cancelButtonText:"返回",type:"warning"}).then(()=>{I()}).catch(()=>{ke.push("/user")}))}).catch(()=>{b?.close(),rl.confirm("加载失败，请重新加载","提示",{confirmButtonText:"重新加载",cancelButtonText:"返回",type:"warning"}).then(()=>{I()}).catch(()=>{ke.push("/user")})}).finally(()=>{U.value=!1,b?.close()}))},f=c("episodes"),N=Bl(()=>({episodes:xl,actors:Bt,props:ca,details:rt})[f.value]);return ol(()=>{I()}),ml(()=>{G()}),(C,B)=>{const A=Tl,O=T("ArrowLeft"),E=Ge,g=yl,R=ql;return s(),w(R,{loading:e(U),animated:""},{template:t(()=>[o("div",_a,[o("div",ma,[l(A,{variant:"text",style:{height:"45px",width:"100px"}}),o("div",fa,[l(A,{variant:"text",style:{height:"45px",width:"520px"}})])]),o("div",ga,[(s(),m(z,null,de(20,oe=>l(A,{variant:"text",style:{height:"240px"},class:"grid-column-1 flex flex-column",key:oe})),64))])])]),default:t(()=>[o("div",va,[o("div",xa,[o("div",{class:"flex grid-gap-4 flex-y-center pointer",onClick:B[0]||(B[0]=oe=>e(ke).push("/user"))},[l(E,null,{default:t(()=>[l(O)]),_:1}),o("span",ha,y(e(Q).title),1)])]),l(g,{modelValue:e(f),"onUpdate:modelValue":B[1]||(B[1]=oe=>Ie(f)?f.value=oe:null),disabled:e(U),options:[{label:"分集",value:"episodes",component:xl},{label:"角色库",value:"actors",component:"Actors"},{label:"物品库",value:"props",component:"Props"},{label:"详情",value:"details",component:"Details"}],class:"tabs-segmented border"},null,8,["modelValue","disabled","options"]),B[2]||(B[2]=o("div",{class:"flex-1"},null,-1))]),(s(),w(Ml(e(N)),{find:e(Q),onUpdate:I},null,40,["find"]))]),_:1},8,["loading"])}}});export{za as default};
