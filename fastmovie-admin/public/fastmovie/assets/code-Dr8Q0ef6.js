import{d as M,aw as P,r as u,H as R,o as L,O as f,a as V,k as d,l as c,m as $,I as N,M as F,s as Z,x as j,C as x,p as z,P as H,f as O,R as q,t as G,h as v,E as m}from"./vendor-C6C8mA7k.js";import{$ as b,R as E,c as W,_ as J}from"./index-BY2sLTz-.js";const Q={class:"container"},X=["onClick"],Y=["onUpdate:modelValue","onInput","onKeydown","onFocus"],ee={class:"code-char"},te={key:0,class:"cursor"},se=M({__name:"code",setup(ae){const U=P(),g=u(null),h=u(null),y=u([]),o=u(["","","","","",""]),p=u(0),_=u(!1),i=u(!1),S=R(()=>o.value.every(t=>t.trim()!=="")),w=(t,e,s)=>Array.from({length:t},()=>`${Math.random()*e}px ${Math.random()*s}px white`).join(","),D=()=>{const t=window.innerWidth,e=window.innerHeight;g.value&&(g.value.style.boxShadow=w(50,t,e)),h.value&&(h.value.style.boxShadow=w(100,t,e))},l=t=>{p.value=t,f(()=>{const e=y.value[t];e&&e.focus()})},I=t=>{const e=t.target;if(e.classList.contains("code-input"))return;const s=e.closest(".item");if(s){const a=Array.from(s.parentElement?.children||[]).indexOf(s);a!==-1&&l(a)}},A=(t,e)=>{if(i.value)return;const s=e.target;let a=s.value.toUpperCase().replace(/[^A-Z0-9]/g,"");a.length>1&&(a=a.slice(0,1)),o.value[t]=a,s.value=a,a&&t<5&&f(()=>{l(t+1)})},T=(t,e)=>{const s=e.key;if(!((e.ctrlKey||e.metaKey)&&s==="v")){if(s==="Backspace")o.value[t]?o.value[t]="":t>0&&(l(t-1),o.value[t-1]=""),e.preventDefault();else if(s==="ArrowLeft"&&t>0)l(t-1),e.preventDefault();else if(s==="ArrowRight"&&t<5)l(t+1),e.preventDefault();else if(s==="Delete")o.value[t]="",e.preventDefault();else if(s.length===1&&/[A-Z0-9]/i.test(s)&&!e.ctrlKey&&!e.metaKey){const a=s.toUpperCase();o.value[t]=a,t<5&&f(()=>{l(t+1)}),e.preventDefault()}}},C=t=>{t.preventDefault(),t.stopPropagation(),i.value=!0;const e=t.clipboardData?.getData("text")||"";if(!e){i.value=!1;return}const s=e.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,6);if(!s){i.value=!1;return}o.value=["","","","","",""];for(let a=0;a<s.length&&a<6;a++)o.value[a]=s[a];f(()=>{y.value.forEach((n,r)=>{n&&(n.value=o.value[r]||"")});const a=Math.min(s.length,5);l(a),setTimeout(()=>{i.value=!1},200)})},B=()=>{setTimeout(()=>{const t=document.activeElement;!t||t.classList.contains("code-input")},100)},K=async()=>{if(!S.value){m.warning("请输入完整的邀请码");return}const t=o.value.join("");_.value=!0;try{const e=await b.post("/app/user/api/User/bindInvitationCode",{code:t});e.code===E.SUCCESS?(m.success(e.msg||"邀请码使用成功"),b.get("/app/user/api/User/info").then(s=>{s.code===E.SUCCESS&&W().setUserInfo(s.data)}),setTimeout(()=>{U.replace("/")},500)):m.error(e.msg||"邀请码使用失败")}catch(e){m.error(e?.msg||"邀请码使用失败，请稍后重试")}finally{_.value=!1}},k=t=>{const e=document.activeElement,s=t.target,a=document.querySelector(".content");a&&(e&&a.contains(e)||s&&a.contains(s)||!e&&!s)&&C(t)};return L(()=>{D(),f(()=>{l(0)}),document.addEventListener("paste",k)}),V(()=>{document.removeEventListener("paste",k)}),(t,e)=>{const s=x;return v(),d("div",Q,[c("div",{class:"stars small",ref_key:"smallStars",ref:h},null,512),c("div",{class:"stars big",ref_key:"bigStars",ref:g},null,512),e[1]||(e[1]=c("div",{class:"h1 font-weight-bold"},"填写邀请码",-1)),e[2]||(e[2]=c("div",{class:"mt-7"},[c("span",null,"请输入邀请码")],-1)),c("div",{class:"grid-columns-6 grid-gap-6 mt-10 content",onClick:I,onPaste:C},[(v(!0),d(N,null,F(o.value,(a,n)=>(v(),d("div",{key:n,class:z(["flex flex-center flex-column item",{active:p.value===n}]),onClick:r=>l(n)},[H(c("input",{ref_for:!0,ref_key:"inputRefs",ref:y,"onUpdate:modelValue":r=>o.value[n]=r,type:"text",maxlength:"1",class:"code-input",onInput:r=>A(n,r),onKeydown:r=>T(n,r),onPaste:C,onFocus:r=>p.value=n,onBlur:B},null,40,Y),[[q,o.value[n]]]),c("span",ee,G(a||""),1),p.value===n&&!a?(v(),d("span",te)):O("",!0)],10,X))),128))],32),$(s,{class:"btn",round:"",color:"var(--el-color-success)",size:"large",loading:_.value,disabled:!S.value,onClick:K},{default:Z(()=>[...e[0]||(e[0]=[j(" 确定 ",-1)])]),_:1},8,["loading","disabled"])])}}}),le=J(se,[["__scopeId","data-v-f730acb4"]]);export{le as default};
