import{d as R,Y as P,r as h,w as j,o as A,j as F,k as d,l as t,f as w,u as e,m as p,s as m,q as Y,h as i,I as L,M as G,p as z,t as u,a5 as H,a8 as J,e as U,x as q,D as g,E as x,C as K}from"./vendor-CvgTi-PR.js";import{c as O,r as _,$ as v,R as k,_ as Q}from"./index-BH15UgwX.js";import{I as W}from"./icon-like-DjpyqzWl.js";const X={class:"play-container flex grid-gap-10"},Z={class:"flex-1 flex grid-gap-4"},ee={class:"flex-1 h-100 flex flex-center"},se=["src"],ae={class:"flex flex-column grid-gap-10 flex-y-flex-end"},te={class:"flex flex-column grid-gap-4",style:{width:"100px"}},oe=["onClick"],ne={class:"font-weight-600"},ie={class:"drama-info bg-overlay rounded-4 flex flex-column grid-gap-4"},le={key:0,class:"flex grid-gap-2 flex-center mb-10"},re={class:"flex-1 flex flex-column grid-gap-2"},ce={class:"h10 text-info"},de={class:"h10"},pe={class:"font-weight-600"},ue={class:"flex flex-column grid-gap-2"},_e={class:"text-info"},fe=R({__name:"index",setup(he){const r=P(),n=h(r.params.drama_id),c=h(r.params.episode_id),y=h(r.query.view),B=O(),s=h({video_path:"",drama:{}});j(()=>r.path,()=>{n.value=r.params.drama_id,c.value=r.params.episode_id,y.value?l():E()});const l=()=>{B.hasLogin()&&v.get("/app/shortplay/api/DramaEpisode/details",{params:{drama_id:n.value,episode_id:c.value}}).then(a=>{a.code===k.SUCCESS?s.value=a.data:g.confirm(a.msg,"提示",{confirmButtonText:"重新加载",cancelButtonText:"返回",type:"warning"}).then(()=>{l()}).catch(()=>{_.push("/works/"+n.value)})}).catch(()=>{g.confirm("加载失败，请重新加载","提示",{confirmButtonText:"重新加载",cancelButtonText:"返回",type:"warning"}).then(()=>{l()}).catch(()=>{_.push("/works/"+n.value)})})},D=()=>{g.confirm("发布到广场后，其他用户可以查看并点赞，是否继续？","提示",{confirmButtonText:"继续发布",cancelButtonText:"取消",type:"warning",beforeClose:(a,o,S)=>{o.confirmButtonLoading!=!0&&(a==="confirm"?(o.confirmButtonLoading=!0,v.post("/app/shortplay/api/DramaEpisode/share",{drama_id:n.value,episode_id:c.value}).then(f=>{f.code===k.SUCCESS?(x.success("发布成功"),l(),S()):x.error(f.msg)}).catch(()=>{x.error("发布失败")}).finally(()=>{o.confirmButtonLoading=!1})):S())}}).then(()=>{console.log("handleShare")}).catch(()=>{console.log("handleShare")})},E=()=>{s.value.video_path="",v.get("/app/shortplay/api/Square/details",{params:{drama_id:n.value,episode_id:c.value}}).then(a=>{a.code===k.SUCCESS?s.value=a.data:g.confirm(a.msg,"提示",{confirmButtonText:"重新加载",cancelButtonText:"返回",type:"warning"}).then(()=>{l()}).catch(()=>{_.push("/works/"+n.value)})}).catch(()=>{g.confirm("加载失败，请重新加载","提示",{confirmButtonText:"重新加载",cancelButtonText:"返回",type:"warning"}).then(()=>{l()}).catch(()=>{_.push("/works/"+n.value)})})},T=h({}),I=()=>{v.get("/app/shortplay/api/Square/episodes",{params:{drama_id:n.value}}).then(a=>{a.code===k.SUCCESS&&(T.value=a.data)}).catch(()=>{})},V=()=>{B.hasLogin()&&v.post("/app/shortplay/api/Square/likes",{drama_id:n.value,episode_id:c.value}).then(a=>{a.code===k.SUCCESS?(s.value.share.is_likes=!s.value.share.is_likes,s.value.share.likes=a.data.likes):x.error(a.msg)}).catch(()=>{x.error("点赞失败")})};return A(()=>{y.value?l():(E(),I())}),(a,o)=>{const S=F("Close"),f=Y,M=H,N=J,b=K;return i(),d("div",X,[t("div",Z,[t("div",ee,[e(s).video_path?(i(),d("video",{key:0,src:e(s).video_path,controls:"",class:"play-video"},null,8,se)):w("",!0)]),t("div",ae,[p(f,{class:"pointer",onClick:o[0]||(o[0]=C=>e(_).back()),size:"30"},{default:m(()=>[p(S)]),_:1}),p(M,{class:"flex-1"},{default:m(()=>[t("div",te,[(i(!0),d(L,null,G(e(T),(C,$)=>(i(),d("div",{class:z(["p-4 rounded-4 flex flex-center pointer",[C.episode_id===e(c)?"bg-success text-white":"bg-overlay"]]),key:$,onClick:me=>e(_).replace("/play/"+e(n)+"/"+C.episode_id)},[t("span",ne,"第 "+u(C.episode_no)+" 集",1)],10,oe))),128))])]),_:1})])]),t("div",ie,[!e(y)&&e(s).user?(i(),d("div",le,[p(N,{src:e(s).user.headimg,size:40},null,8,["src"]),t("div",re,[t("span",null,u(e(s).user.nickname),1),t("span",ce,u(e(s).share.create_time),1)]),t("div",{class:z(["flex flex-center grid-gap-2 pointer",[e(s).is_likes?"text-danger":"text-info"]]),onClick:V},[p(f,{size:"16"},{default:m(()=>[p(W)]),_:1}),t("span",de,u(e(s).share.likes),1)],2)])):w("",!0),t("span",pe,u(e(s).drama.title),1),t("div",ue,[o[1]||(o[1]=t("span",null,"作品描述",-1)),t("span",_e,u(e(s).drama.description),1)]),o[4]||(o[4]=t("div",{class:"flex-1"},null,-1)),e(y)==="share"?(i(),d(L,{key:1},[e(s).is_share?(i(),U(b,{key:0,type:"success",icon:"Position",size:"large",disabled:""},{default:m(()=>[...o[2]||(o[2]=[q("已发布到广场",-1)])]),_:1})):(i(),U(b,{key:1,type:"success",icon:"Position",size:"large",onClick:D},{default:m(()=>[...o[3]||(o[3]=[q("发布到广场",-1)])]),_:1}))],64)):w("",!0)])])}}}),ke=Q(fe,[["__scopeId","data-v-5040e0ec"]]);export{ke as default};
