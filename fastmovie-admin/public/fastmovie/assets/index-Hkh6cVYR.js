import{X as ce,_ as re}from"./index-DZvSei_G.js";import{_ as de,a as _e,b as ue}from"./xl-actor-create-tsWtBn2j.js";import{d as j,z as X,r as p,o as ae,j as T,e as U,a5 as te,s as c,P as se,h as i,k as u,u as l,I as B,M as le,l as t,m as o,af as J,q as K,t as x,a8 as Q,f as I,a6 as pe,a7 as oe,D as me,E as M,H as ge,S as fe,J as ve,ai as he,g as xe,ak as ke,C as we,x as A,a as ye,p as Z,al as be,O as Ce,K as $e}from"./vendor-CvgTi-PR.js";import{D as Se}from"./drama-CnwIJyBq.js";import{c as Y,$ as V,R as F,r as Ve,_ as H,u as ne,s as Ie,t as Ee}from"./index-Bz1vQmFt.js";import{a as ee,_ as Ue}from"./usePoints-CvRKLytC.js";import{u as Re}from"./usePush-CQ3BxbHW.js";import"./icon-points-BeKO5xwu.js";import"./icon-image-CKbP4oOG.js";const Ae={class:"flex-1"},De={key:0,class:"flex flex-wrap grid-gap-6"},Pe=["onClick"],Le=["onClick"],Be={class:"box-drama-episode"},Fe={key:0,class:"flex flex-column grid-gap-1 flex-center"},Ne={class:"box-content"},ze={class:"box-content-icon"},Ge={class:"box-content-title"},Je={class:"h8 font-weight-500 text-ellipsis-1"},Me={class:"h9 text-secondary font-weight-500"},Te={key:1,class:"flex flex-center"},je=j({__name:"works",setup(O){const E=Y(),f=X({page:1,limit:20,title:"",script:"all"}),y=p(!1),m=p([]),e=p(0),d=()=>{E.hasLogin()&&(y.value=!0,V.get("/app/shortplay/api/Works/index",{params:f}).then(_=>{_.code===F.SUCCESS&&(m.value=[...m.value,..._.data.data],f.page=_.data.page,f.limit=_.data.limit,e.value=_.data.total)}).finally(()=>{y.value=!1}))},g=()=>{m.value.length>=e.value||(f.page++,d())},S=_=>{me.confirm("确定删除该作品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{V.post("/app/shortplay/api/Drama/delete",{id:_.id}).then(k=>{k.code===F.SUCCESS&&(M.success("删除作品成功"),m.value=[],f.page=1,d())})})},r=_=>{Ve.push("/works/"+_.id)};return ae(()=>{d()}),(_,k)=>{const C=T("Delete"),$=K,w=T("Loading"),v=Q,R=pe,D=te,s=oe;return i(),U(D,{height:"100%","wrap-class":"flex-1",onEndReached:g},{default:c(()=>[se((i(),u("div",Ae,[l(m).length>0?(i(),u("div",De,[(i(!0),u(B,null,le(l(m),a=>(i(),u("div",{class:"box flex-1",key:a.id,onClick:b=>r(a)},[t("div",{class:"box-delete",onClick:J(b=>S(a),["stop"])},[o($,null,{default:c(()=>[o(C)]),_:1})],8,Le),t("span",Be," 共"+x(a.episode_num)+"集 ",1),o(v,{src:a.cover,class:"box-image",shape:"square"},{default:c(()=>[a.cover_state?(i(),u("div",Fe,[o($,{size:"40"},{default:c(()=>[o(w,{class:"circular"})]),_:1}),k[0]||(k[0]=t("span",{class:"h10 font-weight-600 text-success"},"AI正在生成封面...",-1))])):I("",!0)]),_:2},1032,["src"]),t("div",Ne,[t("div",ze,[o($,{size:30},{default:c(()=>[o(Se)]),_:1})]),t("div",Ge,[t("span",Je,x(a.title),1),t("span",Me,x(a.create_time),1)])])],8,Pe))),128))])):(i(),u("div",Te,[o(R,{description:"暂无作品"})]))])),[[s,l(y)]])]),_:1})}}}),He=H(je,[["__scopeId","data-v-1b08acbc"]]),Oe={class:"flex flex-column grid-gap-4"},qe={class:"flex grid-gap-4"},We={class:"flex-1"},Xe={class:"flex grid-gap-2"},Ke={class:"flex grid-gap-4"},Qe={class:"flex-1"},Ye={class:"flex flex-center grid-gap-2 w-100"},Ze=j({__name:"xl-actor-init",emits:["success"],setup(O,{expose:E,emit:f}){const y=f,m=p(!1),e=X({id:"",image_model_id:"",three_view_model_id:"",image_state:!1,three_view_image_state:!1,headimg:"",reference_headimg:"",three_view_image:"",image_reference_state:!1}),d=p(),g=p(!1),S=s=>{s&&s.status_enum.value!=="initializing"||(s&&(d.value=s,e.id=s.id,e.headimg=s.headimg,e.three_view_image=s.three_view_image),m.value=!0)},r=()=>{m.value=!1,e.id="",e.headimg="",e.three_view_image="",e.image_model_id="",e.three_view_model_id="",e.image_state=!1,e.three_view_image_state=!1,e.image_reference_state=!1,e.reference_headimg="",d.value=void 0},_=s=>{s?(e.reference_headimg=d.value?.headimg,e.headimg=""):(e.headimg=d.value?.headimg,e.reference_headimg="")},k=s=>{s?e.headimg="":e.headimg=d.value?.headimg},C=s=>{s?e.three_view_image="":e.three_view_image=d.value?.three_view_image},$=()=>{g.value||(g.value=!0,V.post("/app/shortplay/api/Actor/initializing",e).then(s=>{s.code===F.SUCCESS?y("success",{id:e.id}):M.error(s.msg)}).catch(s=>{console.log(s),M.error("初始化失败")}).finally(()=>{g.value=!1}))},w=p(null),v=s=>{if(s.code===F.SUCCESS)switch(s.data.dir_name){case"actor/image":e.image_reference_state?e.reference_headimg=s.data.url:e.headimg=s.data.url,d.value.headimg=s.data.url,w.value?.clearFiles();break;case"actor/three_view":e.three_view_image=s.data.url,w.value?.clearFiles();break}else M.error(s.msg)},R=()=>{w.value?.clearFiles()},D=ge(()=>!e.headimg&&!e.image_model_id||!e.three_view_image&&!e.three_view_model_id);return E({open:S,close:r}),(s,a)=>{const b=K,P=xe,N=he,L=ke,z=Ue,G=we,q=fe;return i(),U(q,{modelValue:l(m),"onUpdate:modelValue":a[5]||(a[5]=h=>ve(m)?m.value=h:null),class:"generate-scene-dialog",draggable:"",width:"min(100%,800px)",onClose:r},{header:c(()=>[...a[6]||(a[6]=[t("span",{class:"font-weight-600"},"初始化演员",-1)])]),footer:c(()=>[t("div",Ye,[o(G,{type:"info",onClick:r,disabled:l(g)},{default:c(()=>[...a[15]||(a[15]=[A("取消",-1)])]),_:1},8,["disabled"]),a[17]||(a[17]=t("div",{class:"flex-1"},null,-1)),o(G,{type:"success",onClick:$,disabled:l(g)||l(D),loading:l(g)},{default:c(()=>[...a[16]||(a[16]=[A("提交",-1)])]),_:1},8,["disabled","loading"])])]),default:c(()=>[t("div",Oe,[t("div",qe,[o(N,{ref_key:"uploadImageRef",ref:w,class:"input-upload",drag:"",data:{dir_name:"actor/image",dir_title:"演员形象照片"},action:l(V).getCompleteUrl("app/shortplay/api/Uploads/upload"),headers:l(V).getHeaders(),accept:"image/jpeg,image/png",limit:1,type:"cover","on-success":v,"show-file-list":!1,"on-error":R},{default:c(()=>[!l(e).headimg&&!l(e).reference_headimg?(i(),u(B,{key:0},[o(b,{class:"el-icon--upload"},{default:c(()=>[o(ee)]),_:1}),a[7]||(a[7]=t("div",{class:"el-upload__text"},[t("span",{class:"h10 text-success"},"选择上传或使用AI生成")],-1)),a[8]||(a[8]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"拖拽演员形象照片到此处或"),t("span",{class:"h10"},"点击上传")],-1)),a[9]||(a[9]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"支持上传格式："),t("span",{class:"h10"},"PNG, JPG, JPEG")],-1)),a[10]||(a[10]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"形象照片建议比例："),t("span",{class:"h10"},"1:1")],-1))],64)):(i(),U(P,{key:1,src:l(e).image_reference_state?l(e).reference_headimg:l(e).headimg,class:"image-cover",fit:"fill"},null,8,["src"]))]),_:1},8,["action","headers"]),t("div",We,[t("div",Xe,[o(L,{modelValue:l(e).image_state,"onUpdate:modelValue":a[0]||(a[0]=h=>l(e).image_state=h),"inline-prompt":"",style:{"--el-switch-on-color":"#13ce66"},"active-text":"重置形象","inactive-text":"关闭",onChange:k},null,8,["modelValue"]),o(L,{modelValue:l(e).image_reference_state,"onUpdate:modelValue":a[1]||(a[1]=h=>l(e).image_reference_state=h),"inline-prompt":"",style:{"--el-switch-on-color":"#13ce66"},"active-text":"作为AI参考","inactive-text":"直接上传",onChange:_},null,8,["modelValue"])]),o(z,{modelValue:l(e).image_model_id,"onUpdate:modelValue":a[2]||(a[2]=h=>l(e).image_model_id=h),scene:"actor_image","no-init":"",scrollProps:{height:"320px"}},null,8,["modelValue"])])]),t("div",Ke,[o(N,{ref_key:"uploadImageRef",ref:w,class:"input-upload",drag:"",data:{dir_name:"actor/three_view",dir_title:"演员三视图"},action:l(V).getCompleteUrl("app/shortplay/api/Uploads/upload"),headers:l(V).getHeaders(),accept:"image/jpeg,image/png",limit:1,type:"cover","on-success":v,"show-file-list":!1,"on-error":R},{default:c(()=>[l(e).three_view_image?(i(),U(P,{key:1,src:l(e).three_view_image,class:"image-cover",fit:"contain"},null,8,["src"])):(i(),u(B,{key:0},[o(b,{class:"el-icon--upload"},{default:c(()=>[o(ee)]),_:1}),a[11]||(a[11]=t("div",{class:"el-upload__text"},[t("span",{class:"h10 text-success"},"选择上传或使用AI生成")],-1)),a[12]||(a[12]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"拖拽演员三视图到此处或"),t("span",{class:"h10"},"点击上传")],-1)),a[13]||(a[13]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"支持上传格式："),t("span",{class:"h10"},"PNG, JPG, JPEG")],-1)),a[14]||(a[14]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"形象照片建议比例："),t("span",{class:"h10"},"1:1")],-1))],64))]),_:1},8,["action","headers"]),t("div",Qe,[o(L,{modelValue:l(e).three_view_image_state,"onUpdate:modelValue":a[3]||(a[3]=h=>l(e).three_view_image_state=h),"inline-prompt":"",onChange:C,style:{"--el-switch-on-color":"#13ce66"},"active-text":"重置三视图","inactive-text":"关闭"},null,8,["modelValue"]),o(z,{modelValue:l(e).three_view_model_id,"onUpdate:modelValue":a[4]||(a[4]=h=>l(e).three_view_model_id=h),scene:"actor_three_view_image","no-init":"",scrollProps:{height:"320px"}},null,8,["modelValue"])])])])]),_:1},8,["modelValue"])}}}),ea=H(Ze,[["__scopeId","data-v-ff9bb966"]]),aa={class:"flex-1"},ta={class:"grid-columns-xxl-6 grid-columns-xl-5 grid-columns-lg-4 grid-columns-md-3 grid-columns-sm-3 grid-columns-xs-3 grid-columns-p-2 grid-columns-p-1 grid-gap-4"},sa={class:"flex-1 flex grid-gap-2 actor-status"},la=["onClick"],oa=["onClick"],na={class:"flex-1 flex flex-column grid-gap-2 actor-info"},ia={class:"actor-name flex flex-center grid-gap-1"},ca={class:"flex grid-gap-2"},ra={key:0,class:"actor-tag"},da={key:1,class:"actor-tag"},_a={key:2,class:"actor-tag"},ua=["onClick"],pa={key:4,class:"actor-tag actor-tag--info"},ma=j({__name:"actors",emits:["select"],setup(O,{emit:E}){const f=Y(),{USERINFO:y}=ne(f),m=X({type:"personal",page:1,limit:10}),e=p([]),d=p(!1),g=p(null),S=p(null),r=p(0),_=()=>{d.value=!0,g.value?.close?.(),S.value?.close?.(),V.get("/app/shortplay/api/Actor/index",{params:m}).then(s=>{s.code===F.SUCCESS&&(e.value=[...e.value,...s.data.data],r.value=s.data.total)}).finally(()=>{d.value=!1})},k=p(!1),C=p([]),$=s=>{!s.headimg&&!s.three_view_image||(C.value=[s.headimg,s.three_view_image],Ce(()=>{k.value=!0}))},{subscribe:w,unsubscribeAll:v}=Re(),R=()=>{w("private-generateactorimage-"+y.value?.user,s=>{console.log("channels complete info message",s);const a=e.value.find(b=>b.actor_id===s.id);a&&(a.status_enum=s.status,s.image&&(a.headimg=s.image))}),w("private-generateactorthreeviewimage-"+y.value?.user,s=>{console.log("channels complete info message",s);const a=e.value.find(b=>b.actor_id===s.id);a&&(a.status_enum=s.status,s.image&&(a.three_view_image=s.image))})},D=()=>{e.value.length>=r.value||(m.page++,_())};return ae(()=>{_(),R()}),ye(()=>{console.log("actors unmounted"),v()}),(s,a)=>{const b=T("Plus"),P=K,N=Q,L=T("UserFilled"),z=te,G=be,q=de,h=ea,ie=oe;return i(),u(B,null,[o(z,{height:"100%","wrap-class":"flex-1",onEndReached:D},{default:c(()=>[se((i(),u("div",aa,[t("div",ta,[t("div",{class:"grid-column-1 rounded-4 p-4 border-dashed actor-item flex flex-column flex-center grid-gap-4 actor-item pointer",onClick:a[0]||(a[0]=n=>l(g)?.open?.(null))},[o(P,{class:"rounded-4",size:"20",style:{height:"40px",width:"40px","background-color":"var(--el-fill-color-dark)"}},{default:c(()=>[o(b)]),_:1}),a[2]||(a[2]=t("span",null,"添加演员",-1))]),(i(!0),u(B,null,le(l(e),n=>(i(),u("div",{class:"grid-column-1 input-button rounded-4 border-solid flex flex-center grid-gap-2 actor-item",key:n.id},[o(N,{src:n.headimg,class:Z(["actor-avatar",{pointer:n.headimg}]),onClick:W=>$(n),fit:"cover"},{default:c(()=>[A(x(n.name),1)]),_:2},1032,["src","class","onClick"]),t("div",sa,[t("span",{class:"actor-tag pointer",title:"复制演员",onClick:J(W=>l(Ie)(`@${n.name}(${n.actor_id}) `),["stop"])},x(n.actor_id),9,la),a[3]||(a[3]=t("div",{class:"flex-1"},null,-1)),t("span",{class:Z(["actor-tag",["actor-tag--"+n.status_enum.props.type,n.status_enum.value==="initializing"&&n.is_edit?"pointer":""]]),onClick:J(W=>n.is_edit?l(S)?.open?.(n.actor):null,["stop"])},x(n.status_enum.label),11,oa)]),t("div",na,[t("div",ia,[o(P,null,{default:c(()=>[o(L)]),_:1}),t("span",null,x(n.name),1)]),t("div",ca,[n.species_type_enum?(i(),u("span",ra,x(n.species_type_enum?.label),1)):I("",!0),n.gender_enum?(i(),u("span",da,x(n.gender_enum?.label),1)):I("",!0),n.age_enum?(i(),u("span",_a,x(n.age_enum?.label),1)):I("",!0),n.is_edit?(i(),u("span",{key:3,class:"actor-tag actor-tag--primary pointer",onClick:J(W=>n.is_edit?l(g)?.open?.(n):null,["stop"])},"可编辑",8,ua)):(i(),u("span",pa,"公共角色"))])])]))),128))])])),[[ie,l(d)]])]),_:1}),l(k)?(i(),U(G,{key:0,"url-list":l(C),onClose:a[1]||(a[1]=n=>k.value=!1)},null,8,["url-list"])):I("",!0),o(q,{ref_key:"actorCreateRef",ref:g,onSuccess:_},null,512),o(h,{ref_key:"actorInitRef",ref:S,onSuccess:_},null,512)],64)}}}),ga=H(ma,[["__scopeId","data-v-0276dc24"]]),fa={class:"container"},va={class:"flex flex-y-center flex-x-space-between"},ha={class:"flex flex-y-center flex-x-center grid-gap-7"},xa={class:"flex flex-column flex-x-start grid-gap-3"},ka={class:"h3 font-weight-bold text-ellipsis-1"},wa={class:"flex flex-y-center grid-gap-10"},ya={class:"flex flex-x-center my-7"},ba={key:0,class:"py-10"},Ca=j({__name:"index",setup(O){const E=p("works"),f=p("works"),y=[{label:"我的作品",value:"works"},{label:"我的演员",value:"actor"},{label:"我的音色",value:"voice"}],m=Y(),{USERINFO:e}=ne(m),d=p(null),g=p(null);return(S,r)=>{const _=Q,k=$e,C=_e,$=ue,w=re;return i(),u("div",fa,[t("div",va,[t("div",ha,[o(_,{size:75,src:l(e)?.headimg},{default:c(()=>[A(x(l(Ee)(l(e)?.nickname,1)),1)]),_:1},8,["src"]),t("div",xa,[t("span",ka,x(l(e)?.nickname),1),t("div",null,"ID："+x(l(e)?.id),1)])]),t("div",wa,[t("div",{class:"btn flex-shrink-0",onClick:r[0]||(r[0]=(...v)=>g.value.open&&g.value.open(...v))},"编辑主页"),t("div",{class:"btn flex-shrink-0",onClick:r[1]||(r[1]=(...v)=>d.value.open&&d.value.open(...v))},"邀请好友 ")])]),t("div",ya,[o(k,{modelValue:f.value,"onUpdate:modelValue":r[2]||(r[2]=v=>f.value=v),options:y},null,8,["modelValue"])]),f.value==="works"?(i(),u("div",ba,[o($,{modelValue:E.value,"onUpdate:modelValue":r[3]||(r[3]=v=>E.value=v),class:"text-info",color:"var(--el-color-white)"},{default:c(()=>[o(C,{value:"works"},{default:c(()=>[...r[4]||(r[4]=[A("创作作品",-1)])]),_:1}),o(C,{value:"publish"},{default:c(()=>[...r[5]||(r[5]=[A("发布作品",-1)])]),_:1})]),_:1},8,["modelValue"])])):I("",!0),f.value==="works"?(i(),U(He,{key:1})):I("",!0),f.value==="actor"?(i(),U(ga,{key:2})):I("",!0),o(ce,{ref_key:"xlInvitationCodeRef",ref:d},null,512),o(w,{ref_key:"xlUserinfoRef",ref:g},null,512)])}}}),Pa=H(Ca,[["__scopeId","data-v-2b8e81c4"]]);export{Pa as default};
