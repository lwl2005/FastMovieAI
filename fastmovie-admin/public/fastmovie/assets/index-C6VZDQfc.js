import{d as ve,z as de,r as d,j as P,k as f,m as o,S as ke,u as e,J as ie,s as t,am as ye,l as s,an as Ce,B as xe,ai as Me,ac as be,a8 as he,e as E,h as i,q as Ve,C as Le,x as y,I as b,t as I,af as ce,E as q,a as De,P as ge,f as W,a5 as Te,M as Ne,p as Ae,a7 as je,a6 as Ge}from"./vendor-CvgTi-PR.js";import{u as Se,I as me,_ as we}from"./usePoints-CJVGfUhe.js";import{n as He,$ as M,R as T,_ as Ue,c as Je,u as Oe}from"./index-BH15UgwX.js";import{I as Re}from"./icon-points-D7DNlrKI.js";import{b as Ke,a as Qe}from"./xl-actor-create-SFkdUGJO.js";import{u as We}from"./usePush-CQ3BxbHW.js";const Xe={class:"grid-columns-2 grid-gap-x-10 grid-gap-y-4 character-look-form"},Ye={class:"grid-column-2 flex flex-column grid-gap-4"},Ze={class:"flex flex-column bg-overlay rounded-4 p-4"},eo={class:"bg rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover"},oo={class:"h10"},lo={class:"flex flex-center grid-gap-2"},to={class:"h10"},ao=ve({__name:"xl-character-look-create",props:{query:{default:()=>({})},types:{default:()=>[]}},emits:["success"],setup(X,{expose:Y,emit:Z}){const N=X,ee=Z,A=de({type:"all",description:"",...N.query}),j=d([]),m=d(!1),S=d(!1),w=()=>{S.value=!0,j.value=[],M.get("/app/shortplay/api/CharacterLook/index",{params:A}).then(p=>{p.code===T.SUCCESS&&(j.value=p.data)}).finally(()=>{S.value=!1})},n=de({...N.query,alias_id:He(),title:"",overall_style:"",makeup:"",hair_style:"",costume:"",costume_url:"",status_note:"",costume_reference_state:!1,model_id:""}),C=d(),h=d(null),U=d(!1),oe=p=>{if(U.value=!1,p.code===T.SUCCESS)switch(p.data.dir_name){case"actor/costume":n.costume_url=p.data.url,n.model_id&&(n.costume_reference_state=!0),h.value?.clearFiles();break}else q.error(p.msg)},F=()=>{U.value=!1,h.value?.clearFiles()},V=d(!1),G=()=>{V.value||(V.value=!0,M.post("/app/shortplay/api/CharacterLook/update",n).then(p=>{p.code===T.SUCCESS?(q.success(p.msg),C.value?.resetFields(),ee("success"),m.value=!1):q.error(p.msg)}).catch(()=>{q.error("创建失败")}).finally(()=>{V.value=!1}))},_=d(),H=d(),x=d({}),J=p=>{x.value=p,n.costume_url&&(n.costume_reference_state=!0),H.value?.hide()},k=Se([x]),le=()=>{w(),m.value=!0},te=p=>{V.value||p()};return Y({open:le}),(p,a)=>{const g=xe,v=Ce,L=he,ae=P("Loading"),se=P("Plus"),$=Ve,ne=P("PictureRounded"),O=be,D=Me,u=ye,l=Le,R=P("Close"),re=ke,K=we;return i(),f("div",null,[o(re,{modelValue:e(m),"onUpdate:modelValue":a[9]||(a[9]=c=>ie(m)?m.value=c:null),class:"generate-scene-dialog",draggable:"",width:"min(100%,800px)","close-on-press-escape":!1,"close-on-click-modal":!1,"before-close":te},{header:t(()=>[...a[11]||(a[11]=[s("span",{class:"font-weight-600"},"演员装扮",-1)])]),footer:t(()=>[o(l,{onClick:a[6]||(a[6]=c=>{m.value=!1}),bg:"",text:"",disabled:e(V)},{default:t(()=>[...a[13]||(a[13]=[y("取消",-1)])]),_:1},8,["disabled"]),a[16]||(a[16]=s("div",{class:"flex-1"},null,-1)),s("div",{class:"flex flex-center grid-gap-2 input-button rounded-4 py-2 px-6",ref_key:"actorCostumeButtonRef",ref:_},[e(x).id?(i(),f(b,{key:1},[o(L,{src:e(x).icon,alt:e(x).name,shape:"square",class:"icon-model"},null,8,["src","alt"]),s("span",oo,I(e(x).name),1),o($,{onClick:a[7]||(a[7]=ce(c=>{x.value={},e(n).model_id="",e(n).costume_reference_state=!1},["stop"]))},{default:t(()=>[o(R)]),_:1})],64)):(i(),f(b,{key:0},[o($,{alt:"角色装扮",class:"icon-model",color:"var(--el-color-success)"},{default:t(()=>[o(me)]),_:1}),a[14]||(a[14]=s("span",{class:"h10"},"选择装扮换装模型",-1))],64))],512),s("div",lo,[o($,{size:"16"},{default:t(()=>[o(Re)]),_:1}),s("span",to,I(e(k)),1)]),o(l,{type:"success",onClick:a[8]||(a[8]=c=>G()),loading:e(V)},{default:t(()=>[...a[15]||(a[15]=[y("创建",-1)])]),_:1},8,["loading"])]),default:t(()=>[o(u,{"label-position":"right","label-width":"80px",model:e(n),size:"large",ref_key:"characterLookFormRef",ref:C},{default:t(()=>[s("div",Xe,[o(v,{label:"装扮名称",prop:"title",class:"grid-column-2"},{default:t(()=>[o(g,{modelValue:e(n).title,"onUpdate:modelValue":a[0]||(a[0]=c=>e(n).title=c),placeholder:"请输入装扮名称",class:"form-input"},null,8,["modelValue"])]),_:1}),o(v,{label:"整体",prop:"overall_style",class:"grid-column-1"},{default:t(()=>[o(g,{modelValue:e(n).overall_style,"onUpdate:modelValue":a[1]||(a[1]=c=>e(n).overall_style=c),placeholder:"整体（如：日常、精致、狼狈、正式）",class:"form-input"},null,8,["modelValue"])]),_:1}),o(v,{label:"状态",prop:"status_note",class:"grid-column-1"},{default:t(()=>[o(g,{modelValue:e(n).status_note,"onUpdate:modelValue":a[2]||(a[2]=c=>e(n).status_note=c),placeholder:"状态（凌乱、破损）",class:"form-input"},null,8,["modelValue"])]),_:1}),o(v,{label:"妆容",prop:"makeup",class:"grid-column-1"},{default:t(()=>[o(g,{modelValue:e(n).makeup,"onUpdate:modelValue":a[3]||(a[3]=c=>e(n).makeup=c),placeholder:"妆容（淡妆/浓妆/素颜感等）",class:"form-input"},null,8,["modelValue"])]),_:1}),o(v,{label:"发型",prop:"hair_style",class:"grid-column-1"},{default:t(()=>[o(g,{modelValue:e(n).hair_style,"onUpdate:modelValue":a[4]||(a[4]=c=>e(n).hair_style=c),placeholder:"发型描述",class:"form-input"},null,8,["modelValue"])]),_:1}),s("div",Ye,[a[12]||(a[12]=s("span",null,"服饰描述",-1)),s("div",Ze,[o(g,{type:"textarea",modelValue:e(n).costume,"onUpdate:modelValue":a[5]||(a[5]=c=>e(n).costume=c),placeholder:"服饰描述（颜色+款式+搭配）",class:"form-textarea",autosize:{minRows:3,maxRows:6}},null,8,["modelValue"]),o(D,{ref_key:"uploadImageRef",ref:h,data:{dir_name:"actor/costume",dir_title:"服饰图片"},action:e(M).getCompleteUrl("app/shortplay/api/Uploads/upload"),headers:e(M).getHeaders(),accept:"image/jpeg,image/png",limit:1,type:"cover",disabled:e(U),"before-upload":()=>(U.value=!0,!0),"on-success":oe,"show-file-list":!1,"on-error":F},{default:t(()=>[s("div",eo,[o(O,{placement:"top",disabled:!e(n).costume_url,width:"fit-content"},{reference:t(()=>[!e(n).costume_url||e(U)?(i(),E($,{key:0,color:"#FFFFFF"},{default:t(()=>[e(U)?(i(),E(ae,{key:0,class:"circular"})):(i(),E(se,{key:1}))]),_:1})):(i(),E($,{key:1,color:"var(--el-color-success)"},{default:t(()=>[o(ne)]),_:1}))]),default:t(()=>[o(L,{src:e(n).costume_url,fit:"contain",size:130,shape:"square"},null,8,["src"])]),_:1},8,["disabled"])])]),_:1},8,["action","headers","disabled","before-upload"])])])])]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(O,{ref_key:"actorCostumePopoverRef",ref:H,"virtual-ref":e(_),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,380px)",trigger:"click"},{default:t(()=>[o(K,{modelValue:e(n).model_id,"onUpdate:modelValue":a[10]||(a[10]=c=>e(n).model_id=c),onSelect:J,scene:"character_look_costume","no-init":""},null,8,["modelValue"])]),_:1},8,["virtual-ref"])])}}}),so=Ue(ao,[["__scopeId","data-v-3c195c70"]]),no={class:"flex flex-column grid-gap-4"},ro={class:"grid-columns-5 grid-gap-4"},uo={class:"character-look-item-image flex flex-center bg-overlay rounded-4"},io=["onClick"],co={key:0,class:"flex flex-column flex-center grid-gap-2"},mo={class:"h10"},po={class:"h10"},fo={class:"flex flex-center grid-gap-2"},_o={class:"h10"},go={class:"flex flex-center grid-gap-2"},vo=ve({__name:"index",props:{query:{default:()=>({})},types:{default:()=>[]}},emits:["select"],setup(X,{expose:Y,emit:Z}){const N=Je(),{USERINFO:ee}=Oe(N),A=X,j=Z,m=de({type:"all",description:"",actor_id:"",...A.query}),S=d([]),w=d(!1),n=d(!1),C=()=>{n.value=!0,S.value=[],M.get("/app/shortplay/api/CharacterLook/index",{params:m}).then(u=>{u.code===T.SUCCESS&&(h.value={},S.value=u.data)}).finally(()=>{n.value=!1})},h=d({}),U=u=>{if(u.status_enum.value!=="generated")return q.info("该装扮还未初始化完成");h.value=u},oe=()=>{w.value=!1,j("select",{...h.value,type:m.type,actor_costume_model_id:_.value.id,actor_costume_three_view_model_id:k.value.id})},F=d(!1),V=d(),G=d(),_=d({}),H=u=>{_.value=u,G.value?.hide()},x=d(),J=d(),k=d({}),le=Se([_,k]),te=u=>{k.value=u,J.value?.hide()},p=u=>{u&&(u?.actor?m.actor_id=u.actor.id:m.actor_id=""),C(),O(),w.value=!0},a=u=>{F.value||u()},g=d(),v=d(!1),L=d(!1),ae=u=>{g.value=u,v.value=!0},se=()=>{L.value||(L.value=!0,M.post("/app/shortplay/api/Generate/characterLookCostume",g.value).then(u=>{u.code===T.SUCCESS?(C(),v.value=!1):q.info(u.msg)}).catch(()=>{q.error("初始化失败")}).finally(()=>{L.value=!1}))},{subscribe:$,unsubscribeAll:ne}=We(),O=()=>{$("private-generatecharacterlookcostume-"+ee.value?.user,u=>{console.log("channels complete info message",u),S.value.find(R=>R.id===u.id)&&C()})};De(()=>{ne()});const D=d();return Y({open:p}),(u,l)=>{const R=Qe,re=Ke,K=Ce,c=P("Search"),B=Ve,Ee=xe,$e=ye,Ie=P("Plus"),Q=he,Pe=P("Loading"),z=Le,qe=Te,Fe=Ge,pe=ke,ue=we,fe=be,Be=so,_e=je;return i(),f("div",null,[o(pe,{modelValue:e(w),"onUpdate:modelValue":l[5]||(l[5]=r=>ie(w)?w.value=r:null),class:"generate-scene-dialog",draggable:"",width:"min(100%,800px)","close-on-press-escape":!1,"close-on-click-modal":!1,"before-close":a},{header:t(()=>[...l[12]||(l[12]=[s("span",{class:"font-weight-600"},"演员装扮",-1)])]),footer:t(()=>[o(z,{bg:"",text:"",onClick:l[4]||(l[4]=r=>w.value=!1),loading:e(F)},{default:t(()=>[...l[22]||(l[22]=[y("取消",-1)])]),_:1},8,["loading"]),l[26]||(l[26]=s("div",{class:"flex-1"},null,-1)),e(m).type!=="actor"?(i(),f(b,{key:0},[s("div",{class:"flex flex-center grid-gap-2 input-button rounded-4 py-2 px-6",ref_key:"actorCostumeButtonRef",ref:V},[e(_).id?(i(),f(b,{key:1},[o(Q,{src:e(_).icon,alt:e(_).name,shape:"square",class:"icon-model"},null,8,["src","alt"]),s("span",mo,I(e(_).name),1)],64)):(i(),f(b,{key:0},[o(B,{alt:"角色换装",class:"icon-model",color:"var(--el-color-success)"},{default:t(()=>[o(me)]),_:1}),l[23]||(l[23]=s("span",{class:"h10"},"选择角色换装模型",-1))],64))],512),s("div",{class:"flex flex-center grid-gap-2 input-button rounded-4 py-2 px-6",ref_key:"actorCostumeThreeViewButtonRef",ref:x},[e(k).id?(i(),f(b,{key:1},[o(Q,{src:e(k).icon,alt:e(k).name,shape:"square",class:"icon-model"},null,8,["src","alt"]),s("span",po,I(e(k).name),1)],64)):(i(),f(b,{key:0},[o(B,{alt:"角色换装三视图",class:"icon-model",color:"var(--el-color-success)"},{default:t(()=>[o(me)]),_:1}),l[24]||(l[24]=s("span",{class:"h10"},"选择角色换装三视图模型",-1))],64))],512),s("div",fo,[o(B,{size:"16"},{default:t(()=>[o(Re)]),_:1}),s("span",_o,I(e(le)),1)])],64)):W("",!0),o(z,{type:"success",onClick:oe,loading:e(F),disabled:!e(h).id},{default:t(()=>[...l[25]||(l[25]=[s("span",null,"确认选择",-1)])]),_:1},8,["loading","disabled"])]),default:t(()=>[ge((i(),f("div",no,[o($e,{class:"flex flex-center grid-gap-4",onSubmit:ce(C,["prevent"])},{default:t(()=>[o(K,{class:"mb-0"},{default:t(()=>[o(re,{modelValue:e(m).type,"onUpdate:modelValue":l[0]||(l[0]=r=>e(m).type=r),class:"text-info",onChange:C},{default:t(()=>[o(R,{value:"all"},{default:t(()=>[...l[13]||(l[13]=[y("全部",-1)])]),_:1}),o(R,{value:"drama"},{default:t(()=>[...l[14]||(l[14]=[y("本剧",-1)])]),_:1}),o(R,{value:"episode"},{default:t(()=>[...l[15]||(l[15]=[y("本集",-1)])]),_:1}),e(m).actor_id?(i(),E(R,{key:0,value:"actor"},{default:t(()=>[...l[16]||(l[16]=[y("演员装扮",-1)])]),_:1})):W("",!0)]),_:1},8,["modelValue"])]),_:1}),l[17]||(l[17]=s("div",{class:"flex-1"},null,-1)),o(K,{class:"mb-0"},{default:t(()=>[o(Ee,{modelValue:e(m).description,"onUpdate:modelValue":l[1]||(l[1]=r=>e(m).description=r),placeholder:"搜索装扮",clearable:"",onChange:C},{suffix:t(()=>[o(B,null,{default:t(()=>[o(c)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(S).length>0||e(n)?ge((i(),E(qe,{key:0,height:"40vh"},{default:t(()=>[s("div",ro,[e(m).type!="actor"?(i(),f("div",{key:0,class:"grid-column-1 flex flex-column flex-center grid-gap-2 character-look-item",onClick:l[2]||(l[2]=r=>{e(D)?.open?.()})},[s("div",uo,[o(B,{size:"50",class:"border rounded-4 p-4 border-2"},{default:t(()=>[o(Ie)]),_:1})]),l[18]||(l[18]=s("span",null,"新增装扮",-1))])):W("",!0),(i(!0),f(b,null,Ne(e(S),r=>(i(),f("div",{class:Ae(["grid-column-1 flex flex-column flex-center grid-gap-2 character-look-item",{"character-look-item-active":e(h).id===r.id}]),onClick:ze=>U(r)},[r.component==="actor"?(i(),f(b,{key:0},[o(Q,{src:r.headimg,shape:"square",fit:"fill",class:"character-look-item-image"},null,8,["src"]),s("span",null,I(r.characterLook.title),1)],64)):(i(),f(b,{key:1},[o(Q,{src:r.status_enum.value==="generated"?r.costume_url:"",shape:"square",fit:"fill",class:"character-look-item-image bg-mosaic"},{default:t(()=>[r.status_enum.value==="pending"?(i(),f("div",co,[o(B,null,{default:t(()=>[o(Pe,{class:"circular"})]),_:1}),l[19]||(l[19]=s("span",{class:"text-info h10"},"初始化中",-1))])):r.status_enum.value==="initializing"?(i(),E(z,{key:1,type:"success",size:"small",text:"",onClick:ce(ze=>ae(r),["stop"])},{default:t(()=>[...l[20]||(l[20]=[y("立即初始化",-1)])]),_:1},8,["onClick"])):W("",!0)]),_:2},1032,["src"]),s("span",null,I(r.title),1)],64))],10,io))),256))])]),_:1})),[[_e,e(n)]]):(i(),E(Fe,{key:1,description:"暂无装扮"},{default:t(()=>[o(z,{type:"success",bg:"",text:"",onClick:l[3]||(l[3]=r=>{e(D)?.open?.()})},{default:t(()=>[...l[21]||(l[21]=[y("新增装扮",-1)])]),_:1})]),_:1}))])),[[_e,e(F)]])]),_:1},8,["modelValue"]),o(fe,{ref_key:"actorCostumePopoverRef",ref:G,"virtual-ref":e(V),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,380px)",trigger:"click"},{default:t(()=>[o(ue,{modelValue:e(_).id,"onUpdate:modelValue":l[6]||(l[6]=r=>e(_).id=r),onSelect:H,scene:"actor_costume"},null,8,["modelValue"])]),_:1},8,["virtual-ref"]),o(fe,{ref_key:"actorCostumeThreeViewPopoverRef",ref:J,"virtual-ref":e(x),"virtual-triggering":"",placement:"bottom-start",width:"min(100vw,380px)",trigger:"click"},{default:t(()=>[o(ue,{modelValue:e(k).id,"onUpdate:modelValue":l[7]||(l[7]=r=>e(k).id=r),onSelect:te,scene:"actor_costume_three_view"},null,8,["modelValue"])]),_:1},8,["virtual-ref"]),o(Be,{ref_key:"xlCharacterLookCreateRef",ref:D,query:A.query,onSuccess:l[8]||(l[8]=r=>{e(m).type="all",C()})},null,8,["query"]),o(pe,{modelValue:e(v),"onUpdate:modelValue":l[11]||(l[11]=r=>ie(v)?v.value=r:null),class:"generate-storyboard-dialog",draggable:""},{header:t(()=>[...l[27]||(l[27]=[s("span",{class:"font-weight-600"},"初始化装扮",-1)])]),footer:t(()=>[s("div",go,[o(z,{type:"info",onClick:l[10]||(l[10]=r=>v.value=!1),disabled:e(L)},{default:t(()=>[...l[28]||(l[28]=[y("取消",-1)])]),_:1},8,["disabled"]),o(z,{type:"success",icon:"Check",onClick:se,disabled:!e(g).model_id||e(L),loading:e(L)},{default:t(()=>[...l[29]||(l[29]=[y("初始化",-1)])]),_:1},8,["disabled","loading"])])]),default:t(()=>[o(ue,{modelValue:e(g).model_id,"onUpdate:modelValue":l[9]||(l[9]=r=>e(g).model_id=r),scene:"character_look_costume","no-init":""},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}}),Vo=Ue(vo,[["__scopeId","data-v-eed04bbb"]]);export{Vo as _};
