import{u as ze,I as le,a as te,_ as Ie}from"./usePoints-DiZlsgf1.js";import{d as Ce,r as n,z as oe,j as z,k as p,m as l,S as Pe,u as s,J as ie,s as i,am as Fe,l as t,f as E,h as r,an as Re,B as Ve,K as Se,I,a8 as Ee,t as D,q as Ue,af as re,ai as Me,ac as Te,e as u,g as qe,p as ne,C as Be,x as de,O as pe,E as C}from"./vendor-C6C8mA7k.js";import{$ as g,R as $,_ as He}from"./index-BY2sLTz-.js";import{I as De}from"./icon-points-DqG7XnbB.js";import{I as $e,a as Ge,b as Le}from"./icon-image-ide2QEnO.js";const Ae={key:0,class:"font-weight-600"},Ne={key:1,class:"font-weight-600"},Je={key:2,class:"font-weight-600"},je={class:"flex grid-gap-4 flex-y-flex-start"},Ke={key:0,class:"flex-1 grid-columns-6 grid-gap-4"},Oe={class:"flex flex-column grid-gap-4 w-100"},Qe={class:"bg-overlay rounded-4 p-4 w-100"},We={key:0,class:"flex flex-y-center grid-gap-2 line-height-1 mt-4"},Xe={class:"h10 text-ellipsis-1",style:{"max-width":"60px"}},Ye={class:"h10 text-ellipsis-1",style:{"max-width":"60px"}},Ze={class:"bg rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover"},ea={class:"flex flex-center grid-gap-2"},aa={class:"h10 text-nowrap"},sa={key:1,class:"flex flex-column grid-gap-4 p-4 bg-overlay rounded-4"},la={key:0,class:"flex flex-column flex-center grid-gap-2"},ta={class:"flex flex-center grid-gap-2 h10"},oa={class:"rounded-round p-1 flex flex-center grid-gap-2",style:{"background-color":"#FFFFFF",color:"#141414"}},ia={key:1,class:"flex flex-column flex-center grid-gap-2"},ra={key:2,class:"flex flex-column grid-gap-4 bg-overlay rounded-4 p-4"},na={class:"flex flex-center grid-gap-4"},da={class:"flex flex-center grid-gap-2 w-100"},pa=Ce({__name:"xl-prop-create",emits:["success"],setup(ua,{expose:ue,emit:ce}){const me=ce,x=n(!1),e=oe({id:"",drama_id:"",episode_id:"",image_state:!1,image_model_id:"",three_view_image_state:!1,three_view_model_id:"",status_enum:{value:"initializing",label:"待初始化"},name:"",image:"",three_view_image:"",description:"",image_reference_state:!1,reference_image:""}),G=n(null),U=n(!1),ge=oe({image_model_id:[{required:!0,message:"请选择图片模型",trigger:"change"}],three_view_model_id:[{required:!0,message:"请选择三维模型",trigger:"change"}],description:[{required:!0,message:"请输入备注",trigger:"change"}]}),P=n(!1),_e=(o,a,m)=>{x.value=!0,P.value=!0,h.value="description",pe(()=>{o?(e.id=o.id,e.image=o.image,e.three_view_image=o.three_view_image,e.name=o.name,e.description=o.description,e.drama_id=a,e.episode_id=m):(e.drama_id=a,e.episode_id=m)})},fe=(o,a,m)=>{x.value=!0,P.value=!1,h.value="upload",pe(()=>{o?(e.id=o.id,e.image=o.image,e.three_view_image=o.three_view_image,e.name=o.name,e.description=o.description,e.drama_id=a,e.episode_id=m):(e.drama_id=a,e.episode_id=m)})},S=()=>{G.value?.resetFields(),x.value=!1,e.id="",e.name="",e.description="",e.image_model_state=!1,e.image_model_id="",e.three_view_model_state=!1,e.three_view_model_id="",e.status_enum={value:"initializing",label:"待初始化"},e.image="",e.three_view_image="",e.drama_id="",e.episode_id=""},L=o=>{g.post("/app/shortplay/api/Prop/update",e).then(a=>{a.code===$.SUCCESS?(C.success(a.msg),e.id=a.data.id,o?o():S(),me("success")):C.error(a.msg)}).catch(()=>{C.error("更新失败")})},F=n(null),M=n(null),R=n(!1),V=n(!1),w=n(!1),T=o=>{if(o.code===$.SUCCESS)switch(o.data.dir_name){case"prop/image":R.value=!1,e.image=o.data.url,F.value?.clearFiles();break;case"prop/three_view":V.value=!1,e.three_view_image=o.data.url,F.value?.clearFiles();break;case"prop/reference":w.value=!1,e.image_reference_state=!0,e.reference_image=o.data.url,M.value?.clearFiles();break}else C.error(o.msg)},q=()=>{F.value?.clearFiles(),M.value?.clearFiles()},A=n(),N=n(),_=n({}),J=o=>{o?(e.image_model_id=o.id,e.image_state=!0,_.value=o):(e.image_model_id="",e.image_state=!1,_.value={}),N.value?.hide()},j=n(),K=n(),f=n({}),O=o=>{o?(e.three_view_model_id=o.id,f.value=o,e.three_view_image_state=!0):(e.three_view_model_id="",f.value={},e.three_view_image_state=!1),K.value?.hide()},ve=ze([_,f]),v=n(!1),Q=()=>{if(!(v.value||e.status_enum.value==="pending")){if(!e.id)return L(Q);v.value=!0,g.post("/app/shortplay/api/Prop/initializing",e).then(o=>{o.code===$.SUCCESS?(e.status=o.data.status,e.status_enum=o.data.status_enum):C.error(o.msg)}).catch(()=>{C.error("生成图片失败")}).finally(()=>{v.value=!1})}},he=(o,a)=>{o==="generatepropimage"?a.id===e.id&&(e.status_enum=a.status,a.image?e.image=a.image:v.value=!1):o==="generatepropthreeviewimage"&&a.id===e.id&&(e.status_enum=a.status,a.image?e.three_view_image=a.image:v.value=!1)},h=n("description"),y=n("image");return ue({open:_e,upload:fe,close:S,subscribe:he}),(o,a)=>{const m=Ve,W=Re,xe=Se,k=Ee,X=z("Close"),d=Ue,Y=z("ArrowDown"),b=z("Loading"),we=z("Plus"),ye=z("PictureRounded"),B=Te,H=Me,Z=z("Top"),ee=qe,ke=Fe,ae=Be,be=Pe,se=Ie;return r(),p("div",null,[l(be,{modelValue:s(x),"onUpdate:modelValue":a[8]||(a[8]=c=>ie(x)?x.value=c:null),class:"generate-scene-dialog",draggable:"",width:s(P)?"min(100%,840px)":"min(100%,426px)",onClose:S},{header:i(()=>[s(P)?(r(),p("span",Ae,"上传物品")):s(e).id?(r(),p("span",Je,"编辑物品")):(r(),p("span",Ne,"创建物品"))]),footer:i(()=>[t("div",da,[l(ae,{type:"info",onClick:S,disabled:s(U)},{default:i(()=>[...a[24]||(a[24]=[de("取消",-1)])]),_:1},8,["disabled"]),a[26]||(a[26]=t("div",{class:"flex-1"},null,-1)),l(ae,{type:"success",onClick:a[7]||(a[7]=c=>L()),disabled:s(U),loading:s(U)},{default:i(()=>[...a[25]||(a[25]=[de("提交",-1)])]),_:1},8,["disabled","loading"])])]),default:i(()=>[l(ke,{"label-position":"top",model:s(e),rules:s(ge),ref_key:"propFormRef",ref:G,class:"prop-form",disabled:s(e).status_enum.value!=="initializing"},{default:i(()=>[t("div",je,[s(P)?(r(),p("div",Ke,[l(W,{label:"物品名称",prop:"title",class:"grid-column-6"},{default:i(()=>[l(m,{modelValue:s(e).name,"onUpdate:modelValue":a[0]||(a[0]=c=>s(e).name=c),placeholder:"请输入物品名称",class:"prop-form-input bg-overlay"},null,8,["modelValue"])]),_:1}),l(W,{label:"物品图",class:"grid-column-6"},{default:i(()=>[t("div",Oe,[l(xe,{modelValue:s(h),"onUpdate:modelValue":a[1]||(a[1]=c=>ie(h)?h.value=c:null),class:"tabs-segmented",options:[{label:"文本生成",value:"description"},{label:"本地上传",value:"upload"}]},null,8,["modelValue"]),t("div",Qe,[l(m,{modelValue:s(e).description,"onUpdate:modelValue":a[2]||(a[2]=c=>s(e).description=c),placeholder:"请输入物品描述",size:"small",class:"prop-form-textarea",type:"textarea",autosize:{minRows:6,maxRows:20}},null,8,["modelValue"]),s(h)==="description"?(r(),p("div",We,[t("div",{class:"bg rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover",ref_key:"propHeadimgButtonRef",ref:A,title:"选择使用AI生成图"},[s(_).id?(r(),p(I,{key:0},[l(k,{src:s(_).icon,alt:s(_).name,shape:"square",size:16},null,8,["src","alt"]),t("span",Xe,D(s(_).name),1),l(d,{size:"16",class:"pointer",onClick:a[3]||(a[3]=re(c=>J(),["stop"]))},{default:i(()=>[l(X)]),_:1})],64)):(r(),p(I,{key:1},[l(d,{size:"16"},{default:i(()=>[l(le)]),_:1}),a[9]||(a[9]=t("span",{class:"h10 overflow-hidden text-nowrap",style:{"max-width":"60px"}},"物品图",-1)),l(d,{size:"16"},{default:i(()=>[l(Y)]),_:1})],64))],512),t("div",{class:"bg rounded-round p-3 flex flex-center grid-gap-2 pointer hover-bg-hover",ref_key:"propThreeViewModelButtonRef",ref:j,title:"选择使用AI生成三视图"},[s(f).id?(r(),p(I,{key:0},[l(k,{src:s(f).icon,alt:s(f).name,shape:"square",size:16},null,8,["src","alt"]),t("span",Ye,D(s(f).name),1),l(d,{size:"16",class:"pointer",onClick:a[4]||(a[4]=re(c=>O(),["stop"]))},{default:i(()=>[l(X)]),_:1})],64)):(r(),p(I,{key:1},[l(d,{size:"16"},{default:i(()=>[l(le)]),_:1}),a[10]||(a[10]=t("span",{class:"h10 overflow-hidden text-nowrap",style:{"max-width":"60px"}},"三视图",-1)),l(d,{size:"16"},{default:i(()=>[l(Y)]),_:1})],64))],512),l(H,{ref_key:"uploadReferenceImageRef",ref:M,title:"添加参考图",data:{dir_name:"prop/reference",dir_title:"物品图参考照片"},action:s(g).getCompleteUrl("app/shortplay/api/Uploads/upload"),headers:s(g).getHeaders(),accept:"image/jpeg,image/png",limit:1,type:"cover",disabled:s(w),"before-upload":()=>(w.value=!0,!0),"on-success":T,"show-file-list":!1,"on-error":()=>{w.value=!1,q()}},{default:i(()=>[t("div",Ze,[l(B,{placement:"top",disabled:!s(e).reference_image,width:"fit-content"},{reference:i(()=>[!s(e).reference_image||s(w)?(r(),u(d,{key:0,size:"16"},{default:i(()=>[s(w)?(r(),u(b,{key:0,class:"circular"})):(r(),u(we,{key:1}))]),_:1})):(r(),u(d,{key:1,size:"16",color:"var(--el-color-success)"},{default:i(()=>[l(ye)]),_:1}))]),default:i(()=>[l(k,{src:s(e).reference_image,fit:"contain",size:130,shape:"square"},null,8,["src"])]),_:1},8,["disabled"])])]),_:1},8,["action","headers","disabled","before-upload","on-error"]),a[11]||(a[11]=t("div",{class:"flex-1"},null,-1)),t("div",ea,[l(d,{size:"16"},{default:i(()=>[l(De)]),_:1}),t("span",aa,D(s(ve)),1)]),t("div",{class:"rounded-round p-3 flex flex-center grid-gap-2 pointer",style:{"background-color":"#FFFFFF",color:"#141414"},onClick:Q},[l(d,{size:"20"},{default:i(()=>[s(v)||s(e).status_enum.value==="pending"?(r(),u(b,{key:0,class:"circular"})):(r(),u(Z,{key:1}))]),_:1})])])):E("",!0)])])]),_:1})])):E("",!0),s(h)==="description"?(r(),p("div",sa,[l(k,{src:s(e).image,shape:"square",size:360,style:{"--el-avatar-bg-color":"var(--el-bg-color-overlay)"}},{default:i(()=>[s(e).status_enum.value==="initializing"?(r(),p("div",la,[l(d,{size:"64"},{default:i(()=>[s(v)?(r(),u(b,{key:0,class:"circular"})):(r(),u($e,{key:1}))]),_:1}),a[14]||(a[14]=t("span",{class:"h10"},"填写左侧表单，使用AI生成物品图",-1)),t("div",ta,[a[12]||(a[12]=t("span",null,"点击“",-1)),t("div",oa,[l(d,{size:"14"},{default:i(()=>[l(Z)]),_:1})]),a[13]||(a[13]=t("span",null,"”按钮生成",-1))])])):s(e).status_enum.value==="pending"?(r(),p("div",ia,[l(d,{size:"64"},{default:i(()=>[l(b,{class:"circular"})]),_:1}),a[15]||(a[15]=t("span",{class:"h10"},"生成中...",-1))])):E("",!0)]),_:1},8,["src"])])):(r(),p("div",ra,[t("div",null,[s(y)==="image"?(r(),u(H,{key:0,ref_key:"uploadImageRef",ref:F,class:"input-upload rounded-4",drag:"",data:{dir_name:"prop/image",dir_title:"物品图照片"},action:s(g).getCompleteUrl("app/shortplay/api/Uploads/upload"),headers:s(g).getHeaders(),accept:"image/jpeg,image/png",limit:1,type:"cover",disabled:s(R),"before-upload":()=>(R.value=!0,!0),"on-success":T,"show-file-list":!1,"on-error":()=>{R.value=!1,q()}},{default:i(()=>[s(e).image?(r(),u(ee,{key:1,src:s(e).image,class:"image-cover",fit:"contain"},null,8,["src"])):(r(),p(I,{key:0},[l(d,{class:"el-icon--upload"},{default:i(()=>[l(te)]),_:1}),a[16]||(a[16]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"拖拽物品图照片到此处或"),t("span",{class:"h10"},"点击上传")],-1)),a[17]||(a[17]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"支持上传格式："),t("span",{class:"h10"},"PNG, JPG, JPEG")],-1)),a[18]||(a[18]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"图照片建议比例："),t("span",{class:"h10"},"1:1")],-1))],64))]),_:1},8,["action","headers","disabled","before-upload","on-error"])):s(y)==="three_view"?(r(),u(H,{key:1,ref_key:"uploadImageRef",ref:F,class:"input-upload rounded-4",drag:"",data:{dir_name:"prop/three_view",dir_title:"物品三视图"},action:s(g).getCompleteUrl("app/shortplay/api/Uploads/upload"),headers:s(g).getHeaders(),accept:"image/jpeg,image/png",limit:1,type:"cover",disabled:s(V),"before-upload":()=>(V.value=!0,!0),"on-success":T,"show-file-list":!1,"on-error":()=>{V.value=!1,q()}},{default:i(()=>[s(e).three_view_image?(r(),u(ee,{key:1,src:s(e).three_view_image,class:"image-cover",fit:"contain"},null,8,["src"])):(r(),p(I,{key:0},[l(d,{class:"el-icon--upload"},{default:i(()=>[l(te)]),_:1}),a[19]||(a[19]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"拖拽物品三视图到此处或"),t("span",{class:"h10"},"点击上传")],-1)),a[20]||(a[20]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"支持上传格式："),t("span",{class:"h10"},"PNG, JPG, JPEG")],-1)),a[21]||(a[21]=t("div",{class:"el-upload__text"},[t("span",{class:"h10"},"图照片建议比例："),t("span",{class:"h10"},"1:1")],-1))],64))]),_:1},8,["action","headers","disabled","before-upload","on-error"])):E("",!0)]),t("div",na,[l(k,{src:s(e).image,shape:"square",size:60,class:"pointer",onClick:a[5]||(a[5]=c=>y.value="image")},{default:i(()=>[t("div",{class:ne(["flex flex-column flex-center grid-gap-1",{"text-secondary":s(y)==="three_view"}])},[l(d,{size:"20"},{default:i(()=>[s(R)?(r(),u(b,{key:0,class:"circular"})):(r(),u(Ge,{key:1}))]),_:1}),a[22]||(a[22]=t("span",{class:"h10"},"物品图",-1))],2)]),_:1},8,["src"]),l(k,{src:s(e).three_view_image,shape:"square",size:60,class:"pointer",onClick:a[6]||(a[6]=c=>y.value="three_view")},{default:i(()=>[t("div",{class:ne(["flex flex-column flex-center grid-gap-1",{"text-secondary":s(y)==="image"}])},[l(d,{size:"20"},{default:i(()=>[s(V)?(r(),u(b,{key:0,class:"circular"})):(r(),u(Le,{key:1}))]),_:1}),a[23]||(a[23]=t("span",{class:"h10"},"三视图",-1))],2)]),_:1},8,["src"])])]))])]),_:1},8,["model","rules","disabled"])]),_:1},8,["modelValue","width"]),l(B,{ref_key:"propHeadimgPopoverRef",ref:N,"virtual-ref":s(A),"virtual-triggering":"",teleported:!1,placement:"bottom-start",width:"min(100vw,380px)",trigger:"click"},{default:i(()=>[l(se,{onSelect:J,scene:"prop_image","no-init":""})]),_:1},8,["virtual-ref"]),l(B,{ref_key:"propThreeViewModelPopoverRef",ref:K,"virtual-ref":s(j),"virtual-triggering":"",teleported:!1,placement:"bottom-start",width:"min(100vw,380px)",trigger:"click"},{default:i(()=>[l(se,{onSelect:O,scene:"prop_three_view_image","no-init":""})]),_:1},8,["virtual-ref"])])}}}),va=He(pa,[["__scopeId","data-v-f5fef7a5"]]);export{va as _};
