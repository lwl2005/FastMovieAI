import{X as ce,_ as ie}from"./index-C2wibvwG.js";import{_ as de,a as ue,b as pe}from"./xl-actor-create-BekV8bjq.js";import{d as j,z as H,r as g,o as J,j as V,e as S,a4 as Q,s as a,P as _e,h as c,k as _,u as s,I as U,M as D,l as o,m as l,ae as R,q as Y,t as h,a7 as q,f as L,a5 as fe,a6 as me,D as ge,E as W,a as ve,aj as xe,B as be,L as he,N as ke,ak as ye,x as B,al as Ce,am as we,p as Se,an as $e,K as Ee}from"./vendor-t8h0TCfL.js";import{D as Ve}from"./drama-DPzQfD5d.js";import{c as X,$ as N,R as z,r as Ie,_ as G,u as T,a as Ue,t as De}from"./index-B0RNcuq8.js";import{u as Re}from"./usePush-v4t_r-_Z.js";import"./usePoints-C21LjXJs.js";import"./icon-points-01HE_Clx.js";import"./icon-image-BfHAjLRU.js";const Le={class:"flex-1"},Ae={key:0,class:"flex flex-wrap grid-gap-6"},Be=["onClick"],Ne=["onClick"],ze={class:"box-drama-episode"},Fe={key:0,class:"flex flex-column grid-gap-1 flex-center"},Me={class:"box-content"},Pe={class:"box-content-icon"},Oe={class:"box-content-title"},We={class:"h8 font-weight-500 text-ellipsis-1"},Te={class:"h9 text-secondary font-weight-500"},je={key:1,class:"flex flex-center"},qe=j({__name:"works",setup(K){const $=X(),d=H({page:1,limit:20,title:"",script:"all"}),C=g(!1),f=g([]),i=g(0),m=()=>{$.hasLogin()&&(C.value=!0,N.get("/app/shortplay/api/Works/index",{params:d}).then(u=>{u.code===z.SUCCESS&&(f.value=[...f.value,...u.data.data],d.page=u.data.page,d.limit=u.data.limit,i.value=u.data.total)}).finally(()=>{C.value=!1}))},k=()=>{f.value.length>=i.value||(d.page++,m())},x=u=>{ge.confirm("确定删除该作品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{N.post("/app/shortplay/api/Drama/delete",{id:u.id}).then(b=>{b.code===z.SUCCESS&&(W.success("删除作品成功"),f.value=[],d.page=1,m())})})},n=u=>{Ie.push("/works/"+u.id)};return J(()=>{m()}),(u,b)=>{const E=V("Delete"),y=Y,I=V("Loading"),v=q,r=fe,e=Q,w=me;return c(),S(e,{height:"100%","wrap-class":"flex-1",onEndReached:k},{default:a(()=>[_e((c(),_("div",Le,[s(f).length>0?(c(),_("div",Ae,[(c(!0),_(U,null,D(s(f),p=>(c(),_("div",{class:"box flex-1",key:p.id,onClick:F=>n(p)},[o("div",{class:"box-delete",onClick:R(F=>x(p),["stop"])},[l(y,null,{default:a(()=>[l(E)]),_:1})],8,Ne),o("span",ze," 共"+h(p.episode_num)+"集 ",1),l(v,{src:p.cover,class:"box-image",shape:"square"},{default:a(()=>[p.cover_state?(c(),_("div",Fe,[l(y,{size:"40"},{default:a(()=>[l(I,{class:"circular"})]),_:1}),b[0]||(b[0]=o("span",{class:"h10 font-weight-600 text-success"},"AI正在生成封面...",-1))])):L("",!0)]),_:2},1032,["src"]),o("div",Me,[o("div",Pe,[l(y,{size:30},{default:a(()=>[l(Ve)]),_:1})]),o("div",Oe,[o("span",We,h(p.title),1),o("span",Te,h(p.create_time),1)])])],8,Be))),128))])):(c(),_("div",je,[l(r,{description:"暂无作品"})]))])),[[w,s(C)]])]),_:1})}}}),Xe=G(qe,[["__scopeId","data-v-1b08acbc"]]),Ge={class:"flex flex-column draw-module grid-gap-4"},Ke={class:"grid-columns-xxl-7 grid-columns-xl-6 grid-columns-lg-5 grid-columns-md-4 grid-columns-sm-3 grid-columns-xs-2 grid-columns-p-1 grid-gap-4"},He=["onClick"],Je=["onClick"],Qe={class:"flex grid-gap-2 actor-status"},Ye={class:"flex flex-column flex-y-flex-end grid-gap-2"},Ze={class:"flex flex-column grid-gap-2 actor-info"},el=["onClick"],ll=j({__name:"actors",setup(K){const $=X(),{USERINFO:d}=T($),C=Ue(),{WEBCONFIG:f}=T(C),i=H({type:"personal",name:"",actor_id:"",species_type:null,gender:null,age:null}),m=g([]),k=g(!1),x=g(null),n=()=>{k.value=!0,N.get("/app/shortplay/api/Actor/index",{params:i}).then(r=>{r.code===z.SUCCESS&&(m.value=r.data)}).catch(r=>{console.error("getActorList error",r)}).finally(()=>{k.value=!1})},u=r=>{N.post("/app/shortplay/api/Actor/delete",{id:r.id}).then(e=>{e.code===z.SUCCESS?(W.success(e.msg),n()):W.error(e.msg)})},b=g(!1),E=g([]),{subscribe:y,unsubscribeAll:I}=Re(),v=()=>{y("private-generateactorimage-"+d.value?.user,r=>{console.log("channels complete info message",r);const e=m.value.find(w=>w.id===r.id);e&&(e.status_enum=r.status,r.image&&(e.headimg=r.image)),x.value?.subscribe?.("generateactorimage",r)}),y("private-generateactorthreeviewimage-"+d.value?.user,r=>{console.log("channels complete info message",r);const e=m.value.find(w=>w.id===r.id);e&&(e.status_enum=r.status,r.image&&(e.three_view_image=r.image)),x.value?.subscribe?.("generateactorthreeviewimage",r)})};return J(()=>{n(),v()}),ve(()=>{console.log("actors unmounted"),I()}),(r,e)=>{const w=V("Search"),p=Y,F=be,A=xe,M=ke,P=he,Z=ye,ee=V("Plus"),le=q,te=V("Delete"),oe=we,se=V("UserFilled"),ae=Q,ne=$e,re=de;return c(),_("div",Ge,[l(Z,{class:"flex flex-center grid-gap-4",onSubmit:R(n,["prevent"])},{default:a(()=>[l(A,{class:"mb-0"},{default:a(()=>[l(F,{modelValue:s(i).name,"onUpdate:modelValue":e[0]||(e[0]=t=>s(i).name=t),placeholder:"搜索演员",clearable:"",onChange:n},{suffix:a(()=>[l(p,null,{default:a(()=>[l(w)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e[7]||(e[7]=o("div",{class:"flex-1"},null,-1)),l(A,{class:"mb-0",style:{width:"80px"}},{default:a(()=>[l(P,{modelValue:s(i).species_type,"onUpdate:modelValue":e[1]||(e[1]=t=>s(i).species_type=t),placeholder:"物种",clearable:"",teleported:!1,onChange:n},{default:a(()=>[(c(!0),_(U,null,D(s(f)?.enum?.actor_species_type,t=>(c(),S(M,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(A,{class:"mb-0",style:{width:"80px"}},{default:a(()=>[l(P,{modelValue:s(i).gender,"onUpdate:modelValue":e[2]||(e[2]=t=>s(i).gender=t),placeholder:"性别",clearable:"",teleported:!1,onChange:n},{default:a(()=>[(c(!0),_(U,null,D(s(f)?.enum?.actor_gender,t=>(c(),S(M,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(A,{class:"mb-0",style:{width:"80px"}},{default:a(()=>[l(P,{modelValue:s(i).age,"onUpdate:modelValue":e[3]||(e[3]=t=>s(i).age=t),placeholder:"年龄",clearable:"",teleported:!1,onChange:n},{default:a(()=>[(c(!0),_(U,null,D(s(f)?.enum?.actor_age,t=>(c(),S(M,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(ae,{class:"flex-1"},{default:a(()=>[o("div",Ke,[o("div",{class:"grid-column-1 rounded-4 p-4 actor-item flex flex-column flex-center grid-gap-4 pointer bg-overlay",onClick:e[4]||(e[4]=t=>s(x)?.open?.(null))},[l(p,{class:"rounded-4",size:"20",style:{height:"40px",width:"40px","background-color":"var(--el-fill-color-dark)"}},{default:a(()=>[l(ee)]),_:1}),e[8]||(e[8]=o("span",null,"添加演员",-1))]),(c(!0),_(U,null,D(s(m),t=>(c(),_("div",{class:"grid-column-1 input-button rounded-4 flex flex-column flex-center grid-gap-2 actor-item bg-overlay border",key:t.id},[l(le,{src:t.headimg,class:"actor-avatar bg-mosaic",fit:"cover",title:t.is_edit?t.name:"公共角色不可编辑"},{default:a(()=>[B(h(t.name),1)]),_:2},1032,["src","title"]),o("div",{class:"actor-edit-mask flex flex-column grid-gap-4 flex-center pointer",onClick:O=>s(x)?.open?.(t)},[o("div",{class:"flex flex-center bg-overlay rounded-round p-2 pointer grid-gap-2",onClick:R(O=>s(x)?.upload?.(t),["stop"])},[l(p,{size:"16"},{default:a(()=>[l(s(Ce))]),_:1}),e[9]||(e[9]=o("span",{class:"h10"},"手动上传",-1))],8,Je),l(oe,{title:"确定删除该演员吗？",width:"fit-content",onConfirm:O=>u(t),placement:"bottom-end"},{reference:a(()=>[o("div",{class:"flex flex-center bg-overlay rounded-round p-2 pointer grid-gap-2",onClick:e[5]||(e[5]=R(()=>{},["stop"]))},[l(p,{size:"16"},{default:a(()=>[l(te)]),_:1}),e[10]||(e[10]=o("span",{class:"h10"},"删除演员",-1))])]),_:1},8,["onConfirm"])],8,He),o("div",Qe,[e[11]||(e[11]=o("div",{class:"flex-1"},null,-1)),o("div",Ye,[o("span",{class:Se(["actor-tag",["actor-tag--"+t.status_enum.props.type]])},h(t.status_enum.label),3)])]),o("div",Ze,[o("div",{class:"actor-name flex flex-center grid-gap-1 pointer",onClick:R(O=>s(x)?.open?.(t),["stop"])},[l(p,{size:"16"},{default:a(()=>[l(se)]),_:1}),o("span",null,h(t.name),1)],8,el)])]))),128))])]),_:1}),s(b)?(c(),S(ne,{key:0,"url-list":s(E),onClose:e[6]||(e[6]=t=>b.value=!1)},null,8,["url-list"])):L("",!0),l(re,{ref_key:"actorCreateRef",ref:x,onSuccess:n},null,512)])}}}),tl=G(ll,[["__scopeId","data-v-a4603fd4"]]),ol={class:"container"},sl={class:"flex flex-y-center flex-x-space-between"},al={class:"flex flex-y-center flex-x-center grid-gap-7"},nl={class:"flex flex-column flex-x-start grid-gap-3"},rl={class:"h3 font-weight-bold text-ellipsis-1"},cl={class:"flex flex-y-center grid-gap-10"},il={class:"flex flex-x-center my-7"},dl={key:0,class:"py-10"},ul=j({__name:"index",setup(K){const $=g("works"),d=g("works"),C=[{label:"我的作品",value:"works"},{label:"我的演员",value:"actor"},{label:"我的音色",value:"voice"}],f=X(),{USERINFO:i}=T(f),m=g(null),k=g(null);return(x,n)=>{const u=q,b=Ee,E=ue,y=pe,I=ie;return c(),_("div",ol,[o("div",sl,[o("div",al,[l(u,{size:75,src:s(i)?.headimg},{default:a(()=>[B(h(s(De)(s(i)?.nickname,1)),1)]),_:1},8,["src"]),o("div",nl,[o("span",rl,h(s(i)?.nickname),1),o("div",null,"ID："+h(s(i)?.id),1)])]),o("div",cl,[o("div",{class:"btn flex-shrink-0",onClick:n[0]||(n[0]=(...v)=>k.value.open&&k.value.open(...v))},"编辑主页"),o("div",{class:"btn flex-shrink-0",onClick:n[1]||(n[1]=(...v)=>m.value.open&&m.value.open(...v))},"邀请好友 ")])]),o("div",il,[l(b,{modelValue:d.value,"onUpdate:modelValue":n[2]||(n[2]=v=>d.value=v),options:C},null,8,["modelValue"])]),d.value==="works"?(c(),_("div",dl,[l(y,{modelValue:$.value,"onUpdate:modelValue":n[3]||(n[3]=v=>$.value=v),class:"text-info",color:"var(--el-color-white)"},{default:a(()=>[l(E,{value:"works"},{default:a(()=>[...n[4]||(n[4]=[B("创作作品",-1)])]),_:1}),l(E,{value:"publish"},{default:a(()=>[...n[5]||(n[5]=[B("发布作品",-1)])]),_:1})]),_:1},8,["modelValue"])])):L("",!0),d.value==="works"?(c(),S(Xe,{key:1})):L("",!0),d.value==="actor"?(c(),S(tl,{key:2})):L("",!0),l(ce,{ref_key:"xlInvitationCodeRef",ref:m},null,512),l(I,{ref_key:"xlUserinfoRef",ref:k},null,512)])}}}),kl=G(ul,[["__scopeId","data-v-2b8e81c4"]]);export{kl as default};
