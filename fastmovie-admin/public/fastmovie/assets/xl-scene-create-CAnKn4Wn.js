import{d as T,r as _,z as j,k as d,m as o,S as G,u as s,J as R,s as n,e as F,f as h,K as H,am as P,an as Q,B as W,l as S,a5 as X,I as q,M as B,C as Y,x as I,E as f,h as c,p as D,t as v}from"./vendor-CvgTi-PR.js";import{$ as V,R as C,_ as Z}from"./index-Bz1vQmFt.js";const ee={key:0,class:"font-weight-600"},se={key:1,class:"font-weight-600"},le={class:"w-100 grid-columns-2 grid-gap-2"},ae={key:2,class:"flex flex-center grid-gap-4"},te={class:"episode-tabs",style:{"--el-anchor-active-color":"var(--el-color-success)","--el-anchor-marker-bg-color":"var(--el-color-success)"}},oe=["onClick"],ne={class:"episode-tabs",style:{"--el-anchor-active-color":"var(--el-color-success)","--el-anchor-marker-bg-color":"var(--el-color-success)"}},re=["onClick"],ce={key:0,class:"flex flex-center grid-gap-2"},de=T({__name:"xl-scene-create",emits:["success"],setup(ie,{expose:N,emit:$}){const k=$,u=_("form"),e=j({id:"",title:"",scene_space:"",scene_location:"",scene_time:"",scene_weather:"",description:"",atmosphere:"",drama_id:"",episode_id:""}),z={title:[{required:!0,message:"请输入场景名称",trigger:"blur"}],scene_space:[{required:!0,message:"请输入内景OR外景",trigger:"blur"}],scene_location:[{required:!0,message:"请输入地点",trigger:"blur"}],scene_time:[{required:!0,message:"请输入大概时间",trigger:"blur"}],scene_weather:[{required:!0,message:"请输入天气",trigger:"blur"}],description:[{required:!0,message:"请输入描述",trigger:"blur"}]},r=_(!1),b=_([]),g=_(""),L=()=>{V.get("/app/shortplay/api/DramaEpisode/episodes",{params:{drama_id:e.drama_id}}).then(t=>{t.code===C.SUCCESS?(b.value=t.data,g.value=b.value[0]?.id||""):f.error(t.msg)}).catch(()=>{f.error("获取分集失败")})},M=t=>{r.value||(r.value=!0,V.post("/app/shortplay/api/Scene/copyScene",{episode_id:e.episode_id,drama_id:e.drama_id,scene_id:t.id}).then(a=>{a.code===C.SUCCESS?(k("success",a.data),p.value=!1):f.error(a.msg)}).catch(()=>{f.error("新增场景失败")}).finally(()=>{r.value=!1}))},p=_(!1),y=_(null),x=()=>{y.value?.resetFields(),p.value=!1,e.id="",e.title="",e.scene_location="",e.scene_space="",e.scene_time="",e.scene_weather="",e.description="",e.atmosphere="",e.drama_id="",e.episode_id=""},O=()=>{r.value||(r.value=!0,V.post("/app/shortplay/api/Scene/update",e).then(t=>{t.code===C.SUCCESS?(k("success",t.data),x()):f.error(t.msg)}).catch(()=>{f.error("新增场景失败")}).finally(()=>{r.value=!1}))};return N({open:t=>{t.scene&&(e.id=t.scene.id,e.title=t.scene.title,e.scene_location=t.scene.scene_location,e.scene_space=t.scene.scene_space,e.scene_time=t.scene.scene_time,e.scene_weather=t.scene.scene_weather,e.description=t.scene.description,e.atmosphere=t.scene.atmosphere),e.drama_id=t.drama_id,e.episode_id=t.episode_id,L(),p.value=!0}}),(t,a)=>{const A=H,m=W,i=Q,J=P,E=X,w=Y,K=G;return c(),d("div",null,[o(K,{modelValue:s(p),"onUpdate:modelValue":a[7]||(a[7]=l=>R(p)?p.value=l:null),class:"generate-scene-dialog",draggable:""},{header:n(()=>[s(e).id?(c(),d("span",ee,"编辑场景")):(c(),d("span",se,"新增场景"))]),footer:n(()=>[s(u)==="form"?(c(),d("div",ce,[o(w,{type:"info",onClick:x,disabled:s(r)},{default:n(()=>[...a[8]||(a[8]=[I("取消",-1)])]),_:1},8,["disabled"]),o(w,{type:"success",onClick:O,disabled:s(r),loading:s(r)},{default:n(()=>[...a[9]||(a[9]=[I("提交",-1)])]),_:1},8,["disabled","loading"])])):h("",!0)]),default:n(()=>[s(e).id?h("",!0):(c(),F(A,{key:0,modelValue:s(u),"onUpdate:modelValue":a[0]||(a[0]=l=>R(u)?u.value=l:null),disabled:s(r),options:[{label:"填写场景信息",value:"form"},{label:"从其他分集选取",value:"scene"}],class:"tabs-segmented border"},null,8,["modelValue","disabled"])),s(u)==="form"?(c(),F(J,{key:1,ref_key:"createSceneFormRef",ref:y,"label-position":"top",disabled:s(r),model:s(e),rules:z},{default:n(()=>[o(i,{label:"场景名称",prop:"title"},{default:n(()=>[o(m,{modelValue:s(e).title,"onUpdate:modelValue":a[1]||(a[1]=l=>s(e).title=l),placeholder:"请输入场景名称",class:"scene-item-input"},null,8,["modelValue"])]),_:1}),o(i,{label:"地点"},{default:n(()=>[S("div",le,[o(i,{prop:"scene_space"},{default:n(()=>[o(m,{modelValue:s(e).scene_space,"onUpdate:modelValue":a[2]||(a[2]=l=>s(e).scene_space=l),placeholder:"内景OR外景",class:"scene-item-input grid-column-1 w-100"},null,8,["modelValue"])]),_:1}),o(i,{prop:"scene_location"},{default:n(()=>[o(m,{modelValue:s(e).scene_location,"onUpdate:modelValue":a[3]||(a[3]=l=>s(e).scene_location=l),placeholder:"地点",class:"scene-item-input grid-column-1"},null,8,["modelValue"])]),_:1}),o(i,{prop:"scene_time"},{default:n(()=>[o(m,{modelValue:s(e).scene_time,"onUpdate:modelValue":a[4]||(a[4]=l=>s(e).scene_time=l),placeholder:"大概时间",class:"scene-item-input grid-column-1"},null,8,["modelValue"])]),_:1}),o(i,{prop:"scene_weather"},{default:n(()=>[o(m,{modelValue:s(e).scene_weather,"onUpdate:modelValue":a[5]||(a[5]=l=>s(e).scene_weather=l),placeholder:"天气",class:"scene-item-input grid-column-1"},null,8,["modelValue"])]),_:1})])]),_:1}),o(i,{label:"描述",prop:"description"},{default:n(()=>[o(m,{modelValue:s(e).description,"onUpdate:modelValue":a[6]||(a[6]=l=>s(e).description=l),type:"textarea",autosize:{minRows:1,maxRows:10},placeholder:"请输入描述",class:"scene-item-textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["disabled","model"])):h("",!0),s(u)==="scene"?(c(),d("div",ae,[o(E,{height:"400px"},{default:n(()=>[S("div",te,[(c(!0),d(q,null,B(s(b),(l,U)=>(c(),d("span",{key:l.id,onClick:pe=>g.value=l.id,class:D(["episode-tabs-item",{"is-active":l.id===s(g)}])}," #"+v(U+1)+" "+v(l.title),11,oe))),128))])]),_:1}),o(E,{height:"400px",class:"flex-1"},{default:n(()=>[S("div",ne,[(c(!0),d(q,null,B(s(b).find(l=>l.id===s(g))?.scenes,l=>(c(),d("span",{key:l.id,class:D(["episode-tabs-item",{"is-active":l.id===s(g)}]),onClick:U=>M(l)}," #"+v(l.id)+" "+v(l.title)+"·"+v(l.scene_location),11,re))),128))])]),_:1})])):h("",!0)]),_:1},8,["modelValue"])])}}}),fe=Z(de,[["__scopeId","data-v-4ec2192f"]]);export{fe as _};
